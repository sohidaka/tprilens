\documentclass[12pt]{article}
\usepackage[latin1]{inputenc}
\usepackage[headings]{fullpage}
\usepackage[noweb]{ocamlweb}
\pagestyle{headings}
 \input{macro} 
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This file has been automatically generated with the command
%% ocamlweb -noweb rellens_types.ml rellens.ml 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\typeout{OcamlWeb file Rellens_types.ml}
\ocwmodule{Rellens\_types}
\label{rellens_types.ml:0}%
attributes as strings 
\ocweol
\label{rellens_types.ml:29}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{attr}~=~$\ocwbt{string}\medskip

\label{rellens_types.ml:49}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{Attr}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.00em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{attr}$\ocweol
\ocwindent{0.00em}
\ocwbc{}   let compare = Pervasives.compare \ocwec{}~\ocwbc{} 4.07  and earlier \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~=~\ocwupperid{Stdlib.}\ocwlowerid{compare}~$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\ocwendcode{}\ocwindent{0.00em}
set of attributes, ranged over by $A,B,C$, as OCaml set of attr 
\ocweol
\label{rellens_types.ml:258}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{SetofAttr}~=~\ocwupperid{Set.Make}(\ocwupperid{Attr})$\medskip

\ocwendcode{}\ocwindent{0.00em}
homogeneous set of values, ranged over by $a,b,c$ 
\ocweol
\label{rellens_types.ml:349}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{value}~=$\ocweol
\ocwindent{2.00em}
$\ocwupperid{Int}~$\ocwkw{of}~\ocwbt{int}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Flt}~$\ocwkw{of}~\ocwbt{float}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Str}~$\ocwkw{of}~\ocwbt{string}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Bol}~$\ocwkw{of}~\ocwbt{bool}\medskip

\ocwendcode{}\ocwindent{0.00em}
comparator of value 
\ocweol
\label{rellens_types.ml:455}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compare\_value}~:~\ocwlowerid{value}~\rightarrow{}~\ocwlowerid{value}~\rightarrow{}~$\ocwbt{int}~=~\ocwbc{} Pervasives.compare \ocwec{}~$\ocwupperid{Stdlib.}\ocwlowerid{compare}$\medskip

\label{rellens_types.ml:540}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{MapofAttr}~=~\ocwupperid{Map.Make}(\ocwupperid{Attr})$\medskip

\ocwendcode{}\ocwindent{0.00em}
Records, ranged over by $m,n,l$, partial functions from attributes to values,
  as  OCaml map from  attr to value 
\ocweol
\label{rellens_types.ml:695}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{record}~=~\ocwlowerid{value}~\ocwupperid{MapofAttr.}\ocwlowerid{t}$\medskip

\ocwendcode{}\ocwindent{0.00em}
Relation, ranged over by $M, N, L$, as sets of records  
\ocweol
\label{rellens_types.ml:790}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{Record}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.00em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{record}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~=~\ocwupperid{MapofAttr.}\ocwlowerid{compare}~\ocwlowerid{compare\_value}$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\label{rellens_types.ml:884}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{SetofRecord}~=~\ocwupperid{Set.Make}(\ocwupperid{Record})$\medskip

\label{rellens_types.ml:923}%
\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{relation}~=~\ocwupperid{SetofRecord.}\ocwlowerid{t}$\medskip

\ocwendcode{}\ocwindent{0.00em}
expressions for predicates  
\ocweol
\label{rellens_types.ml:988}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.50em}
$\ocwupperid{PCns}~$\ocwkw{of}~$\ocwlowerid{value}~$\ocwbc{} constant \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PAnd}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} conjunction \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{POr}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} disjunction \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PNot}~$\ocwkw{of}~$\ocwlowerid{phrase}~$\ocwbc{} negation \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PVar}~$\ocwkw{of}~$\ocwlowerid{attr}~$\ocwbc{} attribute reference \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLt}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} $<$  \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PGt}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} $>$  \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLte}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} $\le$  \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PGte}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} $\ge$  \ocwec{}\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PEq}~$\ocwkw{of}~$\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~$\ocwbc{} = \ocwec{}~\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PCase}~$\ocwkw{of}\ocweol
\ocwindent{2.50em}
$((\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase})~$\ocwbt{list}$)~$\ocwbc{} when ... then \ocwec{}\ocweol
\ocwindent{1.50em}
$\times{}~\ocwlowerid{phrase}~$\ocwbc{} else \ocwec{}\medskip

\ocwendcode{}\ocwindent{0.00em}
phrase\_map: apply function $f$ to every node in phrase $p$ 
\ocweol
\label{rellens_types.ml:1605}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{phrase\_map}~(\ocwlowerid{f}:\ocwlowerid{phrase}~\rightarrow{}~\ocwlowerid{phrase})~\ocwlowerid{p}~:~\ocwlowerid{phrase}~=~$\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{1.50em}
$\ocwupperid{PCns}~\ocwlowerid{\_}~\mid{}~\ocwupperid{PVar}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{f}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PAnd}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{POr}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PLt}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PGt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PGt}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PLte}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PGte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PGte}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PEq}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PEq}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PNot}~\ocwlowerid{p1}~\rightarrow{}~\ocwlowerid{f}~(\ocwupperid{PNot}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1}))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PCase}~(\ocwlowerid{when\_clause\_list},\ocwlowerid{else\_clause})~\rightarrow{}$\ocweol
\ocwindent{2.50em}
$\ocwlowerid{f}~(\ocwupperid{PCase}$\ocweol
\ocwindent{3.50em}
$(\ocwupperid{List.}\ocwlowerid{map}~($\ocwkw{fun}~$(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~(\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p1},\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{p2}))~\ocwlowerid{when\_clause\_list},$\ocweol
\ocwindent{4.00em}
$\ocwlowerid{phrase\_map}~\ocwlowerid{f}~\ocwlowerid{else\_clause}))$\medskip

\ocwendcode{}\ocwindent{0.00em}
phrase type 
\ocweol
\label{rellens_types.ml:2362}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{ptype}~=$\ocweol
\ocwindent{2.00em}
$\ocwupperid{TInt}~$\ocwbc{} int \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{TFlt}~$\ocwbc{} float \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{TStr}~$\ocwbc{} string \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{TBol}~$\ocwbc{} bool \ocwec{}\medskip

\ocwendcode{}\ocwindent{0.00em}
type environment : maps attr to ptype 
\ocweol
\label{rellens_types.ml:2502}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{tenv}~=~\ocwlowerid{ptype}~\ocwupperid{MapofAttr.}\ocwlowerid{t}$\medskip

\ocwendcode{}\ocwindent{0.00em}
simple FD representation : pair of sets of attributes 
\ocweol
\label{rellens_types.ml:2593}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{fd}~=~\ocwupperid{SetofAttr.}\ocwlowerid{t}~\times{}~\ocwupperid{SetofAttr.}\ocwlowerid{t}$\medskip

\label{rellens_types.ml:2630}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compare\_fd}~(\ocwlowerid{fd1}:\ocwlowerid{fd})~(\ocwlowerid{fd2}:\ocwlowerid{fd})~:~$\ocwbt{int}~=~\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{x},\ocwlowerid{y}),(\ocwlowerid{x'},\ocwlowerid{y'}))~=~(\ocwlowerid{fd1},\ocwlowerid{fd2})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{c}~=~\ocwupperid{SetofAttr.}\ocwlowerid{compare}~\ocwlowerid{x}~\ocwlowerid{x'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwlowerid{c}~=~0~$\ocweol
\ocwindent{1.00em}
\ocwkw{then}~$\ocwupperid{SetofAttr.}\ocwlowerid{compare}~\ocwlowerid{y}~\ocwlowerid{y'}$\ocweol
\ocwindent{1.00em}
\ocwkw{else}~$\ocwlowerid{c}$\medskip

\ocwendcode{}\ocwindent{0.00em}
set of fd 
\ocweol
\label{rellens_types.ml:2813}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{FD}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.00em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{fd}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~=~\ocwlowerid{compare\_fd}$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\label{rellens_types.ml:2878}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{SetofFD}~=~\ocwupperid{Set.Make}(\ocwupperid{FD})$\medskip

\ocwendcode{}\ocwindent{0.00em}
set of set of attributes 
\ocweol
\label{rellens_types.ml:2940}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{PSetofAttr}~=~\ocwupperid{Set.Make}(\ocwupperid{SetofAttr})$\medskip

\ocwendcode{}\ocwindent{0.00em}
set map 
\ocweol
\label{rellens_types.ml:2995}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{setmap\_PSetofAttr}~(\ocwlowerid{f}:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~\rightarrow{}~\ocwupperid{PSetofAttr.}\ocwlowerid{t})~(\ocwlowerid{ss}:\ocwupperid{PSetofAttr.}\ocwlowerid{t})~=$\ocweol
\ocwindent{1.50em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{s}~\rightarrow{}~\ocwupperid{PSetofAttr.}\ocwlowerid{union}~(\ocwlowerid{f}~\ocwlowerid{s}))~\ocwlowerid{ss}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
map of nodes 
\ocweol
\label{rellens_types.ml:3167}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{MapofSetofAttr}~=~\ocwupperid{Map.Make}(\ocwupperid{SetofAttr})$\medskip

\ocwendcode{}\ocwindent{0.00em}
convert function $f$ to a finite map on given domain $D$ 
\ocweol
\ocwindent{0.00em}
$\{v\mapsto f(v)\mid v\leftarrow D \}   $
\ocweol
\label{rellens_types.ml:3355}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{f2map\_PSetofAttr}~(\ocwlowerid{f}:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~\rightarrow{}~\alpha{})~(\ocwlowerid{ss}:\ocwupperid{PSetofAttr.}\ocwlowerid{t})~:~\alpha{}~\ocwupperid{MapofSetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{s}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~\rightarrow{}$\ocweol
\ocwindent{5.00em}
$\ocwupperid{MapofSetofAttr.}\ocwlowerid{add}~(\ocwlowerid{s}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{f}~\ocwlowerid{s}))~\ocwlowerid{ss}~\ocwupperid{MapofSetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
relation name 
\ocweol
\label{rellens_types.ml:3575}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{rname}~=~$\ocwbt{string}\medskip

\ocwendcode{}\ocwindent{0.00em}
database instances, ranged over by $I,J$, are 
   finite maps from relation names to relations 
\ocweol
\label{rellens_types.ml:3698}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{Rname}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.00em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{rname}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~=~$\ocwbc{} Pervasives \ocwec{}$\ocwupperid{Stdlib.}\ocwlowerid{compare}$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\label{rellens_types.ml:3789}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{MapofRname}~=~\ocwupperid{Map.Make}(\ocwupperid{Rname})$\medskip

\ocwendcode{}\ocwindent{0.00em}
sort : quadruple of domain $U$, (attribute type environment), predicate $P$ and functional dependencies $F$ 
\ocweol
\label{rellens_types.ml:3940}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{sort}~=~\ocwupperid{SetofAttr.}\ocwlowerid{t}~\times{}~\ocwlowerid{tenv}~\times{}~\ocwlowerid{phrase}~\times{}~\ocwupperid{SetofFD.}\ocwlowerid{t}$\medskip

\ocwendcode{}\ocwindent{0.00em}
database: map from rname to pair of sort and relation 
\ocweol
\label{rellens_types.ml:4053}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{database}~=~(\ocwlowerid{sort}~\times{}~\ocwlowerid{relation})~\ocwupperid{MapofRname.}\ocwlowerid{t}$\medskip

\ocwendcode{}\ocwindent{0.00em}
change set 
\ocweol
\ocwindent{0.00em}
multiplicity mult: delete, keep, insert 
\ocweol
\label{rellens_types.ml:4164}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{mult}~=~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{Delete}~$\ocwbc{} -1 \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Keep}~$\ocwbc{}  0 \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Insert}~$\ocwbc{} +1 \ocwec{}\medskip

\ocwendcode{}\ocwindent{0.00em}
change entry as a pair of record (Horn's row) and multiplicity 
\ocweol
\label{rellens_types.ml:4310}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{change\_entry}~=~\ocwlowerid{record}\times{}\ocwlowerid{mult}$\medskip

\label{rellens_types.ml:4343}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compare\_change\_entry}~(\ocwlowerid{ce1}:\ocwlowerid{change\_entry})~(\ocwlowerid{ce2}:\ocwlowerid{change\_entry})~:~$\ocwbt{int}~=\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$((\ocwlowerid{rec1},\ocwlowerid{mul1}),(\ocwlowerid{rec2},\ocwlowerid{mul2}))~=~(\ocwlowerid{ce1},\ocwlowerid{ce2})~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{c}~=~\ocwupperid{MapofAttr.}\ocwlowerid{compare}~\ocwlowerid{compare\_value}~\ocwlowerid{rec1}~\ocwlowerid{rec2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{c}~=~0$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~\ocwbc{} Pervasives \ocwec{}$\ocwupperid{Stdlib.}\ocwlowerid{compare}~\ocwlowerid{mul1}~\ocwlowerid{mul2}~$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{c}$\medskip

\label{rellens_types.ml:4596}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{ChangeEntry}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.00em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{change\_entry}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~=~\ocwlowerid{compare\_change\_entry}$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\label{rellens_types.ml:4690}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{SetofChange}~=~\ocwupperid{Set.Make}(\ocwupperid{ChangeEntry})$\medskip

\label{rellens_types.ml:4734}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{PRecord}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.50em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{record}~\times{}~\ocwlowerid{record}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~(\ocwlowerid{rec1},\ocwlowerid{rec2})~(\ocwlowerid{rec1'},\ocwlowerid{rec2'})~=~$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{c}~=~\ocwupperid{MapofAttr.}\ocwlowerid{compare}~\ocwlowerid{compare\_value}~\ocwlowerid{rec1}~\ocwlowerid{rec1'}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{c}~=~0$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~$\ocwupperid{MapofAttr.}\ocwlowerid{compare}~\ocwlowerid{compare\_value}~\ocwlowerid{rec2}~\ocwlowerid{rec2'}~$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{c}$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\label{rellens_types.ml:4970}%
\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{SetofPRecord}~=~\ocwupperid{Set.Make}(\ocwupperid{PRecord})$\medskip

\ocwendcode{}\ocwindent{0.00em}
pair of FD and set of pair of records 
\ocweol
\label{rellens_types.ml:5055}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{FDSPRecord}~=~$\ocwkw{struct}\ocweol
\ocwindent{1.00em}
\ocwkw{type}~$\ocwlowerid{t}~=~\ocwlowerid{fd}~\times{}~\ocwupperid{SetofPRecord.}\ocwlowerid{t}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{compare}~(\ocwlowerid{fd},\ocwlowerid{s})~(\ocwlowerid{fd'},\ocwlowerid{s'})~=$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{c}~=~\ocwlowerid{compare\_fd}~\ocwlowerid{fd}~\ocwlowerid{fd'}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{c}~=~0$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~$\ocwupperid{SetofPRecord.}\ocwlowerid{compare}~\ocwlowerid{s}~\ocwlowerid{s'}$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{c}$\ocweol
\ocwindent{0.00em}
\ocwkw{end}\medskip

\ocwendcode{}\ocwindent{0.00em}
(fd * ((record * record) set)) set  used for update set 
\ocweol
\label{rellens_types.ml:5308}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{module}~$\ocwupperid{SetofFDSPRecord}~=~\ocwupperid{Set.Make}(\ocwupperid{FDSPRecord})$\medskip

\ocwendcode{}\ocwindent{0.00em}
tentative type definition for lens in the thesis 
\ocweol
\label{rellens_types.ml:5410}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{ilens}~=~\ocwlowerid{sort}~\times{}~\ocwlowerid{relation}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$v \in \Sigma \leftrightarrow \Delta$ 
\ocweol
\label{rellens_types.ml:5505}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{type}~$\ocwlowerid{lens}~=$\ocweol
\ocwindent{2.00em}
$\ocwupperid{Select}~$\ocwkw{of}~$\ocwlowerid{rname}~\times{}~\ocwlowerid{phrase}~\times{}~\ocwlowerid{rname}~$\ocwbc{} $\mt{select\ from}\ R\ \mt{where}\ P\ \mt{as}\ S$ \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{JoinDL}~$\ocwkw{of}~$(\ocwlowerid{rname}~\times{}~\ocwlowerid{rname})~\times{}~\ocwlowerid{rname}~$\ocwbc{} $\mt{join\_dl}\ R,\ S\ \mt{as}\ T$ \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Drop}~$\ocwkw{of}~$\ocwlowerid{attr}~\times{}~((\ocwlowerid{attr}~$\ocwbt{list}$)~\times{}~\ocwlowerid{value})~\times{}~\ocwlowerid{rname}~\times{}~\ocwlowerid{rname}~$\ocweol
\ocwindent{8.00em}
\ocwbc{} $\mt{drop}\ A\ \mt{determined\ by}\ (X,a)\ \mt{from}\ R\ \mi{as}\ S$ \ocwec{}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Compose}~$\ocwkw{of}~$\ocwlowerid{lens}~\times{}~\ocwlowerid{lens}$\ocweol
\ocwendcode{}\typeout{OcamlWeb file Rellens.ml}
\ocwmodule{Rellens}
\label{rellens.ml:0}%
Relational Lenses by Bohannon et al. and its incremental version by Horn 
\ocweol
\label{rellens.ml:81}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{open}~$\ocwupperid{Rellens\_types}$\ocweol
\ocwindent{0.00em}
\ocwkw{open}~$\ocwupperid{Print}$\medskip

\ocwendcode{}\ocwindent{0.00em}
domain of a record $m$ 
\ocweol
\ocwindent{0.00em}
$\mi{dom}(m)= \{ A \mid   (A \mapsto a) \in m \}$ 
\ocweol
\label{rellens.ml:201}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{dom}~(\ocwlowerid{m}:\ocwlowerid{record})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofAttr.}\ocwlowerid{of\_list}~(\ocwupperid{List.}\ocwlowerid{map}~\ocwlowerid{fst}~(\ocwupperid{MapofAttr.}\ocwlowerid{bindings}~\ocwlowerid{m}))$\medskip

\ocwendcode{}\ocwindent{0.00em}
attribute access $m(A)$ 
\ocweol
\label{rellens.ml:326}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{attribute}~(\ocwlowerid{a}:\ocwlowerid{attr})~(\ocwlowerid{m}:~\ocwlowerid{record})~:~\ocwlowerid{value}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofAttr.}\ocwlowerid{find}~\ocwlowerid{a}~\ocwlowerid{m}$\medskip

\ocwendcode{}\ocwindent{0.00em}
record extension $m[A \to a]$  
\ocweol
\ocwindent{0.00em}
$m[A \to a] = m \cup \{ A\mapsto a\}$  
\ocweol
\label{rellens.ml:477}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{extend}~(\ocwlowerid{a}:\ocwlowerid{attr})~(\ocwlowerid{v}:\ocwlowerid{value})~(\ocwlowerid{m}:\ocwlowerid{record})~:~\ocwlowerid{record}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofAttr.}\ocwlowerid{add}~\ocwlowerid{a}~\ocwlowerid{v}~\ocwlowerid{m}$\medskip

\ocwendcode{}\ocwindent{0.00em}
record restriction $m[X]$ 
\ocweol
\ocwindent{0.00em}
$\mt{restrict}\ X\ m = \{ A\mapsto a \mid (A \mapsto a) \in m, A \in X \}$ 
\ocweol
\label{rellens.ml:667}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{restrict}~(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{m}:\ocwlowerid{record})~:~\ocwlowerid{record}~=~$\ocweol
\ocwindent{1.50em}
$\ocwupperid{MapofAttr.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{key}~\ocwlowerid{a}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{key}~\ocwlowerid{x})~\ocwlowerid{m}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$M:U$ -- relation $M$ has domain $U$ 
\ocweol
\ocwindent{0.00em}
dynamic check 
\ocweol
\label{rellens.ml:840}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{of\_domain}~(\ocwlowerid{u}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{m}:\ocwlowerid{relation})~:~$\ocwbt{bool}~=~\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofRecord.}\ocwlowerid{for\_all}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~(\ocwupperid{SetofAttr.}\ocwlowerid{equal}~\ocwlowerid{u}~(\ocwlowerid{dom}~\ocwlowerid{r})))~\ocwlowerid{m}$\medskip

\ocwendcode{}\ocwindent{0.00em}
relational projection $M[X]$ as a restriction lifted to relation 
\ocweol
\ocwindent{0.00em}
$\{m[X] \mid m \in M \}$ 
\ocweol
\label{rellens.ml:1061}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{restrict\_relation}~(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{m}:\ocwlowerid{relation})~:~\ocwlowerid{relation}~=$\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwupperid{SetofRecord.}\ocwlowerid{add}~(\ocwlowerid{restrict}~\ocwlowerid{x}~\ocwlowerid{r}))~\ocwlowerid{m}~\ocwupperid{SetofRecord.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
record equivalence 
\ocweol
\label{rellens.ml:1234}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{record\_equal}~(\ocwlowerid{m}:\ocwlowerid{record})~(\ocwlowerid{m'}:\ocwlowerid{record})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofAttr.}\ocwlowerid{equal}~(=)~\ocwlowerid{m}~\ocwlowerid{m'}$\medskip

\ocwendcode{}\ocwindent{0.00em}
natural join $M \bowtie N$ by simple nested loop join 
\ocweol
\label{rellens.ml:1371}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{nat\_join}~(\ocwlowerid{m}:\ocwlowerid{relation})~(\ocwlowerid{n}:\ocwlowerid{relation})~:~\ocwlowerid{relation}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$(\ocwupperid{SetofRecord.}\ocwlowerid{is\_empty}~\ocwlowerid{m})~$\ocwkw{then}~$\ocwupperid{SetofRecord.}\ocwlowerid{empty}$\ocweol
\ocwindent{1.00em}
\ocwkw{else}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$(\ocwupperid{SetofRecord.}\ocwlowerid{is\_empty}~\ocwlowerid{n})~$\ocwkw{then}~$\ocwupperid{SetofRecord.}\ocwlowerid{empty}$\ocweol
\ocwindent{2.00em}
\ocwkw{else}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{uS}~=~\ocwlowerid{dom}~(\ocwupperid{SetofRecord.}\ocwlowerid{choose}~\ocwlowerid{m})~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{vS}~=~\ocwlowerid{dom}~(\ocwupperid{SetofRecord.}\ocwlowerid{choose}~\ocwlowerid{n})~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$((\ocwlowerid{of\_domain}~\ocwlowerid{uS}~\ocwlowerid{m})~\land{}~(\ocwlowerid{of\_domain}~\ocwlowerid{vS}~\ocwlowerid{n}))$\ocweol
\ocwindent{3.00em}
\ocwkw{then}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{iS}~=~\ocwupperid{SetofAttr.}\ocwlowerid{inter}~\ocwlowerid{uS}~\ocwlowerid{vS}~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{rm}~\ocwlowerid{rms}~\rightarrow{}$\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{union}$\ocweol
\ocwindent{5.00em}
$($\ocwkw{let}~$\ocwlowerid{rm'}~=~\ocwlowerid{restrict}~\ocwlowerid{iS}~\ocwlowerid{rm}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
$(\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{rn}~\ocwlowerid{rns}~\rightarrow{}$\ocweol
\ocwindent{6.00em}
\ocwkw{let}~$\ocwlowerid{rn'}~=~\ocwlowerid{restrict}~\ocwlowerid{iS}~\ocwlowerid{rn}~$\ocwkw{in}\ocweol
\ocwindent{6.00em}
\ocwkw{if}~$\ocwlowerid{record\_equal}~\ocwlowerid{rm'}~\ocwlowerid{rn'}~$\ocweol
\ocwindent{6.00em}
\ocwkw{then}~$\ocwupperid{SetofRecord.}\ocwlowerid{add}~(\ocwupperid{MapofAttr.}\ocwlowerid{merge}$\ocweol
\ocwindent{18.00em}
$($\ocwkw{fun}~$\ocwlowerid{k}~\ocwlowerid{a}~\ocwlowerid{b}~\rightarrow{}~$\ocwkw{match}~$(\ocwlowerid{a},\ocwlowerid{b})~$\ocwkw{with}\ocweol
\ocwindent{19.50em}
$(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~$\ocwkw{if}~$\ocwlowerid{a}=\ocwlowerid{b}~$\ocwkw{then}~$\ocwupperid{Some}~\ocwlowerid{a}~$\ocwkw{else}~$\ocwlowerid{failwith}~$\ocwstring{"mismatch"}\ocweol
\ocwindent{18.50em}
$\mid{}~(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{None}~)~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{a}$\ocweol
\ocwindent{18.50em}
$\mid{}~(\ocwupperid{None},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{b}$\ocweol
\ocwindent{18.50em}
$\mid{}~(\ocwupperid{None},\ocwupperid{None})~\rightarrow{}~\ocwupperid{None})~\ocwlowerid{rm}~\ocwlowerid{rn})~\ocwlowerid{rns}~$\ocweol
\ocwindent{6.00em}
\ocwkw{else}~$\ocwlowerid{rns})~\ocwlowerid{n}~\ocwlowerid{rms}))~\ocwlowerid{rms})~\ocwlowerid{m}~\ocwupperid{SetofRecord.}\ocwlowerid{empty}~$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwupperid{SetofRecord.}\ocwlowerid{empty}$\medskip

\label{rellens.ml:2279}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{lookup\_type}~(\ocwlowerid{a}:\ocwlowerid{attr})~(\ocwlowerid{env}:\ocwlowerid{tenv})~:~\ocwlowerid{ptype}~=~$\ocweol
\ocwindent{1.50em}
\ocwkw{try}~$(\ocwupperid{MapofAttr.}\ocwlowerid{find}~\ocwlowerid{a}~\ocwlowerid{env})~$\ocwkw{with}\ocweol
\ocwindent{2.50em}
$\ocwupperid{Not\_found}~\rightarrow{}$\ocweol
\ocwindent{3.50em}
$\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"lookup\_type\ocwvspace{}\%a\ocwvspace{}not\ocwvspace{}found\ocwvspace{}in\ocwvspace{}type\ocwvspace{}env\ocwvspace{}\%a@."}~\ocweol
\ocwindent{4.50em}
$\ocwlowerid{pp\_attr}~\ocwlowerid{a}~\ocwlowerid{pp\_tenv}~\ocwlowerid{env};$\ocweol
\ocwindent{3.50em}
$\ocwlowerid{raise}~\ocwupperid{Not\_found}$\medskip

\label{rellens.ml:2516}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{merge\_tenv}~(\ocwlowerid{tenv1}:\ocwlowerid{tenv})~(\ocwlowerid{tenv2}:\ocwlowerid{tenv})~:~\ocwlowerid{tenv}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofAttr.}\ocwlowerid{merge}$\ocweol
\ocwindent{2.50em}
$($\ocwkw{fun}~$\ocwlowerid{k}~\ocwlowerid{a}~\ocwlowerid{b}~\rightarrow{}~$\ocwkw{match}~$(\ocwlowerid{a},\ocwlowerid{b})~$\ocwkw{with}\ocweol
\ocwindent{3.50em}
$(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~$\ocwkw{if}~$\ocwlowerid{a}=\ocwlowerid{b}~$\ocwkw{then}~$\ocwupperid{Some}~\ocwlowerid{a}~$\ocwkw{else}~$\ocwlowerid{failwith}~$\ocwstring{"mismatch"}\ocweol
\ocwindent{2.50em}
$\mid{}~(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{None}~)~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{a}$\ocweol
\ocwindent{2.50em}
$\mid{}~(\ocwupperid{None},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{b}$\ocweol
\ocwindent{2.50em}
$\mid{}~(\ocwupperid{None},\ocwupperid{None})~\rightarrow{}~\ocwupperid{None})~\ocwlowerid{tenv1}~\ocwlowerid{tenv2}$\medskip

\ocwendcode{}\ocwindent{0.00em}
trivial type inference 
\ocweol
\label{rellens.ml:2830}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{qtype}~(\ocwlowerid{env}:\ocwlowerid{tenv})~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~\ocwlowerid{ptype}~=~$\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{1.00em}
$\ocwupperid{PCns}~(\ocwupperid{Int}~\ocwlowerid{\_}~)~\rightarrow{}~\ocwupperid{TInt}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PCns}~(\ocwupperid{Flt}~\ocwlowerid{\_}~)~\rightarrow{}~\ocwupperid{TFlt}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PCns}~(\ocwupperid{Str}~\ocwlowerid{\_}~)~\rightarrow{}~\ocwupperid{TStr}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PCns}~(\ocwupperid{Bol}~\ocwlowerid{\_}~)~\rightarrow{}~\ocwupperid{TBol}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PVar}~\ocwlowerid{a}~\rightarrow{}~\ocwlowerid{lookup\_type}~\ocwlowerid{a}~\ocwlowerid{env}~$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PCase}~(\ocwlowerid{wt\_phrase\_list},\ocwlowerid{else\_phrase})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$\ocwlowerid{wt\_phrase\_list}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$[\,]~\rightarrow{}~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{else\_phrase}$\ocweol
\ocwindent{2.00em}
$\mid{}~(\ocwlowerid{w},\ocwlowerid{t})::\ocwlowerid{wts}~\rightarrow{}$\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{check\_when}~\ocwlowerid{p}~=$\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p}~\not=~\ocwupperid{TBol}~$\ocwkw{then}~$\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}non\symbol{45}boolean\ocwvspace{}WHEN\ocwvspace{}in\ocwvspace{}CASE"}~\ocwkw{in}\ocweol
\ocwindent{4.00em}
$\ocwlowerid{check\_when}~\ocwlowerid{w};$\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{tt}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{t}~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{qt}~\ocwlowerid{accum\_type}~\ocwlowerid{l}~=$\ocweol
\ocwindent{5.00em}
$($\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{6.00em}
$[\,]~\rightarrow{}$\ocweol
\ocwindent{7.00em}
\ocwkw{if}~$\ocwlowerid{accum\_type}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{else\_phrase}~$\ocwkw{then}~$\ocwlowerid{accum\_type}~$\ocwkw{else}\ocweol
\ocwindent{7.00em}
$\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}invalid\ocwvspace{}else\ocwvspace{}type\ocwvspace{}in\ocwvspace{}CASE"}\ocweol
\ocwindent{5.00em}
$\mid{}~(\ocwlowerid{w},\ocwlowerid{t})::\ocwlowerid{wts}~\rightarrow{}$\ocweol
\ocwindent{7.00em}
$\ocwlowerid{check\_when}~\ocwlowerid{w};$\ocweol
\ocwindent{7.00em}
\ocwkw{if}~$\ocwlowerid{accum\_type}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{t}~$\ocwkw{then}~$\ocwlowerid{qt}~\ocwlowerid{accum\_type}~\ocwlowerid{wts}~$\ocweol
\ocwindent{7.00em}
\ocwkw{else}~$\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}invalid\ocwvspace{}then\ocwvspace{}clause\ocwvspace{}in\ocwvspace{}CASE"}$)~$\ocwkw{in}~\ocweol
\ocwindent{4.00em}
$\ocwlowerid{qt}~\ocwlowerid{tt}~\ocwlowerid{wts})$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{t1},\ocwlowerid{t2}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p1},~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$\ocwlowerid{t1},\ocwlowerid{t2}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$\ocwupperid{TBol},\ocwupperid{TBol}~\rightarrow{}~\ocwupperid{TBol}~$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}invalid\ocwvspace{}operand\ocwvspace{}type\ocwvspace{}for\ocwvspace{}boolean"}$)$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PNot}~\ocwlowerid{p1}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{t1}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$\ocwlowerid{t1}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$\ocwupperid{TBol}~\rightarrow{}~\ocwupperid{TBol}~$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}invalid\ocwvspace{}operand\ocwvspace{}type\ocwvspace{}for\ocwvspace{}boolean"}$)$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PLt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGt}(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PLte}(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGte}(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{t1},\ocwlowerid{t2}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p1},~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$\ocwlowerid{t1},\ocwlowerid{t2}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$\ocwupperid{TInt},\ocwupperid{TInt}~\mid{}~\ocwupperid{TFlt},\ocwupperid{TFlt}~\mid{}~\ocwupperid{TStr},\ocwupperid{TStr}~\rightarrow{}~\ocwupperid{TBol}$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}invalid\ocwvspace{}operand\ocwvspace{}type\ocwvspace{}for\ocwvspace{}comparison"}$)$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PEq}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{t1},\ocwlowerid{t2}~=~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p1},~\ocwlowerid{qtype}~\ocwlowerid{env}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{t1}~=~\ocwlowerid{t2}~$\ocwkw{then}~$\ocwupperid{TBol}~$\ocwkw{else}~$\ocwlowerid{failwith}~$\ocwstring{"qtype:\ocwvspace{}invalid\ocwvspace{}operand\ocwvspace{}type\ocwvspace{}for\ocwvspace{}comparison"}\medskip

\ocwendcode{}\ocwindent{0.00em}
$\sem{p}_r$ : interpret phrase $p$ on record $r$ 
\ocweol
\label{rellens.ml:4431}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{eval}~(\ocwlowerid{r}:\ocwlowerid{record})~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~\ocwlowerid{value}~=~$\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{1.00em}
$\ocwupperid{PCns}~\ocwlowerid{v}~\rightarrow{}~\ocwlowerid{v}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{v1}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{v2}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$(\ocwlowerid{v1},\ocwlowerid{v2})~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Bol}~\ocwlowerid{b1},\ocwupperid{Bol}~\ocwlowerid{b2})~\rightarrow{}~\ocwupperid{Bol}~(\ocwlowerid{b1}~\land{}~\ocwlowerid{b2})$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"PAnd:\ocwvspace{}non\symbol{45}boolean\ocwvspace{}operand"}\ocweol
\ocwindent{2.00em}
$)$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{v1}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{v2}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$(\ocwlowerid{v1},\ocwlowerid{v2})~$\ocwkw{with}~\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Bol}~\ocwlowerid{b1},\ocwupperid{Bol}~\ocwlowerid{b2})~\rightarrow{}~\ocwupperid{Bol}~(\ocwlowerid{b1}~\lor{}~\ocwlowerid{b2})~$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"POr:\ocwvspace{}non\symbol{45}boolean\ocwvspace{}operand"}$)$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PNot}~\ocwlowerid{p1}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{v}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$\ocwlowerid{v}~$\ocwkw{with}~\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Bol}~\ocwlowerid{b})~\rightarrow{}~\ocwupperid{Bol}~(\lnot{}~\ocwlowerid{b})$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"PNot:\ocwvspace{}non\symbol{45}boolean\ocwvspace{}operand"}\ocweol
\ocwindent{2.00em}
$)$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PVar}~\ocwlowerid{attr}~\rightarrow{}~\ocwupperid{MapofAttr.}\ocwlowerid{find}~\ocwlowerid{attr}~\ocwlowerid{r}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PLte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~$\ocweol
\ocwindent{2.00em}
$($\ocwkw{let}~$(\ocwlowerid{v1},\ocwlowerid{v2})~=~(\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p1},\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p2})~$\ocwkw{in}\ocweol
\ocwindent{2.50em}
\ocwkw{let}~$\ocwlowerid{value\_comparison\_op}~:~\ocwlowerid{value}~\rightarrow{}~\ocwlowerid{value}~\rightarrow{}~$\ocwbt{bool}~=\ocweol
\ocwindent{3.50em}
\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{3.50em}
$\mid{}~\ocwupperid{PLt}~\ocwlowerid{\_}~\rightarrow{}~(<)$\ocweol
\ocwindent{3.50em}
$\mid{}~\ocwupperid{PGt}~\ocwlowerid{\_}~\rightarrow{}~(>)$\ocweol
\ocwindent{3.50em}
$\mid{}~\ocwupperid{PLte}~\ocwlowerid{\_}~\rightarrow{}~(\le{})$\ocweol
\ocwindent{3.50em}
$\mid{}~\ocwupperid{PGte}~\ocwlowerid{\_}~\rightarrow{}~(\ge{})~$\ocweol
\ocwindent{3.50em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"eval:\ocwvspace{}unexpected\ocwvspace{}operator"}~\ocwkw{in}\ocweol
\ocwindent{2.50em}
\ocwkw{match}~$(\ocwlowerid{v1},\ocwlowerid{v2})~$\ocwkw{with}\ocweol
\ocwindent{3.50em}
$(\ocwupperid{Int}~\ocwlowerid{\_},\ocwupperid{Int}~\ocwlowerid{\_})$\ocweol
\ocwindent{2.50em}
$\mid{}~(\ocwupperid{Flt}~\ocwlowerid{\_},\ocwupperid{Flt}~\ocwlowerid{\_})$\ocweol
\ocwindent{2.50em}
$\mid{}~(\ocwupperid{Str}~\ocwlowerid{\_},\ocwupperid{Str}~\ocwlowerid{\_})~\rightarrow{}~$\ocwbc{} use value type to rely on Stdlib.compare \ocwec{}\ocweol
\ocwindent{12.00em}
$\ocwupperid{Bol}~(\ocwlowerid{value\_comparison\_op}~\ocwlowerid{v1}~\ocwlowerid{v2})$\ocweol
\ocwindent{2.50em}
$\mid{}~(\ocwupperid{Bol}~\ocwlowerid{\_},\ocwupperid{Bol}~\ocwlowerid{\_})~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"comparison:\ocwvspace{}boolean\ocwvspace{}operands"}\ocweol
\ocwindent{2.50em}
$\mid{}~\ocwlowerid{\_},\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"comparison:\ocwvspace{}mismatch\ocwvspace{}operand"}$)$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PEq}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~$\ocweol
\ocwindent{2.50em}
$($\ocwkw{let}~$(\ocwlowerid{v1},\ocwlowerid{v2})=(\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p1},~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p2})~$\ocwkw{in}~$\ocwupperid{Bol}~(\ocwlowerid{v1}~=~\ocwlowerid{v2})~)$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PCase}~(\ocwlowerid{wlist},\ocwlowerid{else\_phrase})~\rightarrow{}~\ocwlowerid{eval\_case}~\ocwlowerid{r}~\ocwlowerid{wlist}~\ocwlowerid{else\_phrase}$\ocweol
\ocwindent{0.50em}
\ocwkw{and}~$\ocwlowerid{eval\_case}~(\ocwlowerid{r}:\ocwlowerid{record})~(\ocwlowerid{wlist}:(\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase})~$\ocwbt{list}$)~(\ocwlowerid{else\_phrase}:\ocwlowerid{phrase})~:~\ocwlowerid{value}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{match}~$\ocwlowerid{wlist}~$\ocwkw{with}\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{p1},\ocwlowerid{p2})::\ocwlowerid{ps}~\rightarrow{}$\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{vp1}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p1}~$\ocwkw{in}~\ocweol
\ocwindent{2.50em}
$($\ocwkw{match}~$\ocwlowerid{vp1}~$\ocwkw{with}~\ocweol
\ocwindent{4.00em}
$\ocwupperid{Bol}~\ocwlowerid{b}~\rightarrow{}$\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{b}~$\ocwkw{then}~$\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p2}$\ocweol
\ocwindent{5.00em}
\ocwkw{else}~$\ocwlowerid{eval\_case}~\ocwlowerid{r}~\ocwlowerid{ps}~\ocwlowerid{else\_phrase}$\ocweol
\ocwindent{3.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"non\symbol{45}boolean\ocwvspace{}value\ocwvspace{}in\ocwvspace{}when\ocwvspace{}condition"}$)$\ocweol
\ocwindent{1.00em}
$\mid{}~[\,]~\rightarrow{}~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{else\_phrase}$\medskip

\ocwendcode{}\ocwindent{0.00em}
evaluator specific to boolean predicates 
\ocweol
\label{rellens.ml:6276}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{eval\_bool}~(\ocwlowerid{r}:\ocwlowerid{record})~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{v}~=~\ocwlowerid{eval}~\ocwlowerid{r}~\ocwlowerid{p}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{match}~$\ocwlowerid{v}~$\ocwkw{with}~$\ocwupperid{Bol}~\ocwlowerid{b}~\rightarrow{}~\ocwlowerid{b}$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"eval\_bool:\ocwvspace{}non\symbol{45}boolean\ocwvspace{}result\ocwvspace{}\%s"}~$(\ocwlowerid{toStr}~\ocwlowerid{pp\_value}~\ocwlowerid{v}))$\medskip

\ocwendcode{}\ocwindent{0.00em}
predicates, ranged over by $P$ and $Q$

  $\top_U$ (top) : set of all records over the domain $U$

  negation of predicate : set complement

  $\neg_U M : \top_U \setminus M$ 

  $P \cap M$ : relational selection 
\ocweol
\ocwindent{0.00em}
$P\ ignores\ X$ : predicate $P$ does not refer to attributes in $X$ 
\ocweol
\label{rellens.ml:6753}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{ignores}~(\ocwlowerid{p}:\ocwlowerid{phrase})~(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~$\ocwbt{bool}~=~\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{1.00em}
$\ocwupperid{PCns}~\ocwlowerid{v}~\rightarrow{}~$\ocwkw{true}\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PLt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PLte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGte}~(\ocwlowerid{p1},\ocwlowerid{p2})~$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PEq}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{ignores}~\ocwlowerid{p1}~\ocwlowerid{x}~\land{}~\ocwlowerid{ignores}~\ocwlowerid{p2}~\ocwlowerid{x}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PNot}~\ocwlowerid{p1}~\rightarrow{}~\ocwlowerid{ignores}~\ocwlowerid{p1}~\ocwlowerid{x}$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PVar}~\ocwlowerid{attr}~\rightarrow{}~\lnot{}~(\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{attr}~\ocwlowerid{x})$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{PCase}~(\ocwlowerid{wlist},\ocwlowerid{else\_phrase})~\rightarrow{}~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{List.}\ocwlowerid{for\_all}~($\ocwkw{fun}~$(\ocwlowerid{w},\ocwlowerid{t})~\rightarrow{}~\ocwlowerid{ignores}~\ocwlowerid{w}~\ocwlowerid{x}~\land{}~\ocwlowerid{ignores}~\ocwlowerid{t}~\ocwlowerid{x})~\ocwlowerid{wlist}~$\ocweol
\ocwindent{3.00em}
$\land{}~\ocwlowerid{ignores}~\ocwlowerid{else\_phrase}~\ocwlowerid{x}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$M \models X \to Y$ : $M$ models functional dependency $X \to Y$ 
\ocweol
\ocwindent{0.00em}
list of all pairs of a list 
\ocweol
\label{rellens.ml:7274}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{list\_pairs}~(\ocwlowerid{l}:~\alpha{}~$\ocwbt{list}$)~:~(\alpha{}~\times{}~\alpha{})~$\ocwbt{list}~=\ocweol
\ocwindent{1.50em}
$\ocwupperid{List.}\ocwlowerid{fold\_right}~($\ocwkw{fun}~$\ocwlowerid{e}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$(@)~(\ocwupperid{List.}\ocwlowerid{map}~($\ocwkw{fun}~$\ocwlowerid{e'}~\rightarrow{}~(\ocwlowerid{e},\ocwlowerid{e'}))~\ocwlowerid{l}))~\ocwlowerid{l}~[\,]$\medskip

\ocwendcode{}\ocwindent{0.00em}
naive test of $M \models X \to Y$

  by testing if $m[X]=m'[X] \Rightarrow m[Y]=m'[Y]$ for all $m,m' \in M$ 
\ocweol
\label{rellens.ml:7513}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{models}~(\ocwlowerid{m}:\ocwlowerid{relation})~((\ocwlowerid{x},\ocwlowerid{y}):\ocwlowerid{fd})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{lp}~=~\ocwlowerid{list\_pairs}~(\ocwupperid{SetofRecord.}\ocwlowerid{elements}~\ocwlowerid{m})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{List.}\ocwlowerid{for\_all}~($\ocwkw{fun}~$(\ocwlowerid{m},\ocwlowerid{m'})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{record\_equal}~(\ocwlowerid{restrict}~\ocwlowerid{x}~\ocwlowerid{m})~(\ocwlowerid{restrict}~\ocwlowerid{x}~\ocwlowerid{m'})$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~$\ocwlowerid{record\_equal}~(\ocwlowerid{restrict}~\ocwlowerid{y}~\ocwlowerid{m})~(\ocwlowerid{restrict}~\ocwlowerid{y}~\ocwlowerid{m'})$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~\ocwkw{true}$)~\ocwlowerid{lp}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\models$ lifted to set of fd 
\ocweol
\ocwindent{0.00em}
$M \models F = \bigwedge_{\mathit{fd}\in F} M \models \mathit{fd}$ 
\ocweol
\label{rellens.ml:7875}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{models\_fds}~(\ocwlowerid{m}:\ocwlowerid{relation})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{for\_all}~(\ocwlowerid{models}~\ocwlowerid{m})~\ocwlowerid{fds}$\medskip

\ocwendcode{}\ocwindent{0.00em}
functions on functional dependencies 
\ocweol
\ocwindent{0.00em}
$\mi{left}(F) = \cup\{ X \mid  X \to Y \in F\}$ 
\ocweol
\label{rellens.ml:8060}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{left}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{x})~\ocwlowerid{fds}~\ocwupperid{SetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mi{right}(F) = \cup\{ Y \mid  X \to Y \in F\}$ 
\ocweol
\label{rellens.ml:8235}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{right}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{y})~\ocwlowerid{fds}~\ocwupperid{SetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mi{names}(F) = \mi{left}(F) \cup \mi{right}(F)$ 
\ocweol
\label{rellens.ml:8450}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{names}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofAttr.}\ocwlowerid{union}~(\ocwlowerid{left}~\ocwlowerid{fds})~(\ocwlowerid{right}~\ocwlowerid{fds})$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mi{outputs}(F) = \{ A \in U \mid \exists X \subseteq U . 
           A \notin X \mathbin{\text{and}} F \models X \to A\}$ 
\ocweol
\label{rellens.ml:8665}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{outputs}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofAttr.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{attr}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{exists}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{attr}~\ocwlowerid{y})~\land{}~(\lnot{}~(\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{attr}~\ocwlowerid{x})))~\ocwlowerid{fds})~(\ocwlowerid{right}~\ocwlowerid{fds})$\medskip

\ocwendcode{}\ocwindent{0.00em}
(literal) tree form 
\ocweol
\ocwindent{0.00em}
distinctness of sources and destinations of FD 
\ocweol
\label{rellens.ml:8936}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{exception}~$\ocwupperid{Overlap\_Between\_Attributes}~$\ocwbc{} overlap between sets of attributes \ocwec{}\medskip

\label{rellens.ml:9015}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{merge\_attrs}~(\ocwlowerid{attrs}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{attrss}:\ocwupperid{PSetofAttr.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{is\_empty}~\ocwlowerid{attrs}~$\ocwkw{then}~$\ocwlowerid{failwith}~$\ocwstring{"empty\ocwvspace{}set\ocwvspace{}of\ocwvspace{}attributes"}\ocweol
\ocwindent{1.00em}
\ocwkw{else}~\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$(\ocwupperid{PSetofAttr.}\ocwlowerid{mem}~\ocwlowerid{attrs}~\ocwlowerid{attrss})$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~$\ocwlowerid{attrss}~$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwupperid{PSetofAttr.}\ocwlowerid{for\_all}~$\ocweol
\ocwindent{5.00em}
$($\ocwkw{fun}~$\ocwlowerid{s}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{is\_empty}~(\ocwupperid{SetofAttr.}\ocwlowerid{inter}~\ocwlowerid{s}~\ocwlowerid{attrs}))~\ocwlowerid{attrss}$\ocweol
\ocwindent{3.00em}
\ocwkw{then}~$\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{attrs}~\ocwlowerid{attrss}~$\ocweol
\ocwindent{3.00em}
\ocwkw{else}~$\ocwlowerid{raise}~\ocwupperid{Overlap\_Between\_Attributes}$\medskip

\label{rellens.ml:9413}%
\ocwindent{0.00em}
\ocwkw{exception}~$\ocwupperid{Is\_Cyclic}$\ocweol
\ocwindent{0.00em}
\ocwkw{exception}~$\ocwupperid{Multiple\_Indegree}$\medskip

\ocwendcode{}\ocwindent{0.00em}
set of nodes (distinctness test) 
\ocweol
\label{rellens.ml:9501}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{nodes}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{merge\_attrs}~\ocwlowerid{y}~(\ocwlowerid{merge\_attrs}~\ocwlowerid{x}~\ocwlowerid{ss})))~\ocwlowerid{fds}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\label{rellens.ml:9643}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{fwd}~(\ocwlowerid{v}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{edges}~=~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{equal}~\ocwlowerid{v}~\ocwlowerid{x}~$\ocwkw{then}~$\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{y}~\ocwlowerid{ss}$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{edges}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\label{rellens.ml:9844}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{bwd}~(\ocwlowerid{v}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{edges}~=~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{equal}~\ocwlowerid{v}~\ocwlowerid{y}~$\ocwkw{then}~$\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{x}~\ocwlowerid{ss}$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{edges}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
tree form test: check if a set of FDs is in tree form 
\ocweol
\label{rellens.ml:10106}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{is\_tree}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{it}~()~:~$\ocwbt{bool}~=\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{nS}~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=~\ocwlowerid{nodes}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{\_}~=~$\ocweol
\ocwindent{3.00em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{iter}~($\ocwkw{fun}~$(\ocwlowerid{v}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~\rightarrow{}$\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwupperid{PSetofAttr.}\ocwlowerid{cardinal}~(\ocwlowerid{bwd}~\ocwlowerid{v}~\ocwlowerid{fds})~>~1~$\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Multiple\_Indegree})~\ocwlowerid{nS}~$\ocwkw{in}\medskip

\label{rellens.ml:11220}%
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{is\_cyclic}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{nS}:~\ocwupperid{PSetofAttr.}\ocwlowerid{t})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{fwd}~\ocwlowerid{v}~=~\ocwlowerid{fwd}~\ocwlowerid{v}~\ocwlowerid{fds}~$\ocwkw{in}~\ocweol
\ocwindent{3.00em}
\ocwbc{} finite map from left hand side of FD to the set of right hand sides of FD \ocwec{}\ocweol
\ocwindent{6.00em}
\ocwbc{} $\{v_1 \mapsto fwd(v_1), v_2 \mapsto fwd(v_2), \ldots, v_n \mapsto fwd(v_n) \}$ \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{initial\_closure\_map}~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~\ocwupperid{MapofSetofAttr.}\ocwlowerid{t}~=~\ocwlowerid{f2map\_PSetofAttr}~\ocwlowerid{fwd}~\ocwlowerid{nS}~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwbc{} extend the closure by the sets of attributes obtained by one time application of fwd \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{extend\_by\_fwd}~(\ocwlowerid{closure}:\ocwupperid{PSetofAttr.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{4.00em}
$\ocwlowerid{setmap\_PSetofAttr}~($\ocwkw{fun}~$\ocwlowerid{v}~\rightarrow{}~\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{v}~(\ocwlowerid{fwd}~\ocwlowerid{v}))~\ocwlowerid{closure}~$\ocweol
\ocwindent{3.00em}
\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwbc{} complete the map from the node to its irreflexive transitive closure of fwd 
         by repeating one step extension of the closure $|nS|$ times (number of nodes) 
         to the initial closure map \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{closure\_map}~=$\ocweol
\ocwindent{4.00em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{\_}~\rightarrow{}~\ocwupperid{MapofSetofAttr.}\ocwlowerid{map}~\ocwlowerid{extend\_by\_fwd})~\ocwlowerid{nS}~\ocwlowerid{initial\_closure\_map}~$\ocwkw{in}\ocweol
\ocwindent{6.00em}
\ocwbc{} $ \vee\{v \in closure(v) \mid (v \mapsto closure(v)) \in closure\_map\}$ \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwbc{} ${\displaystyle= \bigvee_{(v\mapsto closure(v))\in closure\_map}{v\in closure(v)}}$  \ocwec{}\ocweol
\ocwindent{3.00em}
$\ocwupperid{MapofSetofAttr.}\ocwlowerid{exists}~\ocwupperid{PSetofAttr.}\ocwlowerid{mem}~\ocwlowerid{closure\_map}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{is\_cyclic}~\ocwlowerid{fds}~\ocwlowerid{nS}~$\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Is\_Cyclic}~$\ocwkw{else}\ocweol
\ocwindent{2.00em}
\ocwkw{true}~\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{try}~$(\ocwlowerid{it}~())~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$\ocwupperid{Is\_Cyclic}~\rightarrow{}~$\ocweol
\ocwindent{4.00em}
$\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"\%s@."}~\ocwstring{"cyclic\ocwvspace{}functional\ocwvspace{}dependency"};\ocweol
\ocwindent{4.00em}
\ocwkw{false}\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwupperid{Overlap\_Between\_Attributes}~\rightarrow{}$\ocweol
\ocwindent{4.00em}
$\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"\%s@."}~\ocwstring{"overlap\ocwvspace{}between\ocwvspace{}sets\ocwvspace{}of\ocwvspace{}attributes"};\ocweol
\ocwindent{4.00em}
\ocwkw{false}\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwupperid{Multiple\_Indegree}~\rightarrow{}$\ocweol
\ocwindent{4.00em}
$\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"\%s@."}~\ocwstring{"more\ocwvspace{}than\ocwvspace{}one\ocwvspace{}in\symbol{45}degree"};\ocweol
\ocwindent{4.00em}
\ocwkw{false}\medskip

\label{rellens.ml:13120}%
\ocwindent{0.00em}
\ocwkw{exception}~$\ocwupperid{Not\_in\_Tree\_Form}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$leavs(F)$ : nodes that have no overlap with left parts of $F$ 
\ocweol
\ocwindent{0.00em}
$\{ Y \mid \exists X.X\to Y\in F \mathbin{\text{and}} Y \cap \mi{left}(F)=\emptyset \}$ 
\ocweol
\label{rellens.ml:13311}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{leaves}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fds})~$\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{leftS}~=~\ocwlowerid{left}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.50em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{is\_empty}~(\ocwupperid{SetofAttr.}\ocwlowerid{inter}~\ocwlowerid{leftS}~\ocwlowerid{y})~$\ocweol
\ocwindent{2.50em}
\ocwkw{then}~$\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{y}~\ocwlowerid{ss}~$\ocweol
\ocwindent{4.50em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{fds}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$roots(F)$ : nodes that have no overlap with the right parts of $F$ 
\ocweol
\ocwindent{0.00em}
$\{ Y \mid \exists X.X\to Y\in F \mathbin{\text{and}} Y \cap \mi{right}(F)=\emptyset \}$ 
\ocweol
\label{rellens.ml:13759}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{roots}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fds})~$\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{rightS}~=~\ocwlowerid{right}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.50em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{is\_empty}~(\ocwupperid{SetofAttr.}\ocwlowerid{inter}~\ocwlowerid{rightS}~\ocwlowerid{x})~$\ocweol
\ocwindent{2.50em}
\ocwkw{then}~$\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{x}~\ocwlowerid{ss}~$\ocweol
\ocwindent{4.50em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{fds}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
right-biased combination of records $m$ and $n$ 
\ocweol
\ocwindent{0.00em}
$m \rbcr n$

  $m =          \{ A \to a1, B \to b1, C \to c1\}$

  $n =          \{ A \to a2, B \to b2,          D \to d1\}$

  $m \rbcr n  = \{ A \to a2, B \to b2, C \to c1,D \to d1\}$

 
\ocweol
\label{rellens.ml:14545}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{rbcr}~(\ocwlowerid{m}:\ocwlowerid{record})~(\ocwlowerid{n}:\ocwlowerid{record})~:~\ocwlowerid{record}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofAttr.}\ocwlowerid{merge}~($\ocwkw{fun}~$\ocwlowerid{k}~\ocwlowerid{a}~\ocwlowerid{b}~\rightarrow{}~$\ocwkw{match}~$(\ocwlowerid{a},\ocwlowerid{b})~$\ocwkw{with}\ocweol
\ocwindent{1.00em}
$(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{b}~$\ocwbc{} $dom(m) \cap  dom(n)$ : right bias \ocwec{}\ocweol
\ocwindent{0.00em}
$\mid{}~(\ocwupperid{None},~\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{b}~$\ocwbc{}              $dom(n)$ : agree with $n$ \ocwec{}\ocweol
\ocwindent{0.00em}
$\mid{}~(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{None}~)~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{a}~$\ocwbc{} $dom(m)\setminus dom(n)$ : agree with $m$ \ocwec{}\ocweol
\ocwindent{0.00em}
$\mid{}~(\ocwupperid{None},\ocwupperid{None})~\rightarrow{}~\ocwupperid{None})~\ocwlowerid{m}~\ocwlowerid{n}$\medskip

\ocwendcode{}\ocwindent{0.00em}
single-dependency record revision 
\ocweol
\ocwindent{0.00em}
$m \sdrr{X\to Y}{N} m'$ 
\ocweol
\label{rellens.ml:15193}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{sdrr}~(\ocwlowerid{m}:\ocwlowerid{record})~((\ocwlowerid{x},\ocwlowerid{y}):\ocwlowerid{fd})~(\ocwlowerid{n}:\ocwlowerid{relation})~:~\ocwlowerid{record}~=$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{models}~\ocwlowerid{n}~(\ocwlowerid{x},\ocwlowerid{y}))$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~$\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"relation\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}satisfy\ocwvspace{}functional\ocwvspace{}dependency\ocwvspace{}\%s"}\ocweol
\ocwindent{11.00em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_relation}~\ocwlowerid{n})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fd}~(\ocwlowerid{x},\ocwlowerid{y})))$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{mX}~=~\ocwlowerid{restrict}~\ocwlowerid{x}~\ocwlowerid{m}~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{n'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{filter}$\ocweol
\ocwindent{5.00em}
$($\ocwkw{fun}~$\ocwlowerid{rn}~\rightarrow{}~\ocwlowerid{record\_equal}~\ocwlowerid{mX}~(\ocwlowerid{restrict}~\ocwlowerid{x}~\ocwlowerid{rn}))~\ocwlowerid{n}~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{n'}~=~\ocwlowerid{restrict\_relation}~(\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{x}~\ocwlowerid{y})~\ocwlowerid{n'}~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
\ocwkw{match}~$(\ocwupperid{SetofRecord.}\ocwlowerid{cardinal}~\ocwlowerid{n'})~$\ocwkw{with}\ocweol
\ocwindent{4.00em}
1~$\rightarrow{}~\ocwlowerid{rbcr}~\ocwlowerid{m}~(\ocwlowerid{restrict}~\ocwlowerid{y}~(\ocwupperid{SetofRecord.}\ocwlowerid{choose}~\ocwlowerid{n'}))~$\ocwbc{} (C-Match) \ocwec{}\ocweol
\ocwindent{3.00em}
$\mid{}~0~\rightarrow{}~\ocwlowerid{m}~$\ocwbc{} C-NoMatch \ocwec{}\ocweol
\ocwindent{3.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}$\ocweol
\ocwindent{5.50em}
\ocwstring{"multiple\ocwvspace{}match\ocwvspace{}\%s\ocwvspace{}under\ocwvspace{}functional\ocwvspace{}dependency\ocwvspace{}\%s@."}~\ocweol
\ocwindent{12.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_relation}~\ocwlowerid{n'})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fd}~(\ocwlowerid{x},\ocwlowerid{y})))$\medskip

\ocwendcode{}\ocwindent{0.00em}
record revision of $m$ to $n$ under set of functional dependencies $F$ 
\ocweol
\ocwindent{0.00em}
$m \recordrevision{L}{F} n$ 
\ocweol
\label{rellens.ml:16109}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{record\_revision}~(\ocwlowerid{m}:\ocwlowerid{record})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{l}:\ocwlowerid{relation})~:~\ocwlowerid{record}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwupperid{SetofFD.}\ocwlowerid{is\_empty}~\ocwlowerid{fds}~$\ocweol
\ocwindent{1.00em}
\ocwkw{then}~$\ocwlowerid{m}~$\ocwbc{} (FC-Empty) \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{else}~\ocwbc{} (FC-Step) \ocwec{}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{models\_fds}~\ocwlowerid{l}~\ocwlowerid{fds})~$\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocweol
\ocwindent{5.50em}
\ocwstring{"relation\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}satisfy\ocwvspace{}functional\ocwvspace{}dependencies\ocwvspace{}\%s@."}~\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_relation}~\ocwlowerid{l})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fds}~\ocwlowerid{fds}))$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~\ocwbc{} $L \models F,X\to Y$ \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fds})~$\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocweol
\ocwindent{3.00em}
\ocwkw{else}~\ocwbc{} $F,X\to Y$ is in tree form \ocwec{}\ocweol
\ocwindent{4.00em}
\ocwbc{} choose an FD with root on its left \ocwec{}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{fd}~=~$\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$\ocwlowerid{rS}~=~\ocwlowerid{roots}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{choose}$\ocweol
\ocwindent{6.00em}
$(\ocwupperid{SetofFD.}\ocwlowerid{filter}~($\ocwkw{fun}~$(\ocwlowerid{x'},\ocwlowerid{y'})~\rightarrow{}$\ocweol
\ocwindent{7.00em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{mem}~\ocwlowerid{x'}~\ocwlowerid{rS})~\ocwlowerid{fds})~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{\_}~=~\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"x\symbol{45}\ensuremath{>}y\ocwvspace{}=\ocwvspace{}\%a@."}~$\ocwlowerid{pp\_fd}~\ocwlowerid{fd}~$\ocwkw{in}~\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{f}~=~\ocwupperid{SetofFD.}\ocwlowerid{remove}~\ocwlowerid{fd}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{\_}~=~\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"f\ocwvspace{}=\ocwvspace{}\%a@."}~$\ocwlowerid{pp\_fds}~\ocwlowerid{f}~$\ocwkw{in}~\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{m'}~=~\ocwlowerid{sdrr}~\ocwlowerid{m}~\ocwlowerid{fd}~\ocwlowerid{l}~$\ocwkw{in}\ocweol
\ocwindent{8.50em}
$\ocwlowerid{record\_revision}~\ocwlowerid{m'}~\ocwlowerid{f}~\ocwlowerid{l}$\medskip

\ocwendcode{}\ocwindent{0.00em}
relation revision  
\ocweol
\ocwindent{0.00em}
$M \leftarrow_F L = \{ m'\mid m \recordrevision{L}{F} m'\ \text{for some}\ m \in M\}$ 
\ocweol
\label{rellens.ml:17161}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{relation\_revision}~(\ocwlowerid{m}:\ocwlowerid{relation})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{l}:\ocwlowerid{relation})~:~\ocwlowerid{relation}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{m}~\ocwlowerid{ms}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{add}~(\ocwlowerid{record\_revision}~\ocwlowerid{m}~\ocwlowerid{fds}~\ocwlowerid{l})~\ocwlowerid{ms})~\ocwlowerid{m}~\ocwupperid{SetofRecord.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
relational merge 
\ocweol
\ocwindent{0.00em}
$M \relationalmerge{F} L = M \leftarrow_F L \cup L$  
\ocweol
\label{rellens.ml:17467}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{relational\_merge}~(\ocwlowerid{m}:\ocwlowerid{relation})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{l}:\ocwlowerid{relation})~:~\ocwlowerid{relation}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{union}~(\ocwlowerid{relation\_revision}~\ocwlowerid{m}~\ocwlowerid{fds}~\ocwlowerid{l})~\ocwlowerid{l}$\medskip

\ocwendcode{}\ocwindent{0.00em}
sort function $sort(R)$ 
\ocweol
\label{rellens.ml:17627}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{sort}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~:~\ocwlowerid{sort}~=~$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{fst}~(\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{db})$\medskip

\ocwendcode{}\ocwindent{0.00em}
instance $I(R)$ 
\ocweol
\label{rellens.ml:17722}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{instance}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~:~\ocwlowerid{relation}~=$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{snd}~(\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{db})$\medskip

\ocwendcode{}\ocwindent{0.00em}
functional dependencies of relation $R$ : $\mathit{fd}(R)$ 
\ocweol
\label{rellens.ml:17867}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{fd}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~:~\ocwupperid{SetofFD.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{fds}),\ocwlowerid{\_})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{fds}$\medskip

\ocwendcode{}\ocwindent{0.00em}
select lens 
\ocweol
\ocwindent{0.00em}
$\frac{
\begin{array}{c}
  \mi{sort}(R) = (U,Q,F)\\
  \mi{sort}(S) = (U,P\cap Q,F) \\
 F\ \text{is in tree form} \quad Q\ \text{ignores}\ \mi{outputs}(F)
\end{array}}
{\begin{array}{c}
\mt{select\ from}\ R\ \mt{where}\ P\ \mt{as}\ S \in\\
\Sigma \uplus \{R\} \Leftrightarrow \Sigma \uplus \{S\}
\end{array}
}\ \text{(\textsc{T-Select})}
$

\ocweol
\ocwindent{0.00em}
type check and inference for select 
\ocweol
\label{rellens.ml:18411}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{typeinf\_select}~(\ocwlowerid{p}:\ocwlowerid{phrase})~(\ocwlowerid{srt}:\ocwlowerid{sort})~:~\ocwlowerid{sort}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{tenv},\ocwlowerid{q},\ocwlowerid{fds})~=~\ocwlowerid{srt}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwlowerid{qtype}~\ocwlowerid{tenv}~\ocwlowerid{p}~\not=~\ocwupperid{TBol}~$\ocwkw{then}~$\ocwlowerid{failwith}~$\ocweol
\ocwindent{3.50em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}$\ocweol
\ocwindent{4.50em}
\ocwstring{"typeinf\_select:\ocwvspace{}non\symbol{45}boolean\ocwvspace{}predicate\ocwvspace{}\%s@."}~$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{p}))~$\ocwkw{else}\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fds})~$\ocwbc{} check tree form \ocwec{}~\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}~\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{o\_fds}~=~\ocwlowerid{outputs}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{ignores}~\ocwlowerid{q}~\ocwlowerid{o\_fds})~$\ocwbc{} check if $Q$ ignores $outputs(F)$ \ocwec{}~\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"predicate\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}ignore\ocwvspace{}outputs(\%s)=\%s@."}~\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{q})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fds}~\ocwlowerid{fds})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{o\_fds}))~$\ocwkw{else}\ocweol
\ocwindent{2.50em}
$(\ocwlowerid{u},\ocwlowerid{tenv},\ocwupperid{PAnd}~(\ocwlowerid{p},\ocwlowerid{q}),\ocwlowerid{fds})$\medskip

\ocwendcode{}\ocwindent{0.00em}
get part of select lens 
\ocweol
\ocwindent{0.00em}
$v\lget(I) = I\setminus_R[S\mapsto P\cap I(R)]$ 
\ocweol
\label{rellens.ml:19080}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{get\_select}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{p}:\ocwlowerid{phrase})~(\ocwlowerid{s}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{relation})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{sortS}~=~\ocwlowerid{typeinf\_select}~\ocwlowerid{p}~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{db'}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~(\ocwlowerid{sortS},\ocwupperid{SetofRecord.}\ocwlowerid{filter}~$\ocweol
\ocwindent{11.50em}
$($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{p})~\ocwlowerid{relation})~\ocwlowerid{db'}$\medskip

\ocwendcode{}\ocwindent{0.00em}
put part of select lens 
\ocweol
\ocwindent{0.00em}
$
 \begin{array}{rcl}
            v\lput(J,I) &=& J{\setminus_S}[R\mapsto M_0 \setminus N_\#]\\
  \text{where}\quad M_0 &=& (\neg P \cap I(R))\relationalmerge{F} J(S)\\
                   N_\# &=& (P \cap M_0) \setminus J(S) \\
                      F &=& fd(R)
 \end{array}
$ 
\ocweol
\label{rellens.ml:19693}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{put\_select}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{p}~:~\ocwlowerid{phrase})~(\ocwlowerid{s}:\ocwlowerid{rname})~$\ocweol
\ocwindent{2.00em}
$((\ocwlowerid{dbJ},\ocwlowerid{dbI}):~(\ocwlowerid{database}~\times{}~\ocwlowerid{database}))~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{fds})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{iR'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~(\ocwupperid{PNot}~\ocwlowerid{p}))~\ocwlowerid{iR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{\_}~,\ocwlowerid{jS})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{m0}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iR'}~\ocwlowerid{fds}~\ocwlowerid{jS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{n\_sharp}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~(\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~(\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{p}))~\ocwlowerid{m0})~\ocwlowerid{jS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~(\ocwlowerid{sortR},\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{m0}~\ocwlowerid{n\_sharp})~\ocwlowerid{dbI'}$\medskip

\ocwendcode{}\ocwindent{0.00em}
join of two predicates $P \bowtie Q$

  $p,q : record \to bool$

  $p \bowtie q$ is true for a record $r$ in 
         $\{rp \mid r \in U,p\ rp\} \bowtie \{rq \mid rq \in V, q\ rq\}$

  $\sem{P \bowtie Q}_r$ is true for a record $r$ in 
         $\{r \mid r \in U,\sem{P}_r\} \bowtie \{r \mid r \in V, \sem{Q}_r\}$

  Example

  $\begin{array}{lrr}
     p: &a\times b\times c&                \to bool  \\
     q: &                c&\times d\times e\to bool
    \end{array}$

   for overlapped atributes, they are equal.

   so  $p \bowtie q = \lambda r \to p\ r[U] \wedge q\ r[V]$

       $\sem{P \bowtie Q}_r = \sem{P}_r \wedge \sem{Q}_r$

 
\ocweol
\ocwindent{0.00em}
$\frac{
\begin{array}{c}
  \mi{sort}(R) = (U,P,F) \quad \mi{sort}(S) = (V,Q,G) \\
  \mi{sort}(T) = (UV,P\bowtie Q,F \cup G) \\
  G \models U \cap V \to V \\
 F\ \text{is in tree form} \quad G\ \text{is in tree form}  \\
  P\ \text{ignores}\ \mi{outputs}(F) \quad Q\ \text{ignores}\ \mi{outputs}(G)
\end{array}}
{
\begin{array}{c}
\mt{join\_dl}\ R,S\ \mt{as}\ T\ \in\ \Sigma \uplus \{R,S\} \Leftrightarrow \Sigma \uplus \{T\}
\end{array}
}\ \text{(\textsc{T-Join})}
$

\ocweol
\ocwindent{0.00em}
type check and inference for join 
\ocweol
\label{rellens.ml:21405}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{typeinf\_join\_dl}~(\ocwlowerid{sortR}:\ocwlowerid{sort})~(\ocwlowerid{sortS}:\ocwlowerid{sort})~:~\ocwlowerid{sort}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{uR},\ocwlowerid{tenvR},\ocwlowerid{predR},\ocwlowerid{fdsR}))~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fdsR})~$\ocwbc{} check tree form \ocwec{}~\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}~\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{o\_fdsR}~=~\ocwlowerid{outputs}~\ocwlowerid{fdsR}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{ignores}~\ocwlowerid{predR}~\ocwlowerid{o\_fdsR})~$\ocwbc{} check if $P$ ignores $outputs(F)$ \ocwec{}~\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"predicate\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}ignore\ocwvspace{}outputs(\%s)=\%s@."}~\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{predR})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fds}~\ocwlowerid{fdsR})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{o\_fdsR}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{uS},\ocwlowerid{tenvS},\ocwlowerid{predS},\ocwlowerid{fdsS}))~=~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fdsS})~$\ocwbc{} check tree form \ocwec{}~\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}~\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{o\_fdsS}~=~\ocwlowerid{outputs}~\ocwlowerid{fdsS}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{ignores}~\ocwlowerid{predS}~\ocwlowerid{o\_fdsS})~$\ocwbc{} check if $Q$ ignores $outputs(G)$ \ocwec{}~\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"predicate\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}ignore\ocwvspace{}outputs(\%s)=\%s@."}~\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{predS})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fds}~\ocwlowerid{fdsS})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{o\_fdsS}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortT}~=~(\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{uR}~\ocwlowerid{uS},$\ocweol
\ocwindent{7.50em}
$\ocwlowerid{merge\_tenv}~\ocwlowerid{tenvR}~\ocwlowerid{tenvS},$\ocweol
\ocwindent{18.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{predR},\ocwlowerid{predS})$\ocweol
\ocwindent{10.00em}
,\ocweol
\ocwindent{10.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{union}~\ocwlowerid{fdsR}~\ocwlowerid{fdsS})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{sortT}$\medskip

\ocwendcode{}\ocwindent{0.00em}
\\ get part of join lens 
\ocweol
\ocwindent{0.00em}
$v\lget(I) = I{\setminus_{R,S}}[T\mapsto I(R)\bowtie I(S)]$ 
\ocweol
\ocwindent{0.00em}
TODO: check if $G \models U \cap V \to V$ 
\ocweol
\label{rellens.ml:22676}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{get\_join\_dl}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{s}:\ocwlowerid{rname})~(\ocwlowerid{t}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortS},\ocwlowerid{iS})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortT}~=~\ocwlowerid{typeinf\_join\_dl}~\ocwlowerid{sortR}~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{instanceT}~=~\ocwlowerid{nat\_join}~\ocwlowerid{iR}~\ocwlowerid{iS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{db}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{db}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{t}~(\ocwlowerid{sortT},\ocwlowerid{instanceT})~\ocwlowerid{db}$\medskip

\ocwendcode{}\ocwindent{0.00em}
put part of join lens 
\ocweol
\ocwindent{0.00em}
$
  \begin{array}{rcl}
  v\lput(J,I)       &=& J{\setminus_T}[R\mapsto M][S\mapsto N]\\
  \text{where}\quad (U,P,F) &=& \mi{sort}(R)                  \\
                    (V,Q,G) &=& \mi{sort}(S)                  \\
                       M_0  &=& I(R)\relationalmerge{F}J(T)[U]\\
                         N  &=& I(S)\relationalmerge{G}J(T)[V]\\
                         L  &=& (M_0 \bowtie N) \setminus J(T)\\
                         M  &=& M_0 \setminus L[U]
  \end{array}
$ 
\ocweol
\label{rellens.ml:23545}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{put\_join\_dl}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{s}:\ocwlowerid{rname})~(\ocwlowerid{t}:\ocwlowerid{rname})$\ocweol
\ocwindent{2.00em}
$((\ocwlowerid{dbJ},\ocwlowerid{dbI}):(\ocwlowerid{database}\times{}\ocwlowerid{database}))~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{f})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortS},\ocwlowerid{iS})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{v},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{g})~=~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortT},\ocwlowerid{jT})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{t}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{m0}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iR}~\ocwlowerid{f}~(\ocwlowerid{restrict\_relation}~\ocwlowerid{u}~\ocwlowerid{jT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{n}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iS}~\ocwlowerid{g}~(\ocwlowerid{restrict\_relation}~\ocwlowerid{v}~\ocwlowerid{jT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{l}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~(\ocwlowerid{nat\_join}~\ocwlowerid{m0}~\ocwlowerid{n})~\ocwlowerid{jT}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{m}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{m0}~(\ocwlowerid{restrict\_relation}~\ocwlowerid{u}~\ocwlowerid{l})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{t}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~(\ocwlowerid{sortR},\ocwlowerid{m})~\ocwlowerid{dbI'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~(\ocwlowerid{sortS},\ocwlowerid{n})~\ocwlowerid{dbI'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{dbI'}$\medskip

\ocwendcode{}\ocwindent{0.00em}
Union lens (not part of Bohannon's relational lenses, but necessary to encode
our integration scenario) 
\ocweol
\ocwindent{0.00em}
$\frac{
\begin{array}{c}
  \mi{sort}(R) = (U,P,F) \quad \mi{sort}(S) = (V,Q,G) \\
  \mi{sort}(T) = (U,P\cup Q,F) \\
  U = V \quad F \equiv G \\
 F\ \text{is in tree form} \quad G\ \text{is in tree form} \quad \textit{(tentative)} \\
  P\ \text{ignores}\ \mi{outputs}(F) \quad Q\ \text{ignores}\ \mi{outputs}(G) \quad\textit{(tentative)}
\end{array}}
{
\begin{array}{c}
\mt{union}\ R,S\ \mt{as}\ T\ \in\ \Sigma \uplus \{R,S\} \Leftrightarrow \Sigma \uplus \{T\}
\end{array}
}\ \text{(\textsc{T-Union})}
$

\ocweol
\ocwindent{0.00em}
{} 
\ocweol
\ocwindent{0.00em}
type check and inference for union 
\ocweol
\label{rellens.ml:24878}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{typeinf\_union}~(\ocwlowerid{sortR}:\ocwlowerid{sort})~(\ocwlowerid{sortS}:\ocwlowerid{sort})~:~\ocwlowerid{sort}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{uR},\ocwlowerid{tenvR},\ocwlowerid{predR},\ocwlowerid{fdsR}))~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fdsR})~$\ocwbc{} check tree form \ocwec{}~\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{o\_fdsR}~=~\ocwlowerid{outputs}~\ocwlowerid{fdsR}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{ignores}~\ocwlowerid{predR}~\ocwlowerid{o\_fdsR})~$\ocwbc{} check if $P$ ignores $outputs(F)$ \ocwec{}~\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"predicate\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}ignore\ocwvspace{}outputs(\%s)=\%s@."}~\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{predR})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fds}~\ocwlowerid{fdsR})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{o\_fdsR}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{uS},\ocwlowerid{tenvS},\ocwlowerid{predS},\ocwlowerid{fdsS}))~=~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{is\_tree}~\ocwlowerid{fdsS})~$\ocwbc{} check tree form \ocwec{}~\ocwkw{then}~$\ocwlowerid{raise}~\ocwupperid{Not\_in\_Tree\_Form}~$\ocwkw{else}~\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{o\_fdsS}~=~\ocwlowerid{outputs}~\ocwlowerid{fdsS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwlowerid{ignores}~\ocwlowerid{predS}~\ocwlowerid{o\_fdsS})~$\ocwbc{} check if $Q$ ignores $outputs(G)$ \ocwec{}~\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"predicate\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}ignore\ocwvspace{}outputs(\%s)=\%s@."}\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{predS})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_fds}~\ocwlowerid{fdsS})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{o\_fdsS}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwupperid{MapofAttr.}\ocwlowerid{equal}~(=)~\ocwlowerid{tenvR}~\ocwlowerid{tenvS})~$\ocwkw{then}~$\ocwlowerid{failwith}~$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"incompatible\ocwvspace{}type\ocwvspace{}environments:\ocwvspace{}\%s\ocwvspace{}\%s@."}~$(\ocwlowerid{toStr}~\ocwlowerid{pp\_tenv}~\ocwlowerid{tenvR})$\ocweol
\ocwindent{6.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_tenv}~\ocwlowerid{tenvS}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwbc{} TODO: current check is syntactical equivalence, which is too strong  \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwupperid{SetofFD.}\ocwlowerid{equal}~\ocwlowerid{fdsR}~\ocwlowerid{fdsS})~$\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"incompatible\ocwvspace{}FDs:\ocwvspace{}\%s\ocwvspace{}\%s@."}~$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofFD}~\ocwlowerid{fdsR})$\ocweol
\ocwindent{6.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofFD}~\ocwlowerid{fdsS}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortT}~=~(\ocwlowerid{uR},$\ocweol
\ocwindent{7.50em}
$\ocwlowerid{tenvR},$\ocweol
\ocwindent{10.00em}
$\ocwupperid{POr}~(\ocwlowerid{predR},\ocwlowerid{predS}),$\ocweol
\ocwindent{10.00em}
$\ocwlowerid{fdsR})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{sortT}$\medskip

\ocwendcode{}\ocwindent{0.00em}
get part of union lens 
\ocweol
\ocwindent{0.00em}
$v\lget(I) = I{\setminus_{R,S}}[T\mapsto I(R) \relationalmerge{F} I(S)]$ 
\ocweol
\ocwindent{0.00em}
TODO: determine necessary condition and check
   in particular, simple record union may violate FD. it should be checked 
   at run time. 
\ocweol
\label{rellens.ml:26473}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{get\_union}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{s}:\ocwlowerid{rname})~(\ocwlowerid{t}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortS},\ocwlowerid{iS})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortT}~=~\ocwlowerid{typeinf\_union}~\ocwlowerid{sortR}~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{uT},\ocwlowerid{tenvT},\ocwlowerid{predT},\ocwlowerid{fdsT}))~=~\ocwlowerid{sortT}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{instanceT}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iR}~\ocwlowerid{fdsT}~\ocwlowerid{iS}~$\ocwkw{in}~\ocwbc{} TODO check conflict in merge.
						  currently, S wins. (by rbcr) \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{db}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{db}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{t}~(\ocwlowerid{sortT},\ocwlowerid{instanceT})~\ocwlowerid{db}$\medskip

\label{rellens.ml:26951}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{put\_union}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{s}:\ocwlowerid{rname})~(\ocwlowerid{t}:\ocwlowerid{rname})$\ocweol
\ocwindent{2.00em}
$((\ocwlowerid{dbJ},\ocwlowerid{dbI}):(\ocwlowerid{database}\times{}\ocwlowerid{database}))~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{predR},\ocwlowerid{f})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortS},\ocwlowerid{iS})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{v},\ocwlowerid{\_},\ocwlowerid{predS},\ocwlowerid{g})~=~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortT},\ocwlowerid{jT})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{t}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{v},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{fdsT})~=~\ocwlowerid{sortT}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{jT\_org}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iR}~\ocwlowerid{fdsT}~\ocwlowerid{iS}~$\ocwkw{in}~\ocwbc{} TODO check conflict in merge \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{delT}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{jT\_org}~\ocwlowerid{jT}~$\ocwkw{in}~\ocwbc{} deleted records \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{insT}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{jT}~\ocwlowerid{jT\_org}~$\ocwkw{in}~\ocwbc{} inserted records \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{iR'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{iR}~\ocwlowerid{delT}~$\ocwkw{in}~\ocwbc{} delete if match \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{iS'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{iS}~\ocwlowerid{delT}~$\ocwkw{in}~\ocwbc{} delete if match \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{iR'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{union}~\ocwlowerid{iR'}~(\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{predR})~\ocwlowerid{insT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{iS'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{union}~\ocwlowerid{iS'}~(\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{predS})~\ocwlowerid{insT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{t}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~(\ocwlowerid{sortR},\ocwlowerid{iR'})~\ocwlowerid{dbI'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~(\ocwlowerid{sortS},\ocwlowerid{iS'})~\ocwlowerid{dbI'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{dbI'}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mt{change\_set}\ T\ T' =
 \{(t,-1)\mid t\in T\setminus T'\} \cup
 \{(t, 0)\mid t\in T\cap      T'\} \cup
 \{(t,+1)\mid t\in T'\setminus T\}
 $ 
\ocweol
\label{rellens.ml:28090}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{change\_set}~(\ocwlowerid{table}:\ocwlowerid{relation})~(\ocwlowerid{table'}:\ocwlowerid{relation})~:~\ocwupperid{SetofChange.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$\ocwlowerid{sDelete}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{t}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{add}~(\ocwlowerid{t},\ocwupperid{Delete}))~(\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{table}~\ocwlowerid{table'})~\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwkw{in}\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$\ocwlowerid{sKeep}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{t}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{add}~(\ocwlowerid{t},\ocwupperid{Keep}))~(\ocwupperid{SetofRecord.}\ocwlowerid{inter}~\ocwlowerid{table}~\ocwlowerid{table'})~\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwkw{in}\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$\ocwlowerid{sInsert}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{t}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{add}~(\ocwlowerid{t},\ocwupperid{Insert}))~(\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{table'}~\ocwlowerid{table})~\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{union}~(\ocwupperid{SetofChange.}\ocwlowerid{union}~\ocwlowerid{sDelete}~\ocwlowerid{sKeep})~\ocwlowerid{sInsert}$\medskip

\ocwendcode{}\ocwindent{0.00em}
relational delta merge 
\ocweol
\ocwindent{0.00em}
$M \relationaldeltamerge{F} \Delta N = 
  (M - \{ t \mid (t,m)\in \Delta N \wedge m = -1\}) 
          \relationalmerge{F} 
       \{ t \mid (t,m)\in \Delta N \wedge m = +1\}$  
\ocweol
\label{rellens.ml:28865}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{relational\_delta\_merge}~(\ocwlowerid{m}:\ocwlowerid{relation})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{n}:\ocwupperid{SetofChange.}\ocwlowerid{t})~:~\ocwlowerid{relation}~=~$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{relational\_merge}~$\ocweol
\ocwindent{2.00em}
$(\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{m}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{rs}~\rightarrow{}$\ocweol
\ocwindent{8.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~$\ocwkw{then}~$\ocwupperid{SetofRecord.}\ocwlowerid{add}~\ocwlowerid{t}~\ocwlowerid{rs}~$\ocwkw{else}~$\ocwlowerid{rs})~\ocwlowerid{n}~\ocwupperid{SetofRecord.}\ocwlowerid{empty}))$\ocweol
\ocwindent{2.00em}
$\ocwlowerid{fds}$\ocweol
\ocwindent{2.00em}
$(\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{rs}~\rightarrow{}$\ocweol
\ocwindent{8.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Insert}~$\ocwkw{then}~$\ocwupperid{SetofRecord.}\ocwlowerid{add}~\ocwlowerid{t}~\ocwlowerid{rs}~$\ocwkw{else}~$\ocwlowerid{rs})~\ocwlowerid{n}~\ocwupperid{SetofRecord.}\ocwlowerid{empty})$\medskip

\ocwendcode{}\ocwindent{0.00em}
match on 
\ocweol
\ocwindent{0.00em}
$\mt{match\ on}\ t\ t'\ X = (t[X] = t'[X]) = \bigwedge\{t[A]=t'[A]\mid A\in X\}$ 
\ocweol
\label{rellens.ml:29375}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{match\_on}~(\ocwlowerid{t}:\ocwlowerid{record})~(\ocwlowerid{t'}:\ocwlowerid{record})~(\ocwlowerid{cols}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwlowerid{record\_equal}~(\ocwlowerid{restrict}~\ocwlowerid{cols}~\ocwlowerid{t})~(\ocwlowerid{restrict}~\ocwlowerid{cols}~\ocwlowerid{t'})$\medskip

\ocwendcode{}\ocwindent{0.00em}
unflatten list of phrases as conjunction 
\ocweol
\label{rellens.ml:29539}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{uf\_and}~(\ocwlowerid{l}:\ocwlowerid{phrase}~$\ocwbt{list}$)~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{2.00em}
\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{2.50em}
$[\,]~\rightarrow{}~\ocwupperid{PCns}~(\ocwupperid{Bol}~$\ocwkw{true}$)$\ocweol
\ocwindent{2.00em}
$\mid{}[\ocwlowerid{p}]~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{2.00em}
$\mid{}\ocwlowerid{p}::\ocwlowerid{ps}~\rightarrow{}~\ocwupperid{PAnd}~(\ocwlowerid{p},\ocwlowerid{uf\_and}~\ocwlowerid{ps})$\medskip

\ocwendcode{}\ocwindent{0.00em}
unflatten list of phrases as disjunction 
\ocweol
\label{rellens.ml:29728}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{uf\_or}~(\ocwlowerid{l}:\ocwlowerid{phrase}~$\ocwbt{list}$)~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{2.00em}
\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{2.50em}
$[\,]~\rightarrow{}~\ocwupperid{PCns}~(\ocwupperid{Bol}~$\ocwkw{false}$)$\ocweol
\ocwindent{2.00em}
$\mid{}[\ocwlowerid{p}]~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{2.00em}
$\mid{}\ocwlowerid{p}::\ocwlowerid{ps}~\rightarrow{}~\ocwupperid{POr}~(\ocwlowerid{p},\ocwlowerid{uf\_or}~\ocwlowerid{ps})$\medskip

\ocwendcode{}\ocwindent{0.00em}
production of expression to compare all columns in $\mi{cols}$ to a record $t$ 
\ocweol
\ocwindent{0.00em}
$\qquote{\bigwedge\sem{\{\qquote{\sem{c}=\sem{t[c]}} \mid c\in \mi{cols} \} } }$ 
\ocweol
\label{rellens.ml:30041}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{match\_on\_expr}~(\ocwlowerid{t}:\ocwlowerid{record})~(\ocwlowerid{cols}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{col\_list}~=~\ocwupperid{SetofAttr.}\ocwlowerid{elements}~\ocwlowerid{cols}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{phrase\_list}~=~\ocwupperid{List.}\ocwlowerid{map}~($\ocwkw{fun}~$\ocwlowerid{c}~\rightarrow{}~\ocwupperid{PEq}~(\ocwupperid{PVar}~\ocwlowerid{c},\ocwupperid{PCns}~(\ocwlowerid{attribute}~\ocwlowerid{c}~\ocwlowerid{t})))~\ocwlowerid{col\_list}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{uf\_and}~\ocwlowerid{phrase\_list}$\medskip

\ocwendcode{}\ocwindent{0.00em}
multiplicity is complement with each other : $m = -m'$ 
\ocweol
\label{rellens.ml:30313}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{is\_compl}~(\ocwlowerid{m}:\ocwlowerid{mult})~(\ocwlowerid{m'}:\ocwlowerid{mult})~:~$\ocwbt{bool}~=~\ocweol
\ocwindent{1.00em}
$(\ocwlowerid{m},\ocwlowerid{m'})=(\ocwupperid{Insert},\ocwupperid{Delete})~\lor{}~(\ocwlowerid{m},\ocwlowerid{m'})=(\ocwupperid{Delete},\ocwupperid{Insert})$\medskip

\ocwendcode{}\ocwindent{0.00em}
complement rows 
\ocweol
\ocwindent{0.00em}
not sure if attributes key should always be indeed keys 
\ocweol
\ocwindent{0.00em}
$\{(t',m')\mid (t',m')\in\Delta R,t[key]=t'[key],m'=-m\}$ 
\ocweol
\label{rellens.ml:30555}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compl\_rows}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{key}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwupperid{SetofChange.}\ocwlowerid{t}~$\ocweol
\ocwindent{0.00em}
=~$\ocwupperid{SetofChange.}\ocwlowerid{filter}~($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~$\ocweol
\ocwindent{2.00em}
$\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~\ocwlowerid{key}~\land{}~\ocwlowerid{is\_compl}~\ocwlowerid{m}~\ocwlowerid{m'})~\ocwlowerid{dR}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mt{get\_fd\_updates}\ \Delta R\ (X\to Y) = 
  (X\to Y,\{(t[X],t[Y]) \mid (t,+1) \in \Delta R\}) $ 
\ocweol
\label{rellens.ml:30834}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{get\_fd\_updates}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~((\ocwlowerid{x},\ocwlowerid{y}):\ocwlowerid{fd})~:~\ocwlowerid{fd}~\times{}~\ocwupperid{SetofPRecord.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
$((\ocwlowerid{x},\ocwlowerid{y}),~\ocwupperid{SetofChange.}\ocwlowerid{fold}$\ocweol
\ocwindent{6.00em}
$($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{6.50em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Insert}~$\ocwkw{then}~$\ocwupperid{SetofPRecord.}\ocwlowerid{add}~(\ocwlowerid{restrict}~\ocwlowerid{x}~\ocwlowerid{t},\ocwlowerid{restrict}~\ocwlowerid{y}~\ocwlowerid{t})~\ocwlowerid{ss}$\ocweol
\ocwindent{6.50em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{dR}~\ocwupperid{SetofPRecord.}\ocwlowerid{empty})$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\{\mathtt{get\_fd\_updates}\ \Delta R\ f \mid f \in F \}$ 
\ocweol
\label{rellens.ml:31157}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{get\_updateset}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{f}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofFDSPRecord.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{fd}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofFDSPRecord.}\ocwlowerid{add}~(\ocwlowerid{get\_fd\_updates}~\ocwlowerid{dR}~\ocwlowerid{fd}))~\ocwlowerid{f}~\ocwupperid{SetofFDSPRecord.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mt{var\_case\_expr}\ \mi{map}\ c\ \mi{or}\ (X\to Y) := \\
\qquote{\CASE \\
\phantom{aaa} \sem{\{\qquote{\WHEN\ \sem{\mt{match\_on\_expr}\ t\ X}\ \THEN\ \sem{t'[c]}}\mid
      (t,t') \in \mi{map} \}} \\
\quad \ELSE \sem{\mi{or}} \END
}$ 
\ocweol
\label{rellens.ml:32886}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{var\_case\_expr}~(\ocwlowerid{map}~:~\ocwupperid{SetofPRecord.}\ocwlowerid{t})~(\ocwlowerid{attr}:\ocwlowerid{attr})~(\ocwlowerid{or\_phrase}:\ocwlowerid{phrase})~(\ocwlowerid{fd}:\ocwlowerid{fd})~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{where\_clause\_list}~=~\ocwupperid{List.}\ocwlowerid{map}$\ocweol
\ocwindent{2.00em}
$($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{v})~\rightarrow{}~(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~(\ocwlowerid{fst}~\ocwlowerid{fd}),\ocwupperid{PCns}~(\ocwlowerid{attribute}~\ocwlowerid{attr}~\ocwlowerid{v})))~$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{SetofPRecord.}\ocwlowerid{elements}~\ocwlowerid{map})~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$\ocwupperid{PCase}~(\ocwlowerid{where\_clause\_list},~\ocwlowerid{or\_phrase})$\medskip

\label{rellens.ml:33162}%
\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{calc\_updated\_var\_expr}~(\ocwlowerid{chl}~:~\ocwupperid{SetofFDSPRecord.}\ocwlowerid{t})$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{key}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{col}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{attr}:\ocwlowerid{attr})~(\ocwlowerid{or\_phrase}:\ocwlowerid{phrase})~$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{map}:~\ocwupperid{SetofPRecord.}\ocwlowerid{t}~$\ocwbt{option}$)~:~\ocwlowerid{phrase}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{f},\ocwlowerid{changes})~=$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{s}~=~\ocwupperid{SetofFDSPRecord.}\ocwlowerid{filter}$\ocweol
\ocwindent{5.50em}
$($\ocwkw{fun}~$((\ocwlowerid{x},\ocwlowerid{y}),\ocwlowerid{changes})~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{equal}~\ocwlowerid{col}~\ocwlowerid{y})~\ocwlowerid{chl}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{\_}~=~\ocwupperid{Format.}\ocwlowerid{printf}~$\ocwstring{"s=\%a@."}~$\ocwlowerid{pp\_SetofFDSPRecord}~\ocwlowerid{s}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{match}~$\ocwupperid{SetofFDSPRecord.}\ocwlowerid{cardinal}~\ocwlowerid{s}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
1~$\rightarrow{}~\ocwupperid{SetofFDSPRecord.}\ocwlowerid{choose}~\ocwlowerid{s}~$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~$\ocweol
\ocwindent{5.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"invalid\ocwvspace{}cardinality\ocwvspace{}\%i\ocwvspace{}of\ocwvspace{}s\ocwvspace{}\%s@."}~$(\ocwupperid{SetofFDSPRecord.}\ocwlowerid{cardinal}~\ocwlowerid{s})$\ocweol
\ocwindent{6.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofFDSPRecord}~\ocwlowerid{s}))~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{map'}~=~$\ocwkw{match}~$\ocwlowerid{map}~$\ocwkw{with}~\ocweol
\ocwindent{2.00em}
$\ocwupperid{None}~\rightarrow{}~\ocwlowerid{changes}~$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Some}~\ocwlowerid{map}~\rightarrow{}~$\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{m}~=~$\ocweol
\ocwindent{5.50em}
$\ocwupperid{SetofPRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{k},\ocwlowerid{k'})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{4.00em}
$(\ocwupperid{SetofPRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{k''},\ocwlowerid{v})~\ocwlowerid{ss'}~\rightarrow{}$\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{record\_equal}~\ocwlowerid{k'}~\ocwlowerid{k''}~$\ocwkw{then}~$\ocwupperid{SetofPRecord.}\ocwlowerid{add}~(\ocwlowerid{k},\ocwlowerid{v})~\ocwlowerid{ss'}$\ocweol
\ocwindent{5.00em}
\ocwkw{else}~$\ocwlowerid{ss'})~\ocwlowerid{map}~\ocwlowerid{ss}))~\ocwlowerid{changes}~\ocwupperid{SetofPRecord.}\ocwlowerid{empty}~$\ocwkw{in}~\ocweol
\ocwindent{3.00em}
$\ocwupperid{Format.}\ocwlowerid{printf}~$\ocwstring{"m=\%a@."}~$\ocwlowerid{pp\_SetofPRecord}~\ocwlowerid{m};\ocwlowerid{m}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~\ocwbc{} SetofAttr.equal key (fst f) \ocwec{}\ocweol
\ocwindent{2.50em}
$\ocwupperid{SetofAttr.}\ocwlowerid{subset}~(\ocwlowerid{fst}~\ocwlowerid{f})~\ocwlowerid{key}~$\ocweol
\ocwindent{2.50em}
\ocwkw{then}\ocweol
\ocwindent{2.00em}
$\ocwlowerid{var\_case\_expr}~\ocwlowerid{map'}~\ocwlowerid{attr}~\ocwlowerid{or\_phrase}~\ocwlowerid{f}$\ocweol
\ocwindent{1.00em}
\ocwkw{else}\ocweol
\ocwindent{2.00em}
$\ocwlowerid{calc\_updated\_var\_expr}~\ocwlowerid{chl}~\ocwlowerid{key}~(\ocwlowerid{fst}~\ocwlowerid{f})~$\ocweol
\ocwindent{3.00em}
$\ocwlowerid{attr}~(\ocwlowerid{var\_case\_expr}~\ocwlowerid{map'}~\ocwlowerid{attr}~\ocwlowerid{or\_phrase}~\ocwlowerid{f})~(\ocwupperid{Some}~\ocwlowerid{map'})$\medskip

\label{rellens.ml:34304}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{updated\_var\_expr}~(\ocwlowerid{chl}:~\ocwupperid{SetofFDSPRecord.}\ocwlowerid{t})~(\ocwlowerid{key}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{col}:\ocwlowerid{attr})$\ocweol
\ocwindent{0.50em}
:~$\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{calc\_updated\_var\_expr}~\ocwlowerid{chl}~\ocwlowerid{key}~(\ocwupperid{SetofAttr.}\ocwlowerid{singleton}~\ocwlowerid{col})~\ocwlowerid{col}~(\ocwupperid{PVar}~\ocwlowerid{col})~\ocwupperid{None}$\medskip

\ocwendcode{}\ocwindent{0.00em}
sort: target sort of the input 
\ocweol
\label{rellens.ml:34516}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{updated\_pred}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{sort}:\ocwlowerid{sort})~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~\ocwlowerid{phrase}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{pred},\ocwlowerid{fds})~=~\ocwlowerid{sort}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{chl}~=~\ocwlowerid{get\_updateset}~\ocwlowerid{dR}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{key}~=$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{s}~=~\ocwlowerid{roots}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{match}~$\ocwupperid{PSetofAttr.}\ocwlowerid{cardinal}~\ocwlowerid{s}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
1~$\rightarrow{}~\ocwupperid{PSetofAttr.}\ocwlowerid{choose}~\ocwlowerid{s}~$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~$\ocwkw{let}~$\ocwlowerid{error\_message}~=~$\ocweol
\ocwindent{5.00em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocweol
\ocwindent{6.50em}
\ocwstring{"updated\_pred:\ocwvspace{}\ensuremath{>}\ocwvspace{}1\ocwvspace{}cardinality\ocwvspace{}of\ocwvspace{}keys\ocwvspace{}of\ocwvspace{}functional\ocwvspace{}dependency\ocwvspace{}\%s.\ocwvspace{}Merging@."}~\ocweol
\ocwindent{6.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_PSetofAttr}~\ocwlowerid{s}))~$\ocwkw{in}\ocweol
\ocwindent{5.50em}
$\ocwupperid{Format.}\ocwlowerid{fprintf}~\ocwupperid{Format.}\ocwlowerid{err\_formatter}~$\ocwstring{"\%s@."}~$\ocwlowerid{error\_message};$\ocweol
\ocwindent{5.50em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{s}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{s})~\ocwlowerid{s}~\ocwupperid{SetofAttr.}\ocwlowerid{empty}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{phrase\_map}~($\ocwkw{fun}~$\ocwlowerid{node}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{match}~$\ocwlowerid{node}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$\ocwupperid{PVar}~\ocwlowerid{n}~\rightarrow{}~$\ocweol
\ocwindent{4.00em}
\ocwkw{if}~$\lnot{}~(\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{n}~(\ocwlowerid{right}~\ocwlowerid{fds}))~$\ocwkw{then}~$\ocwlowerid{node}~$\ocwkw{else}~$\ocwlowerid{updated\_var\_expr}~\ocwlowerid{chl}~\ocwlowerid{key}~\ocwlowerid{n}$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{node})~\ocwlowerid{p}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\sigma_{\qquote{
\sem{\neg P}\wedge \sem{\mt{updated\_pred}\ \Delta R\ l\ P}
}}(l)$ 
\ocweol
\label{rellens.ml:35334}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{query\_deleted\_rows}~(\ocwlowerid{dR}~:~\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{p}:\ocwlowerid{phrase})~(\ocwlowerid{dbI}:\ocwlowerid{database})~:~\ocwlowerid{relation}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{\_},\ocwlowerid{tenv},\ocwlowerid{\_},\ocwlowerid{\_})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwlowerid{qtype}~\ocwlowerid{tenv}~\ocwlowerid{p}~\not=~\ocwupperid{TBol}~$\ocwkw{then}~$\ocwlowerid{failwith}~$\ocweol
\ocwindent{3.50em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"query\_deleted\_rows:\ocwvspace{}ill\symbol{45}typed\ocwvspace{}predicate\ocwvspace{}\%s@."}~\ocweol
\ocwindent{5.00em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{p}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{pred}~=~(\ocwupperid{PAnd}~(\ocwupperid{PNot}~\ocwlowerid{p},\ocwlowerid{updated\_pred}~\ocwlowerid{dR}~\ocwlowerid{sortR}~\ocwlowerid{p}))~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{pred})~\ocwlowerid{iR}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\Delta R\cup \{(t,-1)\mid t \in \mt{query\_deleted\_rows}\ \Delta R\ l\ P\}$ 
\ocweol
\label{rellens.ml:35835}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{delta\_put\_select}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{dbI}:\ocwlowerid{database})~(\ocwlowerid{p}:\ocwlowerid{phrase})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})$\ocweol
\ocwindent{2.00em}
:~$\ocwupperid{SetofChange.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{union}~\ocwlowerid{dR}$\ocweol
\ocwindent{1.50em}
$(\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{t}~\rightarrow{}$\ocweol
\ocwindent{2.50em}
$\ocwupperid{SetofChange.}\ocwlowerid{add}~(\ocwlowerid{t},\ocwupperid{Delete}))$\ocweol
\ocwindent{4.00em}
$(\ocwlowerid{query\_deleted\_rows}~\ocwlowerid{dR}~\ocwlowerid{r}~\ocwlowerid{p}~\ocwlowerid{dbI})~\ocwupperid{SetofChange.}\ocwlowerid{empty})$\medskip

\ocwendcode{}\ocwindent{0.00em}
Thesis ignores multiplicity of change set, but deletion should be ignored 
\ocweol
\ocwindent{0.00em}
$\qquote{\bigvee\sem{\{\mt{match\_on\_expr}\ t\ x \mid (t,m) \in \Delta R\}}}$ 
\ocweol
\label{rellens.ml:36271}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{any\_match\_expr}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{change\_list}~=~\ocwupperid{SetofChange.}\ocwlowerid{elements}~\ocwlowerid{dR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{phrase\_list}~=~\ocwupperid{List.}\ocwlowerid{map}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\rightarrow{}~\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~\ocwlowerid{x})$\ocweol
\ocwindent{1.50em}
$\ocwlowerid{change\_list}~$\ocwkw{in}~$\ocwlowerid{uf\_or}~\ocwlowerid{phrase\_list}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\sigma_{\mt{any\_match\_expr}\ \Delta R\ X}(I(R)[X \cup \{A\}])$ 
\ocweol
\label{rellens.ml:36633}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{query\_lookup\_table}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{a}:\ocwlowerid{attr})~:~\ocwlowerid{relation}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{\_},\ocwlowerid{tenv},\ocwlowerid{\_},\ocwlowerid{\_})~=~\ocwlowerid{sort}~\ocwlowerid{r}~\ocwlowerid{db}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{pred}~=~\ocwlowerid{any\_match\_expr}~\ocwlowerid{dR}~\ocwlowerid{x}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwlowerid{qtype}~\ocwlowerid{tenv}~\ocwlowerid{pred}~\not=~\ocwupperid{TBol}~$\ocwkw{then}~$\ocwlowerid{failwith}$\ocweol
\ocwindent{3.50em}
$(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"query\_lookup\_table:\ocwvspace{}ill\symbol{45}typed\ocwvspace{}predicate\ocwvspace{}\%s@."}~\ocweol
\ocwindent{5.00em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{pred}))~$\ocwkw{else}\ocweol
\ocwindent{2.50em}
$\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{pred})$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{restrict\_relation}~(\ocwupperid{SetofAttr.}\ocwlowerid{add}~\ocwlowerid{a}~\ocwlowerid{x})~(\ocwlowerid{instance}~\ocwlowerid{r}~\ocwlowerid{db}))$\medskip

\label{rellens.ml:37074}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{lookup\_col}~(\ocwlowerid{t}:\ocwlowerid{record})~(\ocwlowerid{a}:\ocwlowerid{attr})~(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})$\ocweol
\ocwindent{1.50em}
$(\ocwlowerid{v}:\ocwlowerid{value})~(\ocwlowerid{l}:~\ocwupperid{SetofRecord.}\ocwlowerid{t})~=$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{c}~=~\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{t'}~\rightarrow{}~\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~\ocwlowerid{x}~)~\ocwlowerid{l}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{match}~$\ocwupperid{SetofRecord.}\ocwlowerid{cardinal}~\ocwlowerid{c}~$\ocwkw{with}\ocweol
\ocwindent{2.00em}
$\mid{}~0~\rightarrow{}~\ocwlowerid{extend}~\ocwlowerid{a}~\ocwlowerid{v}~\ocwlowerid{t}$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~$\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{t'}~=~\ocwupperid{SetofRecord.}\ocwlowerid{choose}~\ocwlowerid{c}~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
$\ocwlowerid{extend}~\ocwlowerid{a}~(\ocwlowerid{attribute}~\ocwlowerid{a}~\ocwlowerid{t'})~\ocwlowerid{t}$\medskip

\ocwendcode{}\ocwindent{0.00em}
delta translation for drop 
\ocweol
\ocwindent{0.00em}
$\kw{let} L = \mt{query\_lookup\_table}\ \Delta R\ l\ X\ A$

$\{(\mt{lookup\_col}\ t\ A\ X\ a\ L, m) \mid (t, m) \in \Delta R\}$

\ocweol
\label{rellens.ml:37535}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{delta\_put\_drop}~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{db}:\ocwlowerid{database})~(\ocwlowerid{a}:\ocwlowerid{attr})~(\ocwlowerid{x}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{v}:\ocwlowerid{value})$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{l}~=~\ocwlowerid{query\_lookup\_table}~\ocwlowerid{dR}~\ocwlowerid{r}~\ocwlowerid{db}~\ocwlowerid{x}~\ocwlowerid{a}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{add}$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{lookup\_col}~\ocwlowerid{t}~\ocwlowerid{a}~\ocwlowerid{x}~\ocwlowerid{v}~\ocwlowerid{l},\ocwlowerid{m}))~\ocwlowerid{dR}~\ocwupperid{SetofChange.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
decomposition of functional dependency 
\ocweol
\ocwindent{0.00em}
$F = F' \cup \{X \to A\}$ 
\ocweol
\ocwindent{0.00em}
arbitrary decomposition 
\ocweol
\label{rellens.ml:37924}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{decompose\_fd}~(\ocwlowerid{f}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{a}:\ocwlowerid{attr})~:~\ocwupperid{SetofFD.}\ocwlowerid{t}~\times{}~\ocwlowerid{fd}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{df}~\ocwlowerid{acc}~\ocwlowerid{fds}~=~$\ocwkw{match}~$\ocwlowerid{fds}~$\ocwkw{with}~\ocweol
\ocwindent{2.00em}
$[\,]~\rightarrow{}~\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocweol
\ocwindent{15.50em}
\ocwstring{"decompose\_fd:\ocwvspace{}decomposition\ocwvspace{}of\ocwvspace{}FDs\ocwvspace{}\%s\ocwvspace{}w.r.t.\ocwvspace{}\%s\ocwvspace{}failed."}\ocweol
\ocwindent{15.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofFD}~\ocwlowerid{f})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_attr}~\ocwlowerid{a}))$\ocweol
\ocwindent{1.00em}
$\mid{}~((\ocwlowerid{x},\ocwlowerid{y})::\ocwlowerid{ss})~\rightarrow{}~$\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{a}~\ocwlowerid{y}~$\ocwkw{then}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{f'}~=$\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$\ocwlowerid{y'}~=~\ocwupperid{SetofAttr.}\ocwlowerid{remove}~\ocwlowerid{a}~\ocwlowerid{y}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{union}~(\ocwupperid{SetofFD.}\ocwlowerid{of\_list}~\ocwlowerid{ss})$\ocweol
\ocwindent{5.00em}
$($\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{is\_empty}~\ocwlowerid{y'}~$\ocwkw{then}~$\ocwlowerid{acc}~$\ocwkw{else}\ocweol
\ocwindent{5.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{add}~(\ocwlowerid{x},\ocwlowerid{y'})~\ocwlowerid{acc})~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
$(\ocwlowerid{f'},(\ocwlowerid{x},\ocwupperid{SetofAttr.}\ocwlowerid{singleton}~\ocwlowerid{a}))$\ocweol
\ocwindent{3.00em}
\ocwkw{else}\ocweol
\ocwindent{4.00em}
$\ocwlowerid{df}~(\ocwupperid{SetofFD.}\ocwlowerid{add}~(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{acc})~\ocwlowerid{ss}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{df}~\ocwupperid{SetofFD.}\ocwlowerid{empty}~(\ocwupperid{SetofFD.}\ocwlowerid{elements}~\ocwlowerid{f})$\medskip

\ocwendcode{}\ocwindent{0.00em}
FD split for projection lens, using attributes defining attribute a 
\ocweol
\label{rellens.ml:38589}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{decompose\_fd}~(\ocwlowerid{f}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{x'}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{a}:\ocwlowerid{attr})~:~\ocwupperid{SetofFD.}\ocwlowerid{t}~\times{}~\ocwlowerid{fd}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{df}~\ocwlowerid{acc}~\ocwlowerid{fds}~=~$\ocwkw{match}~$\ocwlowerid{fds}~$\ocwkw{with}~\ocweol
\ocwindent{2.00em}
$[\,]~\rightarrow{}~\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocweol
\ocwindent{10.00em}
\ocwstring{"decompose\_fd:\ocwvspace{}decomposition\ocwvspace{}of\ocwvspace{}FDs\ocwvspace{}\%s\ocwvspace{}w.r.t.\ocwvspace{}(\%s,\%s)\ocwvspace{}failed."}\ocweol
\ocwindent{10.00em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofFD}~\ocwlowerid{f})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{x'})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_attr}~\ocwlowerid{a}))$\ocweol
\ocwindent{1.00em}
$\mid{}~((\ocwlowerid{x},\ocwlowerid{y})::\ocwlowerid{ss})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{a}~\ocwlowerid{y}~\land{}~\ocwupperid{SetofAttr.}\ocwlowerid{equal}~\ocwlowerid{x}~\ocwlowerid{x'}~$\ocwkw{then}\ocweol
\ocwindent{4.00em}
\ocwkw{let}~$\ocwlowerid{f'}~=$\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$\ocwlowerid{y'}~=~\ocwupperid{SetofAttr.}\ocwlowerid{remove}~\ocwlowerid{a}~\ocwlowerid{y}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{union}~(\ocwupperid{SetofFD.}\ocwlowerid{of\_list}~\ocwlowerid{ss})$\ocweol
\ocwindent{5.00em}
$($\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{is\_empty}~\ocwlowerid{y'}~$\ocwkw{then}~$\ocwlowerid{acc}~$\ocwkw{else}\ocweol
\ocwindent{5.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{add}~(\ocwlowerid{x},\ocwlowerid{y'})~\ocwlowerid{acc})~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
$(\ocwlowerid{f'},(\ocwlowerid{x},\ocwupperid{SetofAttr.}\ocwlowerid{singleton}~\ocwlowerid{a}))$\ocweol
\ocwindent{3.00em}
\ocwkw{else}\ocweol
\ocwindent{4.00em}
$\ocwlowerid{df}~(\ocwupperid{SetofFD.}\ocwlowerid{add}~(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{acc})~\ocwlowerid{ss}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{df}~\ocwupperid{SetofFD.}\ocwlowerid{empty}~(\ocwupperid{SetofFD.}\ocwlowerid{elements}~\ocwlowerid{f})$\medskip

\ocwendcode{}\ocwindent{0.00em}
tentative conversion to conjunctive normal form (CNF) 
\ocweol
\ocwindent{0.00em}
$\neg\neg P \Rightarrow P$ 
\ocweol
\ocwindent{0.00em}
$\neg (P \wedge Q) \Rightarrow \neg P \vee \neg Q$ 
\ocweol
\ocwindent{0.00em}
$\neg (P \vee   Q) \Rightarrow \neg P \wedge \neg Q$ 
\ocweol
\ocwindent{0.00em}
$(P \wedge Q) \vee R \Rightarrow (P \vee R) \wedge (Q \vee R)$ 
\ocweol
\label{rellens.ml:39673}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{cnf}~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~\ocwlowerid{phrase}~=~$\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{1.50em}
$\ocwupperid{PCns}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{p1'}~=~\ocwlowerid{cnf}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{p2'}~=~\ocwlowerid{cnf}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{p1'},\ocwlowerid{p2'})$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{p1'}~=~\ocwlowerid{cnf}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{pR}~=~\ocwlowerid{cnf}~\ocwlowerid{p2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$($\ocwkw{match}~$\ocwlowerid{p1'}~$\ocwkw{with}\ocweol
\ocwindent{3.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{pP},\ocwlowerid{pQ})~\rightarrow{}~$\ocwbc{} distribution \ocwec{}~$\ocwupperid{PAnd}~(\ocwlowerid{cnf}~(\ocwupperid{POr}~(\ocwlowerid{pP},\ocwlowerid{pR})),\ocwlowerid{cnf}~(\ocwupperid{POr}~(\ocwlowerid{pQ},\ocwlowerid{pR})))$\ocweol
\ocwindent{2.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}$\ocweol
\ocwindent{4.00em}
$($\ocwkw{match}~$\ocwlowerid{pR}~$\ocwkw{with}\ocweol
\ocwindent{5.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{pP},\ocwlowerid{pQ})~\rightarrow{}$\ocweol
\ocwindent{6.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{cnf}~(\ocwupperid{POr}~(\ocwlowerid{p1'},\ocwlowerid{pP})),\ocwlowerid{cnf}~(\ocwupperid{POr}~(\ocwlowerid{p1'},\ocwlowerid{pQ})))$\ocweol
\ocwindent{4.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwupperid{POr}~(\ocwlowerid{p1'},\ocwlowerid{pR})))$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PNot}~\ocwlowerid{p1}~\rightarrow{}$\ocweol
\ocwindent{2.50em}
\ocwkw{let}~$\ocwlowerid{p1'}~=~\ocwlowerid{cnf}~\ocwlowerid{p1}~$\ocwkw{in}\ocweol
\ocwindent{2.50em}
$($\ocwkw{match}~$\ocwlowerid{p1'}~$\ocwkw{with}\ocweol
\ocwindent{3.50em}
$\ocwupperid{PNot}~\ocwlowerid{p1''}~\rightarrow{}~\ocwlowerid{p1''}~$\ocwbc{} double negation elimination \ocwec{}~$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1'},\ocwlowerid{p2'})~\rightarrow{}~$\ocwbc{} De Morgan \ocwec{}~$\ocwlowerid{cnf}~(\ocwupperid{POr}~(\ocwupperid{PNot}~\ocwlowerid{p1'},\ocwupperid{PNot}~\ocwlowerid{p2'}))$\ocweol
\ocwindent{2.50em}
$\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1'},\ocwlowerid{p2'})~\rightarrow{}~$\ocwbc{} De Morgan \ocwec{}~$\ocwupperid{PAnd}~(\ocwlowerid{cnf}~(\ocwupperid{PNot}~\ocwlowerid{p1'}),\ocwlowerid{cnf}~(\ocwupperid{PNot}~\ocwlowerid{p2'}))$\ocweol
\ocwindent{2.50em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwupperid{PNot}~\ocwlowerid{p1'}$\ocweol
\ocwindent{2.50em}
$)$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PVar}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLt}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PGt}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLte}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PGte}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PEq}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PCase}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{p}$\medskip

\ocwendcode{}\ocwindent{0.00em}
projection of predicates 
\ocweol
\ocwindent{0.00em}
after turning into conjunctive normal form, 
   find a disjunction that only contains reference to A 
   and detach from the rest.

 \verb|  (A = 1) and ((B = 2) or (C = 3)) -> B=2 or  C=3, A=1 |

 \verb|   B = 2  and   A = 3  and C = 2   -> B=2 and C=2, A=3 |
 
\ocweol
\ocwindent{0.00em}
set of free variables appear in the given phrase p 
\ocweol
\label{rellens.ml:41061}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{freevars}~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}~\ocweol
\ocwindent{1.00em}
$\ocwupperid{PCns}~\ocwlowerid{v}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{empty}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PNot}~\ocwlowerid{p1}~\rightarrow{}~\ocwlowerid{freevars}~\ocwlowerid{p1}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PVar}~\ocwlowerid{attr}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{singleton}~\ocwlowerid{attr}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{POr}~(\ocwlowerid{p1},\ocwlowerid{p2})~$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PLt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGt}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PLte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PGte}~(\ocwlowerid{p1},\ocwlowerid{p2})~\mid{}~\ocwupperid{PEq}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofAttr.}\ocwlowerid{union}~(\ocwlowerid{freevars}~\ocwlowerid{p1})~(\ocwlowerid{freevars}~\ocwlowerid{p2})$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwupperid{PCase}~(\ocwlowerid{wlist},\ocwlowerid{else\_phrase})~\rightarrow{}~$\ocweol
\ocwindent{2.50em}
$\ocwupperid{List.}\ocwlowerid{fold\_right}~($\ocwkw{fun}~$(\ocwlowerid{w},\ocwlowerid{t})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{4.50em}
$\ocwupperid{SetofAttr.}\ocwlowerid{union}~(\ocwlowerid{freevars}~\ocwlowerid{w})$\ocweol
\ocwindent{5.50em}
$(\ocwupperid{SetofAttr.}\ocwlowerid{union}~(\ocwlowerid{freevars}~\ocwlowerid{t})~\ocwlowerid{ss}))~\ocwlowerid{wlist}~(\ocwlowerid{freevars}~\ocwlowerid{else\_phrase})$\medskip

\ocwendcode{}\ocwindent{0.00em}
split predicate $P:U$ into a pair $(P[U-A],P[A])$ 
\ocweol
\ocwindent{0.00em}
used for decomposition $P= P[U-A] \bowtie P[A]$ in drop lens  
\ocweol
\label{rellens.ml:41674}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{split\_phrase}~(\ocwlowerid{p}:\ocwlowerid{phrase})~(\ocwlowerid{a}:\ocwlowerid{attr})~:~\ocwlowerid{phrase}~\times{}~\ocwlowerid{phrase}~=~$\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$\ocwlowerid{p}~=~\ocwlowerid{cnf}~\ocwlowerid{p}~$\ocwbc{} convert p into CNF \ocwec{}~\ocwkw{in}\ocweol
\ocwindent{0.50em}
\ocwbc{} flatten as list of disjunctions \ocwec{}\ocweol
\ocwindent{0.50em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{fl}~(\ocwlowerid{p}:\ocwlowerid{phrase})~:~\ocwlowerid{phrase}~$\ocwbt{list}~=~\ocwkw{match}~$\ocwlowerid{p}~$\ocwkw{with}\ocweol
\ocwindent{1.50em}
$\ocwupperid{PAnd}~(\ocwlowerid{p1},\ocwlowerid{p2})~\rightarrow{}~\ocwlowerid{fl}~\ocwlowerid{p1}~@~\ocwlowerid{fl}~\ocwlowerid{p2}$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~[\ocwlowerid{p}]~$\ocwkw{in}\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$\ocwlowerid{l}~=~\ocwlowerid{fl}~\ocwlowerid{p}~$\ocwkw{in}\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$(\ocwlowerid{aps},\ocwlowerid{ps})~=~\ocwupperid{List.}\ocwlowerid{partition}~($\ocwkw{fun}~$\ocwlowerid{p}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{a}~(\ocwlowerid{freevars}~\ocwlowerid{p}))~\ocwlowerid{l}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwbc{} unflatten \ocwec{}\ocweol
\ocwindent{0.50em}
\ocwkw{let}~$(\ocwlowerid{faps},\ocwlowerid{fps})~=~(\ocwlowerid{uf\_and}~\ocwlowerid{aps},\ocwlowerid{uf\_and}~\ocwlowerid{ps})~$\ocwkw{in}\ocweol
\ocwindent{0.50em}
\ocwkw{match}~$(\ocwupperid{SetofAttr.}\ocwlowerid{cardinal}~(\ocwlowerid{freevars}~\ocwlowerid{faps}))~$\ocwkw{with}~\ocweol
\ocwindent{1.50em}
0~$\mid{}~1~\rightarrow{}~(\ocwlowerid{fps},~\ocwlowerid{faps})$\ocweol
\ocwindent{0.50em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~$\ocwbc{} faps contains variables other than A \ocwec{}\ocweol
\ocwindent{2.50em}
$\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocweol
\ocwindent{3.50em}
\ocwstring{"split\_phrase:\ocwvspace{}conjunctive\ocwvspace{}extraction\ocwvspace{}of\ocwvspace{}\%s\ocwvspace{}part\ocwvspace{}from\ocwvspace{}predicate\ocwvspace{}\%s\ocwvspace{}failed"}\ocweol
\ocwindent{8.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_attr}~\ocwlowerid{a})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{p}))$\medskip

\ocwendcode{}\ocwindent{0.00em}
drop lens 
\ocweol
\ocwindent{0.00em}
$\mt{drop}\ A\ \mt{determined\ by}\ (X,a)\ \mt{from}\ R\ \mt{as}\ S$ 
\ocweol
\ocwindent{0.00em}
$\frac{
\begin{array}{c}
  \mi{sort}(R) = (U,P,F) \\
  A \in U \quad F\equiv F'\cup \{X\to A\} \\
  \mi{sort}(S) = (U-A,P[U-A],F') \\
  P= P[U-A] \bowtie P[A] \quad \{A=a\} \in P[A]
\end{array}}
{
\begin{array}{c}
\mt{drop}\ A\ \mt{determined\ by}\ (X,a)\ \mt{from}\ R\ \mi{as}\ S \in \\
\Sigma \uplus \{R\} \Leftrightarrow \Sigma \uplus \{S\}
\end{array}}\ \text{(\textsc{T-Drop})}
$

\ocweol
\ocwindent{0.00em}
type check and inference for drop 
\ocweol
\label{rellens.ml:42926}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{typeinf\_drop}~(\ocwlowerid{a}:\ocwlowerid{attr})~((\ocwlowerid{x},\ocwlowerid{v}):\ocwupperid{SetofAttr.}\ocwlowerid{t}~\times{}~\ocwlowerid{value})~(\ocwlowerid{sortR}:\ocwlowerid{sort})~:~\ocwlowerid{sort}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{tenv},\ocwlowerid{p},\ocwlowerid{f})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\lnot{}~(\ocwupperid{SetofAttr.}\ocwlowerid{mem}~\ocwlowerid{a}~\ocwlowerid{u})~$\ocwkw{then}~$\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocweol
\ocwindent{1.50em}
\ocwstring{"get\_drop:\ocwvspace{}dropped\ocwvspace{}attribute\ocwvspace{}\%s\ocwvspace{}is\ocwvspace{}not\ocwvspace{}in\ocwvspace{}the\ocwvspace{}domain\ocwvspace{}\%s"}\ocweol
\ocwindent{1.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_attr}~\ocwlowerid{a})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{u}))~$\ocwkw{else}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{f'},(\ocwlowerid{xS},\ocwlowerid{aS}))~=~\ocwlowerid{decompose\_fd}~\ocwlowerid{f}~\ocwlowerid{x}~\ocwlowerid{a}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{pRest},\ocwlowerid{pA})~=~\ocwlowerid{split\_phrase}~\ocwlowerid{p}~\ocwlowerid{a}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$(\ocwupperid{Bol}~$\ocwkw{true}$)~\not=~\ocwlowerid{eval}~(\ocwupperid{MapofAttr.}\ocwlowerid{singleton}~\ocwlowerid{a}~\ocwlowerid{v})~\ocwlowerid{pA}~$\ocwkw{then}~\ocweol
\ocwindent{2.00em}
$\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"value\ocwvspace{}v=\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}satisfy\ocwvspace{}predicate\ocwvspace{}P[\%s]\ocwvspace{}=\ocwvspace{}\%s"}\ocweol
\ocwindent{8.00em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_value}~\ocwlowerid{v})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_attr}~\ocwlowerid{a})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_phrase}~\ocwlowerid{pA}))$\ocweol
\ocwindent{1.00em}
\ocwkw{else}\ocweol
\ocwindent{2.50em}
$(\ocwupperid{SetofAttr.}\ocwlowerid{remove}~\ocwlowerid{a}~\ocwlowerid{u},\ocwupperid{MapofAttr.}\ocwlowerid{remove}~\ocwlowerid{a}~\ocwlowerid{tenv},\ocwlowerid{pRest},\ocwlowerid{f'})$\medskip

\ocwendcode{}\ocwindent{0.00em}
get part of drop lens 
\ocweol
\ocwindent{0.00em}
$v\lget(I) = I {\setminus_R}[S\mapsto I(R)[U-A]]$ 
\ocweol
\label{rellens.ml:43638}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{get\_drop}~(\ocwlowerid{a}:\ocwlowerid{attr})~((\ocwlowerid{x},\ocwlowerid{v}):\ocwupperid{SetofAttr.}\ocwlowerid{t}~\times{}~\ocwlowerid{value})~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{s}:\ocwlowerid{rname})~(\ocwlowerid{dbI}:\ocwlowerid{database})~:~\ocwlowerid{database}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortS}~=~\ocwlowerid{typeinf\_drop}~\ocwlowerid{a}~(\ocwlowerid{x},\ocwlowerid{v})~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}$\ocweol
\ocwindent{2.50em}
$(\ocwlowerid{sortS},\ocwlowerid{restrict\_relation}~(\ocwupperid{SetofAttr.}\ocwlowerid{remove}~\ocwlowerid{a}~\ocwlowerid{u})~\ocwlowerid{iR})$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~\ocwlowerid{dbI})$\medskip

\ocwendcode{}\ocwindent{0.00em}
put part of the drop lens 
\ocweol
\ocwindent{0.00em}
$
\begin{array}{rcl}
              v\lput(J,I) &=& J{\setminus_S}[R\mapsto M \leftarrow_{X\to A} I(R)]       \\
       \text{where}\quad M&=& (I(R)\bowtie J(S))\cup (N_+ \bowtie \{\{A=a\}\})\\
                       N_+&=& J(S) \setminus I(R)[U-A]                        \\
                        U &=& \mi{dom}(R)
\end{array}
   $ 
\ocweol
\label{rellens.ml:44335}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{put\_drop}~(\ocwlowerid{a}:\ocwlowerid{attr})~((\ocwlowerid{x},\ocwlowerid{v}):\ocwupperid{SetofAttr.}\ocwlowerid{t}~\times{}~\ocwlowerid{value})~(\ocwlowerid{r}:\ocwlowerid{rname})~(\ocwlowerid{s}:\ocwlowerid{rname})$\ocweol
\ocwindent{1.00em}
$((\ocwlowerid{dbJ},\ocwlowerid{dbI}):\ocwlowerid{database}\times{}\ocwlowerid{database})~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{\_}~=~\ocwlowerid{typeinf\_drop}~\ocwlowerid{a}~(\ocwlowerid{x},\ocwlowerid{v})~\ocwlowerid{sortR}~$\ocwkw{in}~\ocwbc{} for typecheck \ocwec{}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{jS}~=~\ocwlowerid{instance}~\ocwlowerid{s}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{nPlus}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{jS}~(\ocwlowerid{restrict\_relation}~(\ocwupperid{SetofAttr.}\ocwlowerid{remove}~\ocwlowerid{a}~\ocwlowerid{u})~\ocwlowerid{iR})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{mR}~=~\ocwupperid{SetofRecord.}\ocwlowerid{union}$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{nat\_join}~\ocwlowerid{iR}~\ocwlowerid{jS})$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{nat\_join}~\ocwlowerid{nPlus}~(\ocwupperid{SetofRecord.}\ocwlowerid{singleton}~(\ocwupperid{MapofAttr.}\ocwlowerid{singleton}~\ocwlowerid{a}~\ocwlowerid{v})))~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{sortR},\ocwlowerid{relation\_revision}~\ocwlowerid{mR}~(\ocwupperid{SetofFD.}\ocwlowerid{singleton}~(\ocwlowerid{x},\ocwupperid{SetofAttr.}\ocwlowerid{singleton}~\ocwlowerid{a}))~\ocwlowerid{iR})$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{dbJ})$\medskip

\ocwendcode{}\ocwindent{0.00em}
key(l) compute tentative keys from sort 
\ocweol
\label{rellens.ml:45002}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{key}~(\ocwlowerid{l}:\ocwlowerid{ilens})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{fds}),\ocwlowerid{\_})~=~\ocwlowerid{l}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{s}~=~\ocwlowerid{roots}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{s}~\rightarrow{}~\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{s})~\ocwlowerid{s}~\ocwupperid{SetofAttr.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
dom(l) 
\ocweol
\label{rellens.ml:45169}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{idom}~(\ocwlowerid{l}:\ocwlowerid{ilens})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_}),\ocwlowerid{\_})~=~\ocwlowerid{l}~$\ocwkw{in}~$\ocwlowerid{u}$\medskip

\label{rellens.ml:45235}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{irel}~(\ocwlowerid{l}:\ocwlowerid{ilens})~:~\ocwlowerid{relation}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_}),\ocwlowerid{r})~=~\ocwlowerid{l}~$\ocwkw{in}~$\ocwlowerid{r}$\medskip

\label{rellens.ml:45297}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{is\_neutral}~((\ocwlowerid{t},\ocwlowerid{m})~:~\ocwlowerid{change\_entry})~:~$\ocwbt{bool}~=~$(\ocwlowerid{m}~=~\ocwupperid{Keep})$\medskip

\ocwendcode{}\ocwindent{0.00em}
$m \neq 0 \wedge \exists (t',m')\in\Delta R,m'=0\wedge t[\mt{key}(l_2)]=
 t'[\mt{key}(l_2)]$ 
\ocweol
\label{rellens.ml:45455}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{ntrl\_exists\_right}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$(\lnot{}~(\ocwlowerid{is\_neutral}~(\ocwlowerid{t},\ocwlowerid{m})))~\land{}~\ocwupperid{SetofChange.}\ocwlowerid{exists}$\ocweol
\ocwindent{1.50em}
$($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~\ocwlowerid{m'}~=~\ocwupperid{Keep}~\land{}~\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{key}~\ocwlowerid{l2}))~\ocwlowerid{dR}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$m \neq 0 \wedge \exists (t',m')\in\Delta R,m'=-m\wedge t[\mt{key}(l_1)]=
 t'[\mt{key}(l_1)]$ 
\ocweol
\label{rellens.ml:45746}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compl\_exists\_left}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l1}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$(\lnot{}~(\ocwlowerid{is\_neutral}~(\ocwlowerid{t},\ocwlowerid{m})))~\land{}~\ocwupperid{SetofChange.}\ocwlowerid{exists}$\ocweol
\ocwindent{1.50em}
$($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~\ocwlowerid{is\_compl}~\ocwlowerid{m}~\ocwlowerid{m'}~\land{}~\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{key}~\ocwlowerid{l1}))~\ocwlowerid{dR}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$m \neq 0 \wedge \exists (t',m')\in\Delta R,m'=-m\wedge t[\mt{key}(l_2)]=
 t'[\mt{key}(l_2)]$ 
\ocweol
\label{rellens.ml:46042}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compl\_exists\_right}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$(\lnot{}~(\ocwlowerid{is\_neutral}~(\ocwlowerid{t},\ocwlowerid{m})))~\land{}~\ocwupperid{SetofChange.}\ocwlowerid{exists}$\ocweol
\ocwindent{1.50em}
$($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~\ocwlowerid{is\_compl}~\ocwlowerid{m}~\ocwlowerid{m'}~\land{}~\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{key}~\ocwlowerid{l2}))~\ocwlowerid{dR}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mt{compl\_exists\_left}\ (t,m)\ \Delta R\ l_1 \\
\wedge \exists (t',m')\in\Delta R,m'=-m\wedge 
t[\mt{key}(l_1)]= t'[\mt{key}(l_1)] \wedge t[\mt{dom}(l_1)]\neq t'[\mt{dom}(l_1)  ]$ 
\ocweol
\label{rellens.ml:46428}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{upd\_left}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l1}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwlowerid{compl\_exists\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~\land{}$\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofChange.}\ocwlowerid{exists}~($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~$\ocweol
\ocwindent{2.50em}
$\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{key}~\ocwlowerid{l1})~\land{}~(\lnot{}~(\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{idom}~\ocwlowerid{l1}))))~\ocwlowerid{dR}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\mt{compl\_exists\_right}\ (t,m)\ \Delta R\ l_2 \\
\wedge \exists (t',m')\in\Delta R,m'=-m\wedge 
t[\mt{key}(l_2)]= t'[\mt{key}(l_2)] \wedge t[\mt{dom}(l_2)]\neq t'[\mt{dom}(l_2)]$ 
\ocweol
\label{rellens.ml:46832}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{upd\_right}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwlowerid{compl\_exists\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}~\land{}$\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofChange.}\ocwlowerid{exists}~($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~$\ocweol
\ocwindent{2.50em}
$\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{key}~\ocwlowerid{l2})~\land{}~(\lnot{}~(\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~(\ocwlowerid{idom}~\ocwlowerid{l2}))))~\ocwlowerid{dR}$\medskip

\label{rellens.ml:47049}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{non\_upd\_left}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l1}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwlowerid{compl\_exists\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~\land{}~(\lnot{}~(\ocwlowerid{upd\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}))$\medskip

\label{rellens.ml:47191}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{non\_upd\_right}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwlowerid{compl\_exists\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}~\land{}~(\lnot{}~(\ocwlowerid{upd\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}))$\medskip

\label{rellens.ml:47336}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{found\_any\_right}~((\ocwlowerid{t},\ocwlowerid{m})~:~\ocwlowerid{change\_entry})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{exists}~$\ocweol
\ocwindent{2.00em}
$($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~(\ocwlowerid{key}~\ocwlowerid{l2})))~(\ocwlowerid{irel}~\ocwlowerid{l2})$\medskip

\label{rellens.ml:47488}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{found\_same\_right}~((\ocwlowerid{t},\ocwlowerid{m})~:~\ocwlowerid{change\_entry})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{exists}$\ocweol
\ocwindent{2.00em}
$($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~(\ocwlowerid{idom}~\ocwlowerid{l2})))~(\ocwlowerid{irel}~\ocwlowerid{l2})$\medskip

\label{rellens.ml:47641}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{found\_upd\_right}~((\ocwlowerid{t},\ocwlowerid{m})~:~\ocwlowerid{change\_entry})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{2.00em}
$\ocwlowerid{found\_any\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{l2}~\land{}~(\lnot{}~(\ocwlowerid{found\_same\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{l2}))$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\qquote{\bigvee\sem{\{\mt{match\_on\_expr}\ t\ \mi{key}
  \mid (t,m) \in \Delta R,m=-1,
    \mt{compl\_rows}\ (t,m)\ \Delta R\ \mi{key} = \emptyset\}}}$ 
\ocweol
\label{rellens.ml:47934}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{removed\_row\_expr}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{key}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{uf\_or}$\ocweol
\ocwindent{2.50em}
$(\ocwupperid{SetofChange.}\ocwlowerid{fold}$\ocweol
\ocwindent{4.00em}
$($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{ps}~\rightarrow{}$\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~\land{}~\ocwupperid{SetofChange.}\ocwlowerid{is\_empty}~(\ocwlowerid{compl\_rows}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{key})$\ocweol
\ocwindent{5.00em}
\ocwkw{then}~$(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~\ocwlowerid{key})::\ocwlowerid{ps}~$\ocwkw{else}~$\ocwlowerid{ps})~\ocwlowerid{dR}~[\,])$\medskip

\ocwendcode{}\ocwindent{0.00em}
$ \{(t,t') \mid (t,m) \in \Delta R,
    (t',m')\in \mt{compl\_rows}\ (t,m)\ \Delta R\ \mi{key}, m=-1\}$ 
\ocweol
\label{rellens.ml:48291}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{find\_changed\_rows}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{key}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwupperid{SetofPRecord.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~$\ocwkw{then}\ocweol
\ocwindent{3.00em}
$\ocwupperid{SetofPRecord.}\ocwlowerid{union}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t'},\ocwlowerid{m'})~\rightarrow{}~(\ocwupperid{SetofPRecord.}\ocwlowerid{add}~(\ocwlowerid{t},\ocwlowerid{t'})))$\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{compl\_rows}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{key})~\ocwupperid{SetofPRecord.}\ocwlowerid{empty})~\ocwlowerid{ss}~$\ocwkw{else}~$\ocwlowerid{ss})$\ocweol
\ocwindent{4.50em}
$\ocwlowerid{dR}~\ocwupperid{SetofPRecord.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\qquote{\bigvee\{\sem{\mt{match\_on\_expr}\ t\ X
  \mid (X\to Y)\in \mi{fds}, t[X]=t'[X], t[Y]\neq t'[Y]\}}}$

\ocweol
\label{rellens.ml:48730}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{match\_changes\_expr}~((\ocwlowerid{t},\ocwlowerid{t'})~:~\ocwlowerid{record}~\times{}~\ocwlowerid{record}~)(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwlowerid{phrase}~=~$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{uf\_or}$\ocweol
\ocwindent{2.00em}
$(\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$(\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~\ocwlowerid{x}~\land{}~\lnot{}~(\ocwlowerid{match\_on}~\ocwlowerid{t}~\ocwlowerid{t'}~\ocwlowerid{y}))~$\ocwkw{then}~\ocweol
\ocwindent{4.00em}
$(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~\ocwlowerid{x})::\ocwlowerid{ss}~$\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{fds}~[\,])$\medskip

\label{rellens.ml:49012}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{fwd\_fds}~(\ocwlowerid{s}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{edges}~=~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{subset}~\ocwlowerid{x}~\ocwlowerid{s}~$\ocwkw{then}~$\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{y}~\ocwlowerid{ss}$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{edges}~\ocwupperid{SetofAttr.}\ocwlowerid{empty}$\medskip

\label{rellens.ml:49217}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{lefts}~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{PSetofAttr.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{x},\ocwlowerid{y})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$\ocwupperid{PSetofAttr.}\ocwlowerid{add}~\ocwlowerid{x})~\ocwlowerid{fds}~\ocwupperid{PSetofAttr.}\ocwlowerid{empty}$\medskip

\label{rellens.ml:49339}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{closure}~(\ocwlowerid{fd}:\ocwlowerid{fd})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{cl}~(\ocwlowerid{acc}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{frontier}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwupperid{SetofAttr.}\ocwlowerid{t}~=$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{frontier'}~=~\ocwlowerid{fwd\_fds}~\ocwlowerid{frontier}~\ocwlowerid{fds}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{subset}~\ocwlowerid{frontier'}~\ocwlowerid{acc}~$\ocwkw{then}~\ocwbc{} no more new attr \ocwec{}~$\ocwlowerid{acc}~$\ocwkw{else}\ocweol
\ocwindent{2.00em}
$\ocwlowerid{cl}~(\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{acc}~\ocwlowerid{frontier'})~\ocwlowerid{frontier'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{cl}~(\ocwlowerid{snd}~\ocwlowerid{fd})~(\ocwlowerid{snd}~\ocwlowerid{fd})$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\{\mi{fd} \mid \mi{fd}\in \mi{fds}, \mi{key}\subset \mt{closure}(\mi{fd},\mi{fds})\}$ 
\ocweol
\label{rellens.ml:49893}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{defining\_fds}~(\ocwlowerid{key}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwupperid{SetofFD.}\ocwlowerid{t}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{fd}~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwupperid{SetofAttr.}\ocwlowerid{subset}~\ocwlowerid{key}~(\ocwlowerid{closure}~\ocwlowerid{fd}~\ocwlowerid{fds})~$\ocweol
\ocwindent{2.00em}
\ocwkw{then}~$\ocwupperid{SetofFD.}\ocwlowerid{add}~\ocwlowerid{fd}~\ocwlowerid{ss}~$\ocweol
\ocwindent{2.00em}
\ocwkw{else}~$\ocwlowerid{ss})~\ocwlowerid{fds}~\ocwupperid{SetofFD.}\ocwlowerid{empty}$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\qquote{\bigvee\{ \sem{\mt{match\_on\_expr}\ chl\ \mt{left}(f) \mid 
   (\mi{chl},\mi{chr}) \in \mi{changes}\}}}$ 
\ocweol
\label{rellens.ml:50215}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{fd\_changes\_expr}~(\ocwlowerid{changes}:\ocwupperid{SetofPRecord.}\ocwlowerid{t})~(\ocwlowerid{f}:\ocwlowerid{fd})~:~\ocwlowerid{phrase}~=~$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{uf\_or}~$\ocweol
\ocwindent{2.00em}
$(\ocwupperid{SetofPRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{chl},\ocwlowerid{chr})~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{match\_on\_expr}~\ocwlowerid{chl}~(\ocwlowerid{fst}~\ocwlowerid{f}))::\ocwlowerid{ss})~\ocwlowerid{changes}~[\,])$\medskip

\ocwendcode{}\ocwindent{0.00em}
$ \qquote{\bigvee\{ \sem{\mt{fd\_changes\_expr}\ \mi{changes}\ f \mid 
   f\in \mt{defining\_fds}\ J\ F,\\
   (f,\mi{changes}) \in \mt{get\_updateset}\ \Delta R\ F\}}}
 $ 
\ocweol
\label{rellens.ml:50561}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{changes\_expr}~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{fS}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
$\ocwlowerid{uf\_or}$\ocweol
\ocwindent{2.00em}
$(\ocwupperid{SetofFD.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{f}~\ocwlowerid{ss}~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$(\ocwupperid{SetofFDSPRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{f'},\ocwlowerid{changes})~\ocwlowerid{ss'}~\rightarrow{}$\ocweol
\ocwindent{4.00em}
\ocwkw{if}~0~=~$\ocwlowerid{compare\_fd}~\ocwlowerid{f}~\ocwlowerid{f'}~$\ocwkw{then}\ocweol
\ocwindent{4.50em}
$(\ocwlowerid{fd\_changes\_expr}~\ocwlowerid{changes}~\ocwlowerid{f})::\ocwlowerid{ss'}$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~$\ocwlowerid{ss'})~(\ocwlowerid{get\_updateset}~\ocwlowerid{dR}~\ocwlowerid{fS})~[\,])~@~\ocwlowerid{ss})~(\ocwlowerid{defining\_fds}~\ocwlowerid{j}~\ocwlowerid{fS})~[\,])$\medskip

\ocwendcode{}\ocwindent{0.00em}
$ 
\qquote{      \sem{\mt{match\_on\_expr}\ t\ J} 
  \wedge \neg \sem{\mt{removed\_row\_expr}\ \Delta R\ P_d}
  \wedge \neg \sem{\mt{changes\_expr}\ \Delta R\ F\ J}
  }
$
\ocweol
\label{rellens.ml:51038}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{create\_query\_expr}~(\ocwlowerid{t}:\ocwlowerid{record})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{pd}:\ocwupperid{SetofAttr.}\ocwlowerid{t})$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fS}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~\ocwlowerid{phrase}~=$\ocweol
\ocwindent{1.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~\ocwlowerid{j},$\ocweol
\ocwindent{4.00em}
$\ocwupperid{PAnd}~(\ocwupperid{PNot}~(\ocwlowerid{removed\_row\_expr}~\ocwlowerid{dR}~\ocwlowerid{pd}),$\ocweol
\ocwindent{7.00em}
$\ocwupperid{PNot}~(\ocwlowerid{changes\_expr}~\ocwlowerid{dR}~\ocwlowerid{fS}~\ocwlowerid{j})))$\medskip

\label{rellens.ml:51256}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{remove\_entry\_left}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~(\ocwlowerid{l1}:\ocwlowerid{ilens})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$\ocwlowerid{m}~=~\ocwupperid{Delete}~\land{}~(\lnot{}~(\ocwlowerid{compl\_exists\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}))$\medskip

\ocwendcode{}\ocwindent{0.00em}
join with colums j 
\ocweol
\ocwindent{0.50em}
$\bowtie_J$ 
\ocweol
\label{rellens.ml:51449}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{join\_with\_columns}~(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{l1}:\ocwlowerid{ilens})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~:~\ocwlowerid{ilens}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{u},\ocwlowerid{tenv1},\ocwlowerid{p},\ocwlowerid{fds1}),\ocwlowerid{m})~=~\ocwlowerid{l1}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$((\ocwlowerid{v},\ocwlowerid{tenv2},\ocwlowerid{q},\ocwlowerid{fds2}),\ocwlowerid{n})~=~\ocwlowerid{l2}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$(\lnot{}~(\ocwupperid{SetofAttr.}\ocwlowerid{subset}~\ocwlowerid{j}~\ocwlowerid{u}))~$\ocwkw{then}~\ocweol
\ocwindent{2.00em}
$\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"join\_with\_columns:\ocwvspace{}left\ocwvspace{}domain\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}contain\ocwvspace{}join\ocwvspace{}colum\ocwvspace{}\%s"}~$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{u})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{j}));$\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$(\lnot{}~(\ocwupperid{SetofAttr.}\ocwlowerid{subset}~\ocwlowerid{j}~\ocwlowerid{v}))~$\ocwkw{then}~\ocweol
\ocwindent{2.00em}
$\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"join\_with\_columns:\ocwvspace{}right\ocwvspace{}domain\ocwvspace{}\%s\ocwvspace{}does\ocwvspace{}not\ocwvspace{}contain\ocwvspace{}join\ocwvspace{}colum\ocwvspace{}\%s"}~$(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{v})~(\ocwlowerid{toStr}~\ocwlowerid{pp\_SetofAttr}~\ocwlowerid{j}));$\ocweol
\ocwindent{1.00em}
$((\ocwupperid{SetofAttr.}\ocwlowerid{union}~\ocwlowerid{u}~\ocwlowerid{v},$\ocweol
\ocwindent{2.00em}
$\ocwlowerid{merge\_tenv}~\ocwlowerid{tenv1}~\ocwlowerid{tenv2},$\ocweol
\ocwindent{2.00em}
$\ocwupperid{PAnd}~(\ocwlowerid{p},\ocwlowerid{q}),$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofFD.}\ocwlowerid{union}~\ocwlowerid{fds1}~\ocwlowerid{fds2}),$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{rm}~\ocwlowerid{rms}~\rightarrow{}$\ocweol
\ocwindent{3.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{union}$\ocweol
\ocwindent{4.00em}
$($\ocwkw{let}~$\ocwlowerid{rm'}~=~\ocwlowerid{restrict}~\ocwlowerid{j}~\ocwlowerid{rm}~$\ocwkw{in}\ocweol
\ocwindent{4.00em}
$(\ocwupperid{SetofRecord.}\ocwlowerid{fold}~($\ocwkw{fun}~$\ocwlowerid{rn}~\ocwlowerid{rns}~\rightarrow{}$\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$\ocwlowerid{rn'}~=~\ocwlowerid{restrict}~\ocwlowerid{j}~\ocwlowerid{rn}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{record\_equal}~\ocwlowerid{rm'}~\ocwlowerid{rn'}~$\ocweol
\ocwindent{6.00em}
\ocwkw{then}~$\ocwupperid{SetofRecord.}\ocwlowerid{add}~(\ocwupperid{MapofAttr.}\ocwlowerid{merge}$\ocweol
\ocwindent{18.00em}
$($\ocwkw{fun}~$\ocwlowerid{k}~\ocwlowerid{a}~\ocwlowerid{b}~\rightarrow{}~$\ocwkw{match}~$(\ocwlowerid{a},\ocwlowerid{b})~$\ocwkw{with}\ocweol
\ocwindent{19.50em}
$(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~$\ocwkw{if}~$\ocwlowerid{a}=\ocwlowerid{b}~$\ocwkw{then}~$\ocwupperid{Some}~\ocwlowerid{a}~$\ocwkw{else}~$\ocwlowerid{failwith}~$\ocwstring{"mismatch"}\ocweol
\ocwindent{18.50em}
$\mid{}~(\ocwupperid{Some}~\ocwlowerid{a},\ocwupperid{None}~)~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{a}$\ocweol
\ocwindent{18.50em}
$\mid{}~(\ocwupperid{None},\ocwupperid{Some}~\ocwlowerid{b})~\rightarrow{}~\ocwupperid{Some}~\ocwlowerid{b}$\ocweol
\ocwindent{18.50em}
$\mid{}~(\ocwupperid{None},\ocwupperid{None})~\rightarrow{}~\ocwupperid{None})~\ocwlowerid{rm}~\ocwlowerid{rn})~\ocwlowerid{rns}~$\ocweol
\ocwindent{6.00em}
\ocwkw{else}~$\ocwlowerid{rns})~\ocwlowerid{n}~\ocwlowerid{rms}))~\ocwlowerid{rms})~\ocwlowerid{m}~\ocwupperid{SetofRecord.}\ocwlowerid{empty})$\medskip

\label{rellens.ml:52566}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{remove\_entry\_right}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{l1}:\ocwlowerid{ilens})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~:~$\ocwbt{bool}~=\ocweol
\ocwindent{1.00em}
$(\ocwlowerid{m}~=~\ocwupperid{Delete})~\land{}~(\lnot{}~(\ocwlowerid{compl\_exists\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}))$\ocweol
\ocwindent{2.00em}
$\land{}~(\lnot{}~(\ocwlowerid{ntrl\_exists\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}))~$\ocweol
\ocwindent{2.00em}
$\land{}~(\lnot{}$\ocweol
\ocwindent{5.00em}
$($\ocwkw{let}~$(\ocwlowerid{\_},\ocwlowerid{join\_l1\_l2})~=~(\ocwlowerid{join\_with\_columns}~\ocwlowerid{j}~\ocwlowerid{l1}~\ocwlowerid{l2})~$\ocwkw{in}~\ocweol
\ocwindent{5.50em}
$\ocwupperid{SetofRecord.}\ocwlowerid{exists}$\ocweol
\ocwindent{5.50em}
$($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~(\ocwlowerid{create\_query\_expr}~\ocwlowerid{t}~\ocwlowerid{dR}~(\ocwlowerid{key}~\ocwlowerid{l1})~\ocwlowerid{j}~\ocwlowerid{fds}~))~\ocwlowerid{join\_l1\_l2}))$\medskip

\label{rellens.ml:52983}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{join\_left\_row}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{l1}:\ocwlowerid{ilens})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{pd}:\ocwlowerid{phrase})~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{pi\_u\_t}~=~\ocwlowerid{restrict}~(\ocwlowerid{idom}~\ocwlowerid{l1})~\ocwlowerid{t}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwlowerid{is\_neutral}~(\ocwlowerid{t},\ocwlowerid{m})~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_u\_t},\ocwupperid{Keep})~$\ocweol
\ocwindent{1.00em}
\ocwkw{else}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{compl\_exists\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~$\ocwkw{then}\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwlowerid{upd\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_u\_t},\ocwlowerid{m})~$\ocweol
\ocwindent{3.00em}
\ocwkw{else}~\ocweol
\ocwindent{4.00em}
\ocwkw{if}~$\ocwlowerid{non\_upd\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~$\ocwkw{then}\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_u\_t},\ocwlowerid{m})~$\ocweol
\ocwindent{5.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{empty}$\ocweol
\ocwindent{2.00em}
\ocwkw{else}\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~$\ocwkw{then}\ocweol
\ocwindent{4.00em}
\ocwkw{if}~$\ocwlowerid{remove\_entry\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~$\ocwkw{then}~\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{remove\_entry\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~\ocwlowerid{l2}~\ocwlowerid{j}~\ocwlowerid{fds}~$\ocwkw{then}\ocweol
\ocwindent{6.00em}
\ocwkw{if}~$\ocwlowerid{eval\_bool}~\ocwlowerid{t}~\ocwlowerid{pd}~$\ocwkw{then}\ocweol
\ocwindent{7.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_u\_t},\ocwupperid{Delete})$\ocweol
\ocwindent{6.00em}
\ocwkw{else}~\ocweol
\ocwindent{7.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{empty}$\ocweol
\ocwindent{5.00em}
\ocwkw{else}\ocweol
\ocwindent{6.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_u\_t},~\ocwupperid{Delete})$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwbc{} OK? \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwkw{else}~\ocwbc{} (m = +1) \ocwec{}\ocweol
\ocwindent{4.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_u\_t},\ocwupperid{Insert})$\medskip

\label{rellens.ml:53885}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{join\_right\_row}~((\ocwlowerid{t},\ocwlowerid{m}):\ocwlowerid{change\_entry})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{l1}:\ocwlowerid{ilens})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{fds}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{qd}:\ocwlowerid{phrase})~=~$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{pi\_v\_t}~=~\ocwlowerid{restrict}~(\ocwlowerid{idom}~\ocwlowerid{l2})~\ocwlowerid{t}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{if}~$\ocwlowerid{is\_neutral}~(\ocwlowerid{t},\ocwlowerid{m})~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_v\_t},\ocwupperid{Keep})$\ocweol
\ocwindent{1.00em}
\ocwkw{else}\ocweol
\ocwindent{2.00em}
\ocwkw{if}~$\ocwlowerid{compl\_exists\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}~$\ocwkw{then}\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwlowerid{ntrl\_exists\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocweol
\ocwindent{3.00em}
\ocwkw{else}\ocweol
\ocwindent{4.00em}
\ocwkw{if}~$\ocwlowerid{upd\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_v\_t},\ocwlowerid{m})$\ocweol
\ocwindent{4.00em}
\ocwkw{else}\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{non\_upd\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l2}~$\ocwkw{then}\ocweol
\ocwindent{6.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_v\_t},\ocwupperid{Keep})$\ocweol
\ocwindent{6.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}$\ocweol
\ocwindent{5.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwbc{} undocumented \ocwec{}\ocweol
\ocwindent{2.00em}
\ocwkw{else}\ocweol
\ocwindent{3.00em}
\ocwkw{if}~$\ocwlowerid{m}~=~\ocwupperid{Delete}~$\ocwkw{then}\ocweol
\ocwindent{4.00em}
\ocwkw{if}~$\ocwlowerid{remove\_entry\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~\ocwlowerid{l2}~\ocwlowerid{j}~\ocwlowerid{fds}~$\ocwkw{then}\ocweol
\ocwindent{5.00em}
\ocwkw{if}~$\ocwlowerid{remove\_entry\_left}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~$\ocwkw{then}\ocweol
\ocwindent{6.00em}
\ocwkw{if}~$\ocwlowerid{eval\_bool}~\ocwlowerid{t}~\ocwlowerid{qd}~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_v\_t},\ocwupperid{Delete})$\ocweol
\ocwindent{6.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocweol
\ocwindent{5.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwbc{} undocumented \ocwec{}\ocweol
\ocwindent{3.00em}
\ocwkw{else}~\ocwbc{} (m = Insert) \ocwec{}\ocweol
\ocwindent{4.00em}
\ocwkw{if}~$\ocwlowerid{found\_same\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{l2}~$\ocwkw{then}\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_v\_t},\ocwupperid{Keep})$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~\ocwkw{if}~$(\lnot{}~(\ocwlowerid{found\_any\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{l2}))~$\ocwkw{then}~$\ocwupperid{SetofChange.}\ocwlowerid{singleton}~(\ocwlowerid{pi\_v\_t},\ocwupperid{Insert})$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~\ocwkw{if}~$\ocwlowerid{found\_upd\_right}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{l2}~$\ocwkw{then}\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$((\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{\_}),\ocwlowerid{rel\_l2})~=~\ocwlowerid{l2}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$\ocwlowerid{ts}~=~$\ocweol
\ocwindent{6.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~(\ocwlowerid{match\_on\_expr}~\ocwlowerid{t}~(\ocwlowerid{key}~\ocwlowerid{l2})))$\ocweol
\ocwindent{7.00em}
$\ocwlowerid{rel\_l2}~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
\ocwkw{let}~$\ocwlowerid{t'}~=~$\ocweol
\ocwindent{6.00em}
\ocwkw{match}~$(\ocwupperid{SetofRecord.}\ocwlowerid{cardinal}~\ocwlowerid{ts})~$\ocwkw{with}~\ocweol
\ocwindent{7.00em}
0~$\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"no\ocwvspace{}record\ocwvspace{}found"}\ocweol
\ocwindent{6.00em}
$\mid{}~1~\rightarrow{}~\ocwupperid{SetofRecord.}\ocwlowerid{choose}~\ocwlowerid{ts}~$\ocweol
\ocwindent{6.00em}
$\mid{}~\ocwlowerid{\_}~\rightarrow{}~\ocwlowerid{failwith}~(\ocwupperid{Format.}\ocwlowerid{sprintf}~$\ocwstring{"found\_upd\_right:\ocwvspace{}multiple\ocwvspace{}record\ocwvspace{}\%s\ocwvspace{}found"}\ocweol
\ocwindent{11.50em}
$(\ocwlowerid{toStr}~\ocwlowerid{pp\_relation}~\ocwlowerid{ts}))~$\ocwkw{in}\ocweol
\ocwindent{5.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{of\_list}~[(\ocwlowerid{pi\_v\_t},\ocwupperid{Insert});(\ocwlowerid{t'},\ocwupperid{Delete})]$\ocweol
\ocwindent{4.00em}
\ocwkw{else}~$\ocwupperid{SetofChange.}\ocwlowerid{empty}~$\ocwbc{} undocjmented \ocwec{}\medskip

\ocwendcode{}\ocwindent{0.00em}
$
\begin{array}{l}
 \displaystyle\left(\bigcup_{(t,m)\in\Delta R}\mt{join\_left\_row}(t,m)\ \Delta R\ l_1\ l_2\ J\ F\ P_d,\right.\\
  \displaystyle\quad\left.\bigcup_{(t,m)\in\Delta R}\mt{join\_right\_row}(t,m)\ \Delta R\ l_1\ l_2\ J\ F\ Q_d
 \right)
\end{array} 
$ 
\ocweol
\label{rellens.ml:55763}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{delta\_put\_join}~(\ocwlowerid{l1}:\ocwlowerid{ilens})~(\ocwlowerid{l2}:\ocwlowerid{ilens})~(\ocwlowerid{j}:\ocwupperid{SetofAttr.}\ocwlowerid{t})~(\ocwlowerid{pd}:\ocwlowerid{phrase})$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{qd}:\ocwlowerid{phrase})~(\ocwlowerid{fS}:\ocwupperid{SetofFD.}\ocwlowerid{t})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~:~(\ocwupperid{SetofChange.}\ocwlowerid{t}~\times{}~\ocwupperid{SetofChange.}\ocwlowerid{t})~=$\ocweol
\ocwindent{1.00em}
$(\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{union}$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{join\_left\_row}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~\ocwlowerid{l2}~\ocwlowerid{j}~\ocwlowerid{fS}~\ocwlowerid{pd}))~\ocwlowerid{dR}~\ocwupperid{SetofChange.}\ocwlowerid{empty},$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{fold}~($\ocwkw{fun}~$(\ocwlowerid{t},\ocwlowerid{m})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{union}~$\ocweol
\ocwindent{3.00em}
$(\ocwlowerid{join\_right\_row}~(\ocwlowerid{t},\ocwlowerid{m})~\ocwlowerid{dR}~\ocwlowerid{l1}~\ocwlowerid{l2}~\ocwlowerid{j}~\ocwlowerid{fS}~\ocwlowerid{qd}))~\ocwlowerid{dR}~\ocwupperid{SetofChange.}\ocwlowerid{empty})$\medskip

\ocwendcode{}\ocwindent{0.00em}
$v\nearrow \in \Sigma \to \Delta$ 
\ocweol
\label{rellens.ml:56210}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{get}~(\ocwlowerid{l}:\ocwlowerid{lens})~(\ocwlowerid{dbI}:\ocwlowerid{database})~:~\ocwlowerid{database}~=~$\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{2.00em}
$\ocwupperid{Select}~(\ocwlowerid{r},~\ocwlowerid{p},~\ocwlowerid{s})~\rightarrow{}~\ocwlowerid{get\_select}~\ocwlowerid{r}~\ocwlowerid{p}~\ocwlowerid{s}~\ocwlowerid{dbI}$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{JoinDL}~((\ocwlowerid{r},\ocwlowerid{s}),\ocwlowerid{t})~\rightarrow{}~\ocwlowerid{get\_join\_dl}~\ocwlowerid{r}~\ocwlowerid{s}~\ocwlowerid{t}~\ocwlowerid{dbI}$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Drop}~(\ocwlowerid{a},(\ocwlowerid{attr\_list},\ocwlowerid{v}),\ocwlowerid{r},\ocwlowerid{s})~\rightarrow{}~\ocwlowerid{get\_drop}~\ocwlowerid{a}~(\ocwupperid{SetofAttr.}\ocwlowerid{of\_list}~\ocwlowerid{attr\_list},\ocwlowerid{v})~\ocwlowerid{r}~\ocwlowerid{s}~\ocwlowerid{dbI}$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Compose}~(\ocwlowerid{l1},\ocwlowerid{l2})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{dbJ}~=~\ocwlowerid{get}~\ocwlowerid{l1}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
$\ocwlowerid{get}~\ocwlowerid{l2}~\ocwlowerid{dbJ}$\ocweol
\ocwindent{0.00em}
\ocwbc{} $v\searrow \in \Delta\times\Sigma\to\Sigma$ \ocwec{}\ocweol
\ocwindent{0.00em}
\ocwkw{and}~$\ocwlowerid{put}~(\ocwlowerid{l}:\ocwlowerid{lens})~((\ocwlowerid{dbJ},\ocwlowerid{dbI}):\ocwlowerid{database}~\times{}~\ocwlowerid{database})~:~\ocwlowerid{database}~=~$\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{1.00em}
$\ocwupperid{Select}~(\ocwlowerid{r},~\ocwlowerid{p},~\ocwlowerid{s})~\rightarrow{}~\ocwlowerid{put\_select}~\ocwlowerid{r}~\ocwlowerid{p}~\ocwlowerid{s}~(\ocwlowerid{dbJ},\ocwlowerid{dbI})$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{JoinDL}~((\ocwlowerid{r},\ocwlowerid{s}),\ocwlowerid{t})~\rightarrow{}~\ocwlowerid{put\_join\_dl}~\ocwlowerid{r}~\ocwlowerid{s}~\ocwlowerid{t}~(\ocwlowerid{dbJ},\ocwlowerid{dbI})$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{Drop}~(\ocwlowerid{a},(\ocwlowerid{attr\_list},\ocwlowerid{v}),\ocwlowerid{r},\ocwlowerid{s})~\rightarrow{}~\ocwlowerid{put\_drop}~\ocwlowerid{a}~(\ocwupperid{SetofAttr.}\ocwlowerid{of\_list}~\ocwlowerid{attr\_list},\ocwlowerid{v})~\ocwlowerid{r}~\ocwlowerid{s}~(\ocwlowerid{dbJ},\ocwlowerid{dbI})$\ocweol
\ocwindent{0.00em}
$\mid{}~\ocwupperid{Compose}~(\ocwlowerid{l1},\ocwlowerid{l2})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{dbK}~=~\ocwlowerid{get}~\ocwlowerid{l1}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$\ocwlowerid{put}~\ocwlowerid{l1}~(\ocwlowerid{put}~\ocwlowerid{l2}~(\ocwlowerid{dbJ},\ocwlowerid{dbK}),\ocwlowerid{dbI})$\ocweol
\ocwindent{0.00em}
\ocwkw{and}~$\ocwlowerid{delta\_put}~(\ocwlowerid{l}:\ocwlowerid{lens})~(\ocwlowerid{dbI}:\ocwlowerid{database})~(\ocwlowerid{dR}:\ocwupperid{SetofChange.}\ocwlowerid{t})~:~\ocwupperid{SetofChange.}\ocwlowerid{t}~=~$\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{2.00em}
$\ocwupperid{Select}~(\ocwlowerid{r},~\ocwlowerid{p},~\ocwlowerid{s})~\rightarrow{}~\ocwlowerid{delta\_put\_select}~\ocwlowerid{r}~\ocwlowerid{dbI}~\ocwlowerid{p}~\ocwlowerid{dR}$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{JoinDL}~((\ocwlowerid{r},\ocwlowerid{s}),\ocwlowerid{t})~\rightarrow{}~\ocwlowerid{failwith}~$\ocwstring{"delta\_put:\ocwvspace{}binary\ocwvspace{}operator\ocwvspace{}join\ocwvspace{}does\ocwvspace{}not\ocwvspace{}fit\ocwvspace{}here"}\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Drop}~(\ocwlowerid{a},(\ocwlowerid{attr\_list},\ocwlowerid{v}),\ocwlowerid{r},\ocwlowerid{s})~\rightarrow{}$\ocweol
\ocwindent{3.50em}
$\ocwlowerid{delta\_put\_drop}~\ocwlowerid{r}~\ocwlowerid{dbI}~\ocwlowerid{a}~(\ocwupperid{SetofAttr.}\ocwlowerid{of\_list}~\ocwlowerid{attr\_list})~\ocwlowerid{v}~\ocwlowerid{dR}$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Compose}~(\ocwlowerid{l1},\ocwlowerid{l2})~\rightarrow{}$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{dbK}~=~\ocwlowerid{get}~\ocwlowerid{l1}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwlowerid{delta\_put}~\ocwlowerid{l1}~\ocwlowerid{dbI}~(\ocwlowerid{delta\_put}~\ocwlowerid{l2}~\ocwlowerid{dbK}~\ocwlowerid{dR})$\ocweol
\ocwindent{0.00em}
\ocwbc{} because of binary operator, functional delta should 
   return map from relation to its change set \ocwec{}\ocweol
\ocwindent{0.00em}
\ocwkw{and}~$\ocwlowerid{delta\_put\_map}~(\ocwlowerid{l}:\ocwlowerid{lens})~(\ocwlowerid{dbI}:\ocwlowerid{database})~(\ocwlowerid{dRm}:\ocwupperid{SetofChange.}\ocwlowerid{t}~\ocwupperid{MapofRname.}\ocwlowerid{t})~:~$\ocweol
\ocwindent{2.00em}
$\ocwupperid{SetofChange.}\ocwlowerid{t}~\ocwupperid{MapofRname.}\ocwlowerid{t}~=~$\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{2.00em}
$\ocwupperid{Select}~(\ocwlowerid{r},~\ocwlowerid{p},~\ocwlowerid{s})~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{dS}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dRm}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{dR}~=~\ocwlowerid{delta\_put\_select}~\ocwlowerid{r}~\ocwlowerid{dbI}~\ocwlowerid{p}~\ocwlowerid{dS}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~\ocwlowerid{dR}~(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{dRm})$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{JoinDL}~((\ocwlowerid{r},\ocwlowerid{s}),\ocwlowerid{t}~)~\rightarrow{}$\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{dT}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{t}~\ocwlowerid{dRm}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{l1}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{l2}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$((\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{p},\ocwlowerid{fds1}),\ocwlowerid{\_})~=~\ocwlowerid{l1}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$((\ocwlowerid{v},\ocwlowerid{\_},\ocwlowerid{q},\ocwlowerid{fds2}),\ocwlowerid{\_})~=~\ocwlowerid{l2}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$\ocwlowerid{j}~=~\ocwupperid{SetofAttr.}\ocwlowerid{inter}~\ocwlowerid{u}~\ocwlowerid{v}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
\ocwkw{let}~$(\ocwlowerid{dR},\ocwlowerid{dS})~=~\ocwlowerid{delta\_put\_join}~\ocwlowerid{l1}~\ocwlowerid{l2}~\ocwlowerid{j}~(\ocwupperid{PCns}~(\ocwupperid{Bol}~$\ocwkw{true}$))~(\ocwupperid{PCns}~(\ocwupperid{Bol}~$\ocwkw{false}$))~$\ocweol
\ocwindent{4.00em}
$(\ocwupperid{SetofFD.}\ocwlowerid{union}~\ocwlowerid{fds1}~\ocwlowerid{fds2})~\ocwlowerid{dT}~$\ocwkw{in}\ocweol
\ocwindent{2.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~\ocwlowerid{dR}~(\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~\ocwlowerid{dS}~(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{t}~\ocwlowerid{dRm}))$\ocweol
\ocwindent{1.50em}
$\mid{}~\ocwupperid{Drop}~(\ocwlowerid{a},(\ocwlowerid{attr\_list},\ocwlowerid{v}),\ocwlowerid{r},\ocwlowerid{s})~\rightarrow{}$\ocweol
\ocwindent{3.50em}
\ocwkw{let}~$\ocwlowerid{dS}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dRm}~$\ocwkw{in}\ocweol
\ocwindent{3.50em}
\ocwkw{let}~$\ocwlowerid{dR}~=~\ocwlowerid{delta\_put\_drop}~\ocwlowerid{r}~\ocwlowerid{dbI}~\ocwlowerid{a}~(\ocwupperid{SetofAttr.}\ocwlowerid{of\_list}~\ocwlowerid{attr\_list})~\ocwlowerid{v}~\ocwlowerid{dS}~$\ocwkw{in}\ocweol
\ocwindent{3.50em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~\ocwlowerid{dR}~(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{dRm})$\ocweol
\ocwindent{1.50em}
$\mid{}~\ocwupperid{Compose}~(\ocwlowerid{l1},\ocwlowerid{l2})~\rightarrow{}$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{dbK}~=~\ocwlowerid{get}~\ocwlowerid{l1}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.50em}
$\ocwlowerid{delta\_put\_map}~\ocwlowerid{l1}~\ocwlowerid{dbI}~(\ocwlowerid{delta\_put\_map}~\ocwlowerid{l2}~\ocwlowerid{dbK}~\ocwlowerid{dRm})$\medskip

\label{rellens.ml:58451}%
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{select}~\ocwlowerid{r}~\ocwlowerid{p}~\ocwlowerid{s}~=~\ocwupperid{Select}~(\ocwlowerid{r},~\ocwlowerid{p},~\ocwlowerid{s})$\ocweol
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{join\_dl}~(\ocwlowerid{r},\ocwlowerid{s})~\ocwlowerid{t}~=~\ocwupperid{JoinDL}~((\ocwlowerid{r},\ocwlowerid{s}),\ocwlowerid{t})$\ocweol
\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{drop}~\ocwlowerid{a}~(\ocwlowerid{attr\_list},\ocwlowerid{v})~\ocwlowerid{r}~\ocwlowerid{s}~=~\ocwupperid{Drop}~(\ocwlowerid{a},(\ocwlowerid{attr\_list},\ocwlowerid{v}),\ocwlowerid{r},\ocwlowerid{s})$\medskip

\ocwendcode{}\ocwindent{0.00em}
$\displaystyle\frac{
  v \in \Sigma \Leftrightarrow  \Sigma' \qquad
  w \in \Sigma' \Leftrightarrow \Delta
}
{
 v;w \in \Sigma \Leftrightarrow \Delta
}\ \text{(\textsc{T-Compose})}
$

\ocweol
\label{rellens.ml:58777}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{compose}~\ocwlowerid{l1}~\ocwlowerid{l2}~=~\ocwupperid{Compose}~(\ocwlowerid{l1},\ocwlowerid{l2})$\medskip

\ocwendcode{}\ocwindent{0.00em}
composition lens in infix form 
\ocweol
\label{rellens.ml:58851}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$(\&:)~(\ocwlowerid{l1}:\ocwlowerid{lens})~(\ocwlowerid{l2}:\ocwlowerid{lens})~:~\ocwlowerid{lens}~=~\ocwlowerid{compose}~\ocwlowerid{l1}~\ocwlowerid{l2}$\medskip

\ocwendcode{}\ocwindent{0.00em}
type inference of lens, given sort on the left 
\ocweol
\label{rellens.ml:58957}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~\ocwkw{rec}~$\ocwlowerid{qt\_lens}~(\ocwlowerid{l}:\ocwlowerid{lens})~(\ocwlowerid{srt}:~\ocwlowerid{sort}~\ocwupperid{MapofRname.}\ocwlowerid{t})~:~\ocwlowerid{sort}~\ocwupperid{MapofRname.}\ocwlowerid{t}~=~$\ocwkw{match}~$\ocwlowerid{l}~$\ocwkw{with}\ocweol
\ocwindent{1.00em}
$\ocwupperid{Select}~(\ocwlowerid{r},~\ocwlowerid{p},~\ocwlowerid{s})~\rightarrow{}$\ocweol
\ocwindent{1.50em}
\ocwkw{let}~$\ocwlowerid{sortR}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{srt}~$\ocwkw{in}\ocweol
\ocwindent{2.50em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~(\ocwlowerid{typeinf\_select}~\ocwlowerid{p}~\ocwlowerid{sortR})~$\ocweol
\ocwindent{3.50em}
$(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~\ocwlowerid{srt})$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{JoinDL}~((\ocwlowerid{r},\ocwlowerid{s}),\ocwlowerid{t})~\rightarrow{}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortR}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{srt}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortS}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{srt}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortT}~=~\ocwlowerid{typeinf\_join\_dl}~\ocwlowerid{sortR}~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{t}~\ocwlowerid{sortT}~(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{s}~\ocwlowerid{srt}))$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Drop}~(\ocwlowerid{a},(\ocwlowerid{attr\_list},\ocwlowerid{v}),\ocwlowerid{r},\ocwlowerid{s})~\rightarrow{}$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortR}~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{srt}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{sortS}~=~\ocwlowerid{typeinf\_drop}~\ocwlowerid{a}~((\ocwupperid{SetofAttr.}\ocwlowerid{of\_list}~\ocwlowerid{attr\_list}),\ocwlowerid{v})~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~\ocwlowerid{sortS}~(\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{r}~\ocwlowerid{srt})$\ocweol
\ocwindent{1.00em}
$\mid{}~\ocwupperid{Compose}~(\ocwlowerid{l1},\ocwlowerid{l2})~\rightarrow{}$\ocweol
\ocwindent{3.00em}
\ocwkw{let}~$\ocwlowerid{sort1}~=~\ocwlowerid{qt\_lens}~\ocwlowerid{l1}~\ocwlowerid{srt}~$\ocwkw{in}\ocweol
\ocwindent{3.00em}
$\ocwlowerid{qt\_lens}~\ocwlowerid{l2}~\ocwlowerid{sort1}$\medskip

\ocwendcode{}\ocwindent{0.00em}
Simple instantiation of $\mt{join\_template}_{{\relationalmergep{F}},\Phi}$ with 
\ocweol
\ocwindent{0.00em}
$\begin{array}{rcl} {\relationalmergep{F}} &=& {\relationalmerge{F}}\\
   \Phi(U,P,F)&=& (F\ \text{is tree-form})\ \text{and}\ (P\ \text{ignores}\ \mi{outputs}(F))\end{array}$ 
\ocweol
\ocwindent{0.00em}
TODO : statically (at least dynamically) check $P_d \cup Q_d = \top_{UV}$ 
\ocweol
\label{rellens.ml:60139}%
\medskip
\ocwbegincode{}\ocwindent{0.00em}
\ocwkw{let}~$\ocwlowerid{put\_join\_template}~((\ocwlowerid{r}:\ocwlowerid{rname}),(\ocwlowerid{pd}:\ocwlowerid{phrase}))~((\ocwlowerid{s}:\ocwlowerid{rname}),(\ocwlowerid{qd}:\ocwlowerid{phrase}))~(\ocwlowerid{t}:\ocwlowerid{rname})~$\ocweol
\ocwindent{2.00em}
$((\ocwlowerid{dbJ},\ocwlowerid{dbI}):(\ocwlowerid{database}\times{}\ocwlowerid{database}))~:~\ocwlowerid{database}~=$\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortR},\ocwlowerid{iR})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{r}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{u},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{f})~=~\ocwlowerid{sortR}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortS},\ocwlowerid{iS})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{s}~\ocwlowerid{dbI}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{v},\ocwlowerid{\_},\ocwlowerid{\_},\ocwlowerid{g})~=~\ocwlowerid{sortS}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$(\ocwlowerid{sortT},\ocwlowerid{jT})~=~\ocwupperid{MapofRname.}\ocwlowerid{find}~\ocwlowerid{t}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{m0}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iR}~\ocwlowerid{f}~(\ocwlowerid{restrict\_relation}~\ocwlowerid{u}~\ocwlowerid{jT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{n0}~=~\ocwlowerid{relational\_merge}~\ocwlowerid{iS}~\ocwlowerid{g}~(\ocwlowerid{restrict\_relation}~\ocwlowerid{v}~\ocwlowerid{jT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{l}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~(\ocwlowerid{nat\_join}~\ocwlowerid{m0}~\ocwlowerid{n0})~\ocwlowerid{jT}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{ll}~=~\ocwlowerid{nat\_join}~\ocwlowerid{l}~(\ocwlowerid{restrict\_relation}~(\ocwupperid{SetofAttr.}\ocwlowerid{inter}~\ocwlowerid{u}~\ocwlowerid{v})~\ocwlowerid{jT})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{la}~=~\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{l}~\ocwlowerid{ll}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{m}~=~$\ocweol
\ocwindent{1.00em}
$\ocwupperid{SetofRecord.}\ocwlowerid{diff}$\ocweol
\ocwindent{1.50em}
$(\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{m0}~$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{restrict\_relation}~\ocwlowerid{u}~(\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{pd})~\ocwlowerid{la})))$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{restrict\_relation}~\ocwlowerid{u}~\ocwlowerid{ll})~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{n}~=~$\ocweol
\ocwindent{1.50em}
$\ocwupperid{SetofRecord.}\ocwlowerid{diff}~\ocwlowerid{n0}~$\ocweol
\ocwindent{2.00em}
$(\ocwlowerid{restrict\_relation}~\ocwlowerid{v}~(\ocwupperid{SetofRecord.}\ocwlowerid{filter}~($\ocwkw{fun}~$\ocwlowerid{r}~\rightarrow{}~\ocwlowerid{eval\_bool}~\ocwlowerid{r}~\ocwlowerid{qd})~\ocwlowerid{la}))~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{remove}~\ocwlowerid{t}~\ocwlowerid{dbJ}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{r}~(\ocwlowerid{sortR},\ocwlowerid{m})~\ocwlowerid{dbI'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
\ocwkw{let}~$\ocwlowerid{dbI'}~=~\ocwupperid{MapofRname.}\ocwlowerid{add}~\ocwlowerid{s}~(\ocwlowerid{sortS},\ocwlowerid{n})~\ocwlowerid{dbI'}~$\ocwkw{in}\ocweol
\ocwindent{1.00em}
$\ocwlowerid{dbI'}$\ocweol
\ocweol
\ocwendcode{}

\ocwbeginindex{}
\ocwrefindexentry{$\ocwsymbolid{\&:}$}{rellens.ml:58851}{}{\ref{rellens.ml:58851}}{}
\ocwrefindexentry{$\ocwlowerid{any\_match\_expr}$}{rellens.ml:36271}{rellens.ml:36633}{\ref{rellens.ml:36271}}{\ref{rellens.ml:36633}}
\ocwrefindexentry{$\ocwlowerid{attr}$ (type)}{rellens_types.ml:29}{rellens_types.ml:49,rellens_types.ml:988,rellens_types.ml:5505}{\ref{rellens_types.ml:29}}{\ref{rellens_types.ml:49}, \ref{rellens_types.ml:988}, \ref{rellens_types.ml:5505}}
\ocwrefindexentry{$\ocwupperid{Attr}$ (module)}{rellens_types.ml:49}{rellens_types.ml:258,rellens_types.ml:540}{\ref{rellens_types.ml:49}}{\ref{rellens_types.ml:258}, \ref{rellens_types.ml:540}}
\ocwrefindexentry{$\ocwlowerid{attribute}$}{rellens.ml:326}{rellens.ml:30041,rellens.ml:32886,rellens.ml:37074}{\ref{rellens.ml:326}}{\ref{rellens.ml:30041}, \ref{rellens.ml:32886}, \ref{rellens.ml:37074}}
\ocwrefindexentry{$\ocwupperid{Bol}$}{rellens_types.ml:349}{rellens.ml:4431,rellens.ml:29539,rellens.ml:29728,rellens.ml:42926,rellens.ml:56210}{\ref{rellens_types.ml:349}}{\ref{rellens.ml:4431}, \ref{rellens.ml:29539}, \ref{rellens.ml:29728}, \ref{rellens.ml:42926}, \ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{bwd}$}{rellens.ml:9844}{rellens.ml:10106}{\ref{rellens.ml:9844}}{\ref{rellens.ml:10106}}
\ocwrefindexentry{$\ocwlowerid{calc\_updated\_var\_expr}$}{rellens.ml:33162}{rellens.ml:33162,rellens.ml:34304}{\ref{rellens.ml:33162}}{\ref{rellens.ml:33162}, \ref{rellens.ml:34304}}
\ocwrefindexentry{$\ocwupperid{ChangeEntry}$ (module)}{rellens_types.ml:4596}{rellens_types.ml:4690}{\ref{rellens_types.ml:4596}}{\ref{rellens_types.ml:4690}}
\ocwrefindexentry{$\ocwlowerid{changes\_expr}$}{rellens.ml:50561}{rellens.ml:51038}{\ref{rellens.ml:50561}}{\ref{rellens.ml:51038}}
\ocwrefindexentry{$\ocwlowerid{change\_entry}$ (type)}{rellens_types.ml:4310}{rellens_types.ml:4596}{\ref{rellens_types.ml:4310}}{\ref{rellens_types.ml:4596}}
\ocwrefindexentry{$\ocwlowerid{change\_set}$}{rellens.ml:28090}{}{\ref{rellens.ml:28090}}{}
\ocwrefindexentry{$\ocwlowerid{closure}$}{rellens.ml:49339}{rellens.ml:49893}{\ref{rellens.ml:49339}}{\ref{rellens.ml:49893}}
\ocwrefindexentry{$\ocwlowerid{cnf}$}{rellens.ml:39673}{rellens.ml:39673,rellens.ml:41674}{\ref{rellens.ml:39673}}{\ref{rellens.ml:39673}, \ref{rellens.ml:41674}}
\ocwrefindexentry{$\ocwlowerid{compare}$}{rellens_types.ml:49,rellens_types.ml:790,rellens_types.ml:2813,rellens_types.ml:3698,rellens_types.ml:4596,rellens_types.ml:4734,rellens_types.ml:5055}{rellens_types.ml:49,rellens_types.ml:455,rellens_types.ml:790,rellens_types.ml:2630,rellens_types.ml:3698,rellens_types.ml:4343,rellens_types.ml:4734,rellens_types.ml:5055}{\ref{rellens_types.ml:49}, \ref{rellens_types.ml:790}, \ref{rellens_types.ml:2813}, \ref{rellens_types.ml:3698}, \ref{rellens_types.ml:4596}, \ref{rellens_types.ml:4734}, \ref{rellens_types.ml:5055}}{\ref{rellens_types.ml:49}, \ref{rellens_types.ml:455}, \ref{rellens_types.ml:790}, \ref{rellens_types.ml:2630}, \ref{rellens_types.ml:3698}, \ref{rellens_types.ml:4343}, \ref{rellens_types.ml:4734}, \ref{rellens_types.ml:5055}}
\ocwrefindexentry{$\ocwlowerid{compare\_change\_entry}$}{rellens_types.ml:4343}{rellens_types.ml:4596}{\ref{rellens_types.ml:4343}}{\ref{rellens_types.ml:4596}}
\ocwrefindexentry{$\ocwlowerid{compare\_fd}$}{rellens_types.ml:2630}{rellens_types.ml:2813,rellens_types.ml:5055,rellens.ml:50561}{\ref{rellens_types.ml:2630}}{\ref{rellens_types.ml:2813}, \ref{rellens_types.ml:5055}, \ref{rellens.ml:50561}}
\ocwrefindexentry{$\ocwlowerid{compare\_value}$}{rellens_types.ml:455}{rellens_types.ml:790,rellens_types.ml:4343,rellens_types.ml:4734}{\ref{rellens_types.ml:455}}{\ref{rellens_types.ml:790}, \ref{rellens_types.ml:4343}, \ref{rellens_types.ml:4734}}
\ocwrefindexentry{$\ocwlowerid{compl\_exists\_left}$}{rellens.ml:45746}{rellens.ml:46428,rellens.ml:47049,rellens.ml:51256,rellens.ml:52983}{\ref{rellens.ml:45746}}{\ref{rellens.ml:46428}, \ref{rellens.ml:47049}, \ref{rellens.ml:51256}, \ref{rellens.ml:52983}}
\ocwrefindexentry{$\ocwlowerid{compl\_exists\_right}$}{rellens.ml:46042}{rellens.ml:46832,rellens.ml:47191,rellens.ml:52566,rellens.ml:53885}{\ref{rellens.ml:46042}}{\ref{rellens.ml:46832}, \ref{rellens.ml:47191}, \ref{rellens.ml:52566}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{compl\_rows}$}{rellens.ml:30555}{rellens.ml:47934,rellens.ml:48291}{\ref{rellens.ml:30555}}{\ref{rellens.ml:47934}, \ref{rellens.ml:48291}}
\ocwrefindexentry{$\ocwlowerid{compose}$}{rellens.ml:58777}{rellens.ml:58851}{\ref{rellens.ml:58777}}{\ref{rellens.ml:58851}}
\ocwrefindexentry{$\ocwupperid{Compose}$}{rellens_types.ml:5505}{rellens.ml:58777}{\ref{rellens_types.ml:5505}}{\ref{rellens.ml:58777}}
\ocwrefindexentry{$\ocwlowerid{create\_query\_expr}$}{rellens.ml:51038}{rellens.ml:52566}{\ref{rellens.ml:51038}}{\ref{rellens.ml:52566}}
\ocwrefindexentry{$\ocwlowerid{database}$ (type)}{rellens_types.ml:4053}{rellens.ml:19080,rellens.ml:19693,rellens.ml:22676,rellens.ml:23545,rellens.ml:26473,rellens.ml:26951,rellens.ml:43638,rellens.ml:44335,rellens.ml:56210,rellens.ml:60139}{\ref{rellens_types.ml:4053}}{\ref{rellens.ml:19080}, \ref{rellens.ml:19693}, \ref{rellens.ml:22676}, \ref{rellens.ml:23545}, \ref{rellens.ml:26473}, \ref{rellens.ml:26951}, \ref{rellens.ml:43638}, \ref{rellens.ml:44335}, \ref{rellens.ml:56210}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwlowerid{decompose\_fd}$}{rellens.ml:37924,rellens.ml:38589}{rellens.ml:42926}{\ref{rellens.ml:37924}, \ref{rellens.ml:38589}}{\ref{rellens.ml:42926}}
\ocwrefindexentry{$\ocwlowerid{defining\_fds}$}{rellens.ml:49893}{rellens.ml:50561}{\ref{rellens.ml:49893}}{\ref{rellens.ml:50561}}
\ocwrefindexentry{$\ocwupperid{Delete}$}{rellens_types.ml:4164}{rellens.ml:28090,rellens.ml:28865,rellens.ml:30313,rellens.ml:35835,rellens.ml:47934,rellens.ml:48291,rellens.ml:51256,rellens.ml:52566,rellens.ml:52983,rellens.ml:53885}{\ref{rellens_types.ml:4164}}{\ref{rellens.ml:28090}, \ref{rellens.ml:28865}, \ref{rellens.ml:30313}, \ref{rellens.ml:35835}, \ref{rellens.ml:47934}, \ref{rellens.ml:48291}, \ref{rellens.ml:51256}, \ref{rellens.ml:52566}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{delta\_put}$}{rellens.ml:56210}{rellens.ml:56210}{\ref{rellens.ml:56210}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{delta\_put\_drop}$}{rellens.ml:37535}{rellens.ml:56210}{\ref{rellens.ml:37535}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{delta\_put\_join}$}{rellens.ml:55763}{rellens.ml:56210}{\ref{rellens.ml:55763}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{delta\_put\_map}$}{rellens.ml:56210}{rellens.ml:56210}{\ref{rellens.ml:56210}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{delta\_put\_select}$}{rellens.ml:35835}{rellens.ml:56210}{\ref{rellens.ml:35835}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{dom}$}{rellens.ml:201}{rellens.ml:840,rellens.ml:1371}{\ref{rellens.ml:201}}{\ref{rellens.ml:840}, \ref{rellens.ml:1371}}
\ocwrefindexentry{$\ocwlowerid{drop}$}{rellens.ml:58451}{}{\ref{rellens.ml:58451}}{}
\ocwrefindexentry{$\ocwupperid{Drop}$}{rellens_types.ml:5505}{rellens.ml:58451}{\ref{rellens_types.ml:5505}}{\ref{rellens.ml:58451}}
\ocwrefindexentry{$\ocwlowerid{eval}$}{rellens.ml:4431}{rellens.ml:4431,rellens.ml:6276,rellens.ml:42926}{\ref{rellens.ml:4431}}{\ref{rellens.ml:4431}, \ref{rellens.ml:6276}, \ref{rellens.ml:42926}}
\ocwrefindexentry{$\ocwlowerid{eval\_bool}$}{rellens.ml:6276}{rellens.ml:19080,rellens.ml:19693,rellens.ml:26951,rellens.ml:35334,rellens.ml:36633,rellens.ml:47336,rellens.ml:47488,rellens.ml:52566,rellens.ml:52983,rellens.ml:53885,rellens.ml:60139}{\ref{rellens.ml:6276}}{\ref{rellens.ml:19080}, \ref{rellens.ml:19693}, \ref{rellens.ml:26951}, \ref{rellens.ml:35334}, \ref{rellens.ml:36633}, \ref{rellens.ml:47336}, \ref{rellens.ml:47488}, \ref{rellens.ml:52566}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwlowerid{eval\_case}$}{rellens.ml:4431}{rellens.ml:4431}{\ref{rellens.ml:4431}}{\ref{rellens.ml:4431}}
\ocwrefindexentry{$\ocwlowerid{extend}$}{rellens.ml:477}{rellens.ml:37074}{\ref{rellens.ml:477}}{\ref{rellens.ml:37074}}
\ocwrefindexentry{$\ocwlowerid{f2map\_PSetofAttr}$}{rellens_types.ml:3355}{rellens.ml:11220}{\ref{rellens_types.ml:3355}}{\ref{rellens.ml:11220}}
\ocwrefindexentry{$\ocwlowerid{fd}$}{rellens.ml:17867}{}{\ref{rellens.ml:17867}}{}
\ocwrefindexentry{$\ocwlowerid{fd}$ (type)}{rellens_types.ml:2593}{rellens_types.ml:2813,rellens_types.ml:5055,rellens.ml:30834,rellens.ml:37924,rellens.ml:38589}{\ref{rellens_types.ml:2593}}{\ref{rellens_types.ml:2813}, \ref{rellens_types.ml:5055}, \ref{rellens.ml:30834}, \ref{rellens.ml:37924}, \ref{rellens.ml:38589}}
\ocwrefindexentry{$\ocwupperid{FD}$ (module)}{rellens_types.ml:2813}{rellens_types.ml:2878}{\ref{rellens_types.ml:2813}}{\ref{rellens_types.ml:2878}}
\ocwrefindexentry{$\ocwupperid{FDSPRecord}$ (module)}{rellens_types.ml:5055}{rellens_types.ml:5308}{\ref{rellens_types.ml:5055}}{\ref{rellens_types.ml:5308}}
\ocwrefindexentry{$\ocwlowerid{fd\_changes\_expr}$}{rellens.ml:50215}{rellens.ml:50561}{\ref{rellens.ml:50215}}{\ref{rellens.ml:50561}}
\ocwrefindexentry{$\ocwlowerid{find\_changed\_rows}$}{rellens.ml:48291}{}{\ref{rellens.ml:48291}}{}
\ocwrefindexentry{$\ocwupperid{Flt}$}{rellens_types.ml:349}{}{\ref{rellens_types.ml:349}}{}
\ocwrefindexentry{$\ocwlowerid{found\_any\_right}$}{rellens.ml:47336}{rellens.ml:47641,rellens.ml:53885}{\ref{rellens.ml:47336}}{\ref{rellens.ml:47641}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{found\_same\_right}$}{rellens.ml:47488}{rellens.ml:47641,rellens.ml:53885}{\ref{rellens.ml:47488}}{\ref{rellens.ml:47641}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{found\_upd\_right}$}{rellens.ml:47641}{rellens.ml:53885}{\ref{rellens.ml:47641}}{\ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{freevars}$}{rellens.ml:41061}{rellens.ml:41061,rellens.ml:41674}{\ref{rellens.ml:41061}}{\ref{rellens.ml:41061}, \ref{rellens.ml:41674}}
\ocwrefindexentry{$\ocwlowerid{fwd}$}{rellens.ml:9643}{rellens.ml:11220}{\ref{rellens.ml:9643}}{\ref{rellens.ml:11220}}
\ocwrefindexentry{$\ocwlowerid{fwd\_fds}$}{rellens.ml:49012}{rellens.ml:49339}{\ref{rellens.ml:49012}}{\ref{rellens.ml:49339}}
\ocwrefindexentry{$\ocwlowerid{get}$}{rellens.ml:56210}{rellens.ml:56210}{\ref{rellens.ml:56210}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{get\_drop}$}{rellens.ml:43638}{rellens.ml:56210}{\ref{rellens.ml:43638}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{get\_fd\_updates}$}{rellens.ml:30834}{rellens.ml:31157}{\ref{rellens.ml:30834}}{\ref{rellens.ml:31157}}
\ocwrefindexentry{$\ocwlowerid{get\_join\_dl}$}{rellens.ml:22676}{rellens.ml:56210}{\ref{rellens.ml:22676}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{get\_select}$}{rellens.ml:19080}{rellens.ml:56210}{\ref{rellens.ml:19080}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{get\_union}$}{rellens.ml:26473}{}{\ref{rellens.ml:26473}}{}
\ocwrefindexentry{$\ocwlowerid{get\_updateset}$}{rellens.ml:31157}{rellens.ml:34516,rellens.ml:50561}{\ref{rellens.ml:31157}}{\ref{rellens.ml:34516}, \ref{rellens.ml:50561}}
\ocwrefindexentry{$\ocwlowerid{idom}$}{rellens.ml:45169}{rellens.ml:46428,rellens.ml:46832,rellens.ml:47488,rellens.ml:52983,rellens.ml:53885}{\ref{rellens.ml:45169}}{\ref{rellens.ml:46428}, \ref{rellens.ml:46832}, \ref{rellens.ml:47488}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{ignores}$}{rellens.ml:6753}{rellens.ml:6753,rellens.ml:18411,rellens.ml:21405,rellens.ml:24878}{\ref{rellens.ml:6753}}{\ref{rellens.ml:6753}, \ref{rellens.ml:18411}, \ref{rellens.ml:21405}, \ref{rellens.ml:24878}}
\ocwrefindexentry{$\ocwlowerid{ilens}$ (type)}{rellens_types.ml:5410}{rellens.ml:51449}{\ref{rellens_types.ml:5410}}{\ref{rellens.ml:51449}}
\ocwrefindexentry{$\ocwupperid{Insert}$}{rellens_types.ml:4164}{rellens.ml:28090,rellens.ml:28865,rellens.ml:30313,rellens.ml:30834,rellens.ml:52983,rellens.ml:53885}{\ref{rellens_types.ml:4164}}{\ref{rellens.ml:28090}, \ref{rellens.ml:28865}, \ref{rellens.ml:30313}, \ref{rellens.ml:30834}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{instance}$}{rellens.ml:17722}{rellens.ml:36633,rellens.ml:44335}{\ref{rellens.ml:17722}}{\ref{rellens.ml:36633}, \ref{rellens.ml:44335}}
\ocwrefindexentry{$\ocwupperid{Int}$}{rellens_types.ml:349}{}{\ref{rellens_types.ml:349}}{}
\ocwrefindexentry{$\ocwlowerid{irel}$}{rellens.ml:45235}{rellens.ml:47336,rellens.ml:47488}{\ref{rellens.ml:45235}}{\ref{rellens.ml:47336}, \ref{rellens.ml:47488}}
\ocwrefindexentry{$\ocwlowerid{is\_compl}$}{rellens.ml:30313}{rellens.ml:30555,rellens.ml:45746,rellens.ml:46042}{\ref{rellens.ml:30313}}{\ref{rellens.ml:30555}, \ref{rellens.ml:45746}, \ref{rellens.ml:46042}}
\ocwrefindexentry{$\ocwupperid{Is\_Cyclic}$ (exn)}{rellens.ml:9413}{}{\ref{rellens.ml:9413}}{}
\ocwrefindexentry{$\ocwlowerid{is\_neutral}$}{rellens.ml:45297}{rellens.ml:45455,rellens.ml:45746,rellens.ml:46042,rellens.ml:52983,rellens.ml:53885}{\ref{rellens.ml:45297}}{\ref{rellens.ml:45455}, \ref{rellens.ml:45746}, \ref{rellens.ml:46042}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{is\_tree}$}{rellens.ml:10106}{rellens.ml:13311,rellens.ml:13759,rellens.ml:16109,rellens.ml:18411,rellens.ml:21405,rellens.ml:24878}{\ref{rellens.ml:10106}}{\ref{rellens.ml:13311}, \ref{rellens.ml:13759}, \ref{rellens.ml:16109}, \ref{rellens.ml:18411}, \ref{rellens.ml:21405}, \ref{rellens.ml:24878}}
\ocwrefindexentry{$\ocwupperid{JoinDL}$}{rellens_types.ml:5505}{rellens.ml:58451}{\ref{rellens_types.ml:5505}}{\ref{rellens.ml:58451}}
\ocwrefindexentry{$\ocwlowerid{join\_dl}$}{rellens.ml:58451}{}{\ref{rellens.ml:58451}}{}
\ocwrefindexentry{$\ocwlowerid{join\_left\_row}$}{rellens.ml:52983}{rellens.ml:55763}{\ref{rellens.ml:52983}}{\ref{rellens.ml:55763}}
\ocwrefindexentry{$\ocwlowerid{join\_right\_row}$}{rellens.ml:53885}{rellens.ml:55763}{\ref{rellens.ml:53885}}{\ref{rellens.ml:55763}}
\ocwrefindexentry{$\ocwlowerid{join\_with\_columns}$}{rellens.ml:51449}{rellens.ml:52566}{\ref{rellens.ml:51449}}{\ref{rellens.ml:52566}}
\ocwrefindexentry{$\ocwupperid{Keep}$}{rellens_types.ml:4164}{rellens.ml:28090,rellens.ml:45297,rellens.ml:45455,rellens.ml:52983,rellens.ml:53885}{\ref{rellens_types.ml:4164}}{\ref{rellens.ml:28090}, \ref{rellens.ml:45297}, \ref{rellens.ml:45455}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{key}$}{rellens.ml:45002}{rellens.ml:45455,rellens.ml:45746,rellens.ml:46042,rellens.ml:46428,rellens.ml:46832,rellens.ml:47336,rellens.ml:52566,rellens.ml:53885}{\ref{rellens.ml:45002}}{\ref{rellens.ml:45455}, \ref{rellens.ml:45746}, \ref{rellens.ml:46042}, \ref{rellens.ml:46428}, \ref{rellens.ml:46832}, \ref{rellens.ml:47336}, \ref{rellens.ml:52566}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{leaves}$}{rellens.ml:13311}{}{\ref{rellens.ml:13311}}{}
\ocwrefindexentry{$\ocwlowerid{left}$}{rellens.ml:8060}{rellens.ml:8450,rellens.ml:13311}{\ref{rellens.ml:8060}}{\ref{rellens.ml:8450}, \ref{rellens.ml:13311}}
\ocwrefindexentry{$\ocwlowerid{lefts}$}{rellens.ml:49217}{}{\ref{rellens.ml:49217}}{}
\ocwrefindexentry{$\ocwlowerid{lens}$ (type)}{rellens_types.ml:5505}{rellens_types.ml:5505,rellens.ml:58851}{\ref{rellens_types.ml:5505}}{\ref{rellens_types.ml:5505}, \ref{rellens.ml:58851}}
\ocwrefindexentry{$\ocwlowerid{list\_pairs}$}{rellens.ml:7274}{rellens.ml:7513}{\ref{rellens.ml:7274}}{\ref{rellens.ml:7513}}
\ocwrefindexentry{$\ocwlowerid{lookup\_col}$}{rellens.ml:37074}{rellens.ml:37535}{\ref{rellens.ml:37074}}{\ref{rellens.ml:37535}}
\ocwrefindexentry{$\ocwlowerid{lookup\_type}$}{rellens.ml:2279}{rellens.ml:2830}{\ref{rellens.ml:2279}}{\ref{rellens.ml:2830}}
\ocwrefindexentry{$\ocwupperid{MapofAttr}$ (module)}{rellens_types.ml:540}{rellens_types.ml:695,rellens_types.ml:790,rellens_types.ml:2502,rellens_types.ml:4343,rellens_types.ml:4734,rellens.ml:201,rellens.ml:326,rellens.ml:477,rellens.ml:667,rellens.ml:1234,rellens.ml:1371,rellens.ml:2279,rellens.ml:2516,rellens.ml:4431,rellens.ml:14545,rellens.ml:24878,rellens.ml:42926,rellens.ml:44335,rellens.ml:51449}{\ref{rellens_types.ml:540}}{\ref{rellens_types.ml:695}, \ref{rellens_types.ml:790}, \ref{rellens_types.ml:2502}, \ref{rellens_types.ml:4343}, \ref{rellens_types.ml:4734}, \ref{rellens.ml:201}, \ref{rellens.ml:326}, \ref{rellens.ml:477}, \ref{rellens.ml:667}, \ref{rellens.ml:1234}, \ref{rellens.ml:1371}, \ref{rellens.ml:2279}, \ref{rellens.ml:2516}, \ref{rellens.ml:4431}, \ref{rellens.ml:14545}, \ref{rellens.ml:24878}, \ref{rellens.ml:42926}, \ref{rellens.ml:44335}, \ref{rellens.ml:51449}}
\ocwrefindexentry{$\ocwupperid{MapofRname}$ (module)}{rellens_types.ml:3789}{rellens_types.ml:4053,rellens.ml:17627,rellens.ml:17722,rellens.ml:17867,rellens.ml:19080,rellens.ml:19693,rellens.ml:22676,rellens.ml:23545,rellens.ml:26473,rellens.ml:26951,rellens.ml:35334,rellens.ml:43638,rellens.ml:44335,rellens.ml:56210,rellens.ml:58957,rellens.ml:60139}{\ref{rellens_types.ml:3789}}{\ref{rellens_types.ml:4053}, \ref{rellens.ml:17627}, \ref{rellens.ml:17722}, \ref{rellens.ml:17867}, \ref{rellens.ml:19080}, \ref{rellens.ml:19693}, \ref{rellens.ml:22676}, \ref{rellens.ml:23545}, \ref{rellens.ml:26473}, \ref{rellens.ml:26951}, \ref{rellens.ml:35334}, \ref{rellens.ml:43638}, \ref{rellens.ml:44335}, \ref{rellens.ml:56210}, \ref{rellens.ml:58957}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwupperid{MapofSetofAttr}$ (module)}{rellens_types.ml:3167}{rellens_types.ml:3355,rellens.ml:11220}{\ref{rellens_types.ml:3167}}{\ref{rellens_types.ml:3355}, \ref{rellens.ml:11220}}
\ocwrefindexentry{$\ocwlowerid{match\_changes\_expr}$}{rellens.ml:48730}{}{\ref{rellens.ml:48730}}{}
\ocwrefindexentry{$\ocwlowerid{match\_on}$}{rellens.ml:29375}{rellens.ml:30555,rellens.ml:37074,rellens.ml:45455,rellens.ml:45746,rellens.ml:46042,rellens.ml:46428,rellens.ml:46832,rellens.ml:48730}{\ref{rellens.ml:29375}}{\ref{rellens.ml:30555}, \ref{rellens.ml:37074}, \ref{rellens.ml:45455}, \ref{rellens.ml:45746}, \ref{rellens.ml:46042}, \ref{rellens.ml:46428}, \ref{rellens.ml:46832}, \ref{rellens.ml:48730}}
\ocwrefindexentry{$\ocwlowerid{match\_on\_expr}$}{rellens.ml:30041}{rellens.ml:32886,rellens.ml:36271,rellens.ml:47336,rellens.ml:47488,rellens.ml:47934,rellens.ml:48730,rellens.ml:50215,rellens.ml:51038,rellens.ml:53885}{\ref{rellens.ml:30041}}{\ref{rellens.ml:32886}, \ref{rellens.ml:36271}, \ref{rellens.ml:47336}, \ref{rellens.ml:47488}, \ref{rellens.ml:47934}, \ref{rellens.ml:48730}, \ref{rellens.ml:50215}, \ref{rellens.ml:51038}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{merge\_attrs}$}{rellens.ml:9015}{rellens.ml:9501}{\ref{rellens.ml:9015}}{\ref{rellens.ml:9501}}
\ocwrefindexentry{$\ocwlowerid{merge\_tenv}$}{rellens.ml:2516}{rellens.ml:21405,rellens.ml:51449}{\ref{rellens.ml:2516}}{\ref{rellens.ml:21405}, \ref{rellens.ml:51449}}
\ocwrefindexentry{$\ocwlowerid{models}$}{rellens.ml:7513}{rellens.ml:7875,rellens.ml:15193}{\ref{rellens.ml:7513}}{\ref{rellens.ml:7875}, \ref{rellens.ml:15193}}
\ocwrefindexentry{$\ocwlowerid{models\_fds}$}{rellens.ml:7875}{rellens.ml:16109}{\ref{rellens.ml:7875}}{\ref{rellens.ml:16109}}
\ocwrefindexentry{$\ocwlowerid{mult}$ (type)}{rellens_types.ml:4164}{rellens_types.ml:4310}{\ref{rellens_types.ml:4164}}{\ref{rellens_types.ml:4310}}
\ocwrefindexentry{$\ocwupperid{Multiple\_Indegree}$ (exn)}{rellens.ml:9413}{}{\ref{rellens.ml:9413}}{}
\ocwrefindexentry{$\ocwlowerid{names}$}{rellens.ml:8450}{}{\ref{rellens.ml:8450}}{}
\ocwrefindexentry{$\ocwlowerid{nat\_join}$}{rellens.ml:1371}{rellens.ml:22676,rellens.ml:23545,rellens.ml:44335,rellens.ml:60139}{\ref{rellens.ml:1371}}{\ref{rellens.ml:22676}, \ref{rellens.ml:23545}, \ref{rellens.ml:44335}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwlowerid{nodes}$}{rellens.ml:9501}{rellens.ml:10106}{\ref{rellens.ml:9501}}{\ref{rellens.ml:10106}}
\ocwrefindexentry{$\ocwlowerid{non\_upd\_left}$}{rellens.ml:47049}{rellens.ml:52983}{\ref{rellens.ml:47049}}{\ref{rellens.ml:52983}}
\ocwrefindexentry{$\ocwlowerid{non\_upd\_right}$}{rellens.ml:47191}{rellens.ml:53885}{\ref{rellens.ml:47191}}{\ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwupperid{Not\_in\_Tree\_Form}$ (exn)}{rellens.ml:13120}{}{\ref{rellens.ml:13120}}{}
\ocwrefindexentry{$\ocwlowerid{ntrl\_exists\_right}$}{rellens.ml:45455}{rellens.ml:52566,rellens.ml:53885}{\ref{rellens.ml:45455}}{\ref{rellens.ml:52566}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{of\_domain}$}{rellens.ml:840}{rellens.ml:1371}{\ref{rellens.ml:840}}{\ref{rellens.ml:1371}}
\ocwrefindexentry{$\ocwlowerid{outputs}$}{rellens.ml:8665}{rellens.ml:18411,rellens.ml:21405,rellens.ml:24878}{\ref{rellens.ml:8665}}{\ref{rellens.ml:18411}, \ref{rellens.ml:21405}, \ref{rellens.ml:24878}}
\ocwrefindexentry{$\ocwupperid{Overlap\_Between\_Attributes}$ (exn)}{rellens.ml:8936}{}{\ref{rellens.ml:8936}}{}
\ocwrefindexentry{$\ocwupperid{PAnd}$}{rellens_types.ml:988}{rellens_types.ml:1605,rellens.ml:18411,rellens.ml:21405,rellens.ml:29539,rellens.ml:35334,rellens.ml:39673,rellens.ml:51038,rellens.ml:51449}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}, \ref{rellens.ml:18411}, \ref{rellens.ml:21405}, \ref{rellens.ml:29539}, \ref{rellens.ml:35334}, \ref{rellens.ml:39673}, \ref{rellens.ml:51038}, \ref{rellens.ml:51449}}
\ocwrefindexentry{$\ocwupperid{PCase}$}{rellens_types.ml:988}{rellens_types.ml:1605,rellens.ml:32886}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}, \ref{rellens.ml:32886}}
\ocwrefindexentry{$\ocwupperid{PCns}$}{rellens_types.ml:988}{rellens.ml:29539,rellens.ml:29728,rellens.ml:30041,rellens.ml:32886,rellens.ml:56210}{\ref{rellens_types.ml:988}}{\ref{rellens.ml:29539}, \ref{rellens.ml:29728}, \ref{rellens.ml:30041}, \ref{rellens.ml:32886}, \ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwupperid{PEq}$}{rellens_types.ml:988}{rellens_types.ml:1605,rellens.ml:30041}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}, \ref{rellens.ml:30041}}
\ocwrefindexentry{$\ocwupperid{PGt}$}{rellens_types.ml:988}{rellens_types.ml:1605}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}}
\ocwrefindexentry{$\ocwupperid{PGte}$}{rellens_types.ml:988}{rellens_types.ml:1605}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}}
\ocwrefindexentry{$\ocwlowerid{phrase}$ (type)}{rellens_types.ml:988}{rellens_types.ml:988,rellens_types.ml:1605,rellens_types.ml:3940,rellens_types.ml:5505,rellens.ml:29539,rellens.ml:29728,rellens.ml:30041,rellens.ml:32886,rellens.ml:33162,rellens.ml:34304,rellens.ml:34516,rellens.ml:36271,rellens.ml:39673,rellens.ml:41674,rellens.ml:47934,rellens.ml:48730,rellens.ml:50215,rellens.ml:50561,rellens.ml:51038}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:988}, \ref{rellens_types.ml:1605}, \ref{rellens_types.ml:3940}, \ref{rellens_types.ml:5505}, \ref{rellens.ml:29539}, \ref{rellens.ml:29728}, \ref{rellens.ml:30041}, \ref{rellens.ml:32886}, \ref{rellens.ml:33162}, \ref{rellens.ml:34304}, \ref{rellens.ml:34516}, \ref{rellens.ml:36271}, \ref{rellens.ml:39673}, \ref{rellens.ml:41674}, \ref{rellens.ml:47934}, \ref{rellens.ml:48730}, \ref{rellens.ml:50215}, \ref{rellens.ml:50561}, \ref{rellens.ml:51038}}
\ocwrefindexentry{$\ocwlowerid{phrase\_map}$}{rellens_types.ml:1605}{rellens_types.ml:1605,rellens.ml:34516}{\ref{rellens_types.ml:1605}}{\ref{rellens_types.ml:1605}, \ref{rellens.ml:34516}}
\ocwrefindexentry{$\ocwupperid{PLt}$}{rellens_types.ml:988}{rellens_types.ml:1605}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}}
\ocwrefindexentry{$\ocwupperid{PLte}$}{rellens_types.ml:988}{rellens_types.ml:1605}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}}
\ocwrefindexentry{$\ocwupperid{PNot}$}{rellens_types.ml:988}{rellens_types.ml:1605,rellens.ml:19693,rellens.ml:35334,rellens.ml:39673,rellens.ml:51038}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}, \ref{rellens.ml:19693}, \ref{rellens.ml:35334}, \ref{rellens.ml:39673}, \ref{rellens.ml:51038}}
\ocwrefindexentry{$\ocwupperid{POr}$}{rellens_types.ml:988}{rellens_types.ml:1605,rellens.ml:24878,rellens.ml:29728,rellens.ml:39673}{\ref{rellens_types.ml:988}}{\ref{rellens_types.ml:1605}, \ref{rellens.ml:24878}, \ref{rellens.ml:29728}, \ref{rellens.ml:39673}}
\ocwrefindexentry{$\ocwupperid{PRecord}$ (module)}{rellens_types.ml:4734}{rellens_types.ml:4970}{\ref{rellens_types.ml:4734}}{\ref{rellens_types.ml:4970}}
\ocwrefindexentry{$\ocwupperid{PSetofAttr}$ (module)}{rellens_types.ml:2940}{rellens_types.ml:2995,rellens_types.ml:3355,rellens.ml:9015,rellens.ml:9501,rellens.ml:9643,rellens.ml:9844,rellens.ml:10106,rellens.ml:11220,rellens.ml:13311,rellens.ml:13759,rellens.ml:16109,rellens.ml:34516,rellens.ml:45002,rellens.ml:49217}{\ref{rellens_types.ml:2940}}{\ref{rellens_types.ml:2995}, \ref{rellens_types.ml:3355}, \ref{rellens.ml:9015}, \ref{rellens.ml:9501}, \ref{rellens.ml:9643}, \ref{rellens.ml:9844}, \ref{rellens.ml:10106}, \ref{rellens.ml:11220}, \ref{rellens.ml:13311}, \ref{rellens.ml:13759}, \ref{rellens.ml:16109}, \ref{rellens.ml:34516}, \ref{rellens.ml:45002}, \ref{rellens.ml:49217}}
\ocwrefindexentry{$\ocwlowerid{ptype}$ (type)}{rellens_types.ml:2362}{rellens_types.ml:2502,rellens.ml:2279,rellens.ml:2830}{\ref{rellens_types.ml:2362}}{\ref{rellens_types.ml:2502}, \ref{rellens.ml:2279}, \ref{rellens.ml:2830}}
\ocwrefindexentry{$\ocwlowerid{put}$}{rellens.ml:56210}{rellens.ml:56210}{\ref{rellens.ml:56210}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{put\_drop}$}{rellens.ml:44335}{rellens.ml:56210}{\ref{rellens.ml:44335}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{put\_join\_dl}$}{rellens.ml:23545}{rellens.ml:56210}{\ref{rellens.ml:23545}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{put\_join\_template}$}{rellens.ml:60139}{}{\ref{rellens.ml:60139}}{}
\ocwrefindexentry{$\ocwlowerid{put\_select}$}{rellens.ml:19693}{rellens.ml:56210}{\ref{rellens.ml:19693}}{\ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwlowerid{put\_union}$}{rellens.ml:26951}{}{\ref{rellens.ml:26951}}{}
\ocwrefindexentry{$\ocwupperid{PVar}$}{rellens_types.ml:988}{rellens.ml:30041,rellens.ml:34304}{\ref{rellens_types.ml:988}}{\ref{rellens.ml:30041}, \ref{rellens.ml:34304}}
\ocwrefindexentry{$\ocwlowerid{qtype}$}{rellens.ml:2830}{rellens.ml:2830,rellens.ml:18411,rellens.ml:35334,rellens.ml:36633}{\ref{rellens.ml:2830}}{\ref{rellens.ml:2830}, \ref{rellens.ml:18411}, \ref{rellens.ml:35334}, \ref{rellens.ml:36633}}
\ocwrefindexentry{$\ocwlowerid{qt\_lens}$}{rellens.ml:58957}{rellens.ml:58957}{\ref{rellens.ml:58957}}{\ref{rellens.ml:58957}}
\ocwrefindexentry{$\ocwlowerid{query\_deleted\_rows}$}{rellens.ml:35334}{rellens.ml:35835}{\ref{rellens.ml:35334}}{\ref{rellens.ml:35835}}
\ocwrefindexentry{$\ocwlowerid{query\_lookup\_table}$}{rellens.ml:36633}{rellens.ml:37535}{\ref{rellens.ml:36633}}{\ref{rellens.ml:37535}}
\ocwrefindexentry{$\ocwlowerid{rbcr}$}{rellens.ml:14545}{rellens.ml:15193}{\ref{rellens.ml:14545}}{\ref{rellens.ml:15193}}
\ocwrefindexentry{$\ocwlowerid{record}$ (type)}{rellens_types.ml:695}{rellens_types.ml:790,rellens_types.ml:4310,rellens_types.ml:4734,rellens.ml:477,rellens.ml:667,rellens.ml:14545,rellens.ml:15193,rellens.ml:16109}{\ref{rellens_types.ml:695}}{\ref{rellens_types.ml:790}, \ref{rellens_types.ml:4310}, \ref{rellens_types.ml:4734}, \ref{rellens.ml:477}, \ref{rellens.ml:667}, \ref{rellens.ml:14545}, \ref{rellens.ml:15193}, \ref{rellens.ml:16109}}
\ocwrefindexentry{$\ocwupperid{Record}$ (module)}{rellens_types.ml:790}{rellens_types.ml:884}{\ref{rellens_types.ml:790}}{\ref{rellens_types.ml:884}}
\ocwrefindexentry{$\ocwlowerid{record\_equal}$}{rellens.ml:1234}{rellens.ml:1371,rellens.ml:7513,rellens.ml:15193,rellens.ml:29375,rellens.ml:33162,rellens.ml:51449}{\ref{rellens.ml:1234}}{\ref{rellens.ml:1371}, \ref{rellens.ml:7513}, \ref{rellens.ml:15193}, \ref{rellens.ml:29375}, \ref{rellens.ml:33162}, \ref{rellens.ml:51449}}
\ocwrefindexentry{$\ocwlowerid{record\_revision}$}{rellens.ml:16109}{rellens.ml:16109,rellens.ml:17161}{\ref{rellens.ml:16109}}{\ref{rellens.ml:16109}, \ref{rellens.ml:17161}}
\ocwrefindexentry{$\ocwlowerid{relation}$ (type)}{rellens_types.ml:923}{rellens_types.ml:4053,rellens_types.ml:5410,rellens.ml:1061,rellens.ml:1371,rellens.ml:17161,rellens.ml:17467,rellens.ml:17722,rellens.ml:28865,rellens.ml:35334,rellens.ml:36633,rellens.ml:45235}{\ref{rellens_types.ml:923}}{\ref{rellens_types.ml:4053}, \ref{rellens_types.ml:5410}, \ref{rellens.ml:1061}, \ref{rellens.ml:1371}, \ref{rellens.ml:17161}, \ref{rellens.ml:17467}, \ref{rellens.ml:17722}, \ref{rellens.ml:28865}, \ref{rellens.ml:35334}, \ref{rellens.ml:36633}, \ref{rellens.ml:45235}}
\ocwrefindexentry{$\ocwlowerid{relational\_delta\_merge}$}{rellens.ml:28865}{}{\ref{rellens.ml:28865}}{}
\ocwrefindexentry{$\ocwlowerid{relational\_merge}$}{rellens.ml:17467}{rellens.ml:19693,rellens.ml:23545,rellens.ml:26473,rellens.ml:26951,rellens.ml:28865,rellens.ml:60139}{\ref{rellens.ml:17467}}{\ref{rellens.ml:19693}, \ref{rellens.ml:23545}, \ref{rellens.ml:26473}, \ref{rellens.ml:26951}, \ref{rellens.ml:28865}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwlowerid{relation\_revision}$}{rellens.ml:17161}{rellens.ml:17467,rellens.ml:44335}{\ref{rellens.ml:17161}}{\ref{rellens.ml:17467}, \ref{rellens.ml:44335}}
\ocwrefindexentry{$\ocwupperid{Rellens}$ (module)}{rellens.ml:0}{}{\ref{rellens.ml:0}}{}
\ocwrefindexentry{$\ocwupperid{Rellens\_types}$ (module)}{rellens_types.ml:0}{rellens.ml:81}{\ref{rellens_types.ml:0}}{\ref{rellens.ml:81}}
\ocwrefindexentry{$\ocwlowerid{removed\_row\_expr}$}{rellens.ml:47934}{rellens.ml:51038}{\ref{rellens.ml:47934}}{\ref{rellens.ml:51038}}
\ocwrefindexentry{$\ocwlowerid{remove\_entry\_left}$}{rellens.ml:51256}{rellens.ml:52983,rellens.ml:53885}{\ref{rellens.ml:51256}}{\ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{remove\_entry\_right}$}{rellens.ml:52566}{rellens.ml:52983,rellens.ml:53885}{\ref{rellens.ml:52566}}{\ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{restrict}$}{rellens.ml:667}{rellens.ml:1061,rellens.ml:1371,rellens.ml:7513,rellens.ml:15193,rellens.ml:29375,rellens.ml:30834,rellens.ml:51449,rellens.ml:52983,rellens.ml:53885}{\ref{rellens.ml:667}}{\ref{rellens.ml:1061}, \ref{rellens.ml:1371}, \ref{rellens.ml:7513}, \ref{rellens.ml:15193}, \ref{rellens.ml:29375}, \ref{rellens.ml:30834}, \ref{rellens.ml:51449}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{restrict\_relation}$}{rellens.ml:1061}{rellens.ml:15193,rellens.ml:23545,rellens.ml:36633,rellens.ml:43638,rellens.ml:44335,rellens.ml:60139}{\ref{rellens.ml:1061}}{\ref{rellens.ml:15193}, \ref{rellens.ml:23545}, \ref{rellens.ml:36633}, \ref{rellens.ml:43638}, \ref{rellens.ml:44335}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwlowerid{right}$}{rellens.ml:8235}{rellens.ml:8450,rellens.ml:8665,rellens.ml:13759,rellens.ml:34516}{\ref{rellens.ml:8235}}{\ref{rellens.ml:8450}, \ref{rellens.ml:8665}, \ref{rellens.ml:13759}, \ref{rellens.ml:34516}}
\ocwrefindexentry{$\ocwlowerid{rname}$ (type)}{rellens_types.ml:3575}{rellens_types.ml:3698,rellens_types.ml:5505}{\ref{rellens_types.ml:3575}}{\ref{rellens_types.ml:3698}, \ref{rellens_types.ml:5505}}
\ocwrefindexentry{$\ocwupperid{Rname}$ (module)}{rellens_types.ml:3698}{rellens_types.ml:3789}{\ref{rellens_types.ml:3698}}{\ref{rellens_types.ml:3789}}
\ocwrefindexentry{$\ocwlowerid{roots}$}{rellens.ml:13759}{rellens.ml:16109,rellens.ml:34516,rellens.ml:45002}{\ref{rellens.ml:13759}}{\ref{rellens.ml:16109}, \ref{rellens.ml:34516}, \ref{rellens.ml:45002}}
\ocwrefindexentry{$\ocwlowerid{sdrr}$}{rellens.ml:15193}{rellens.ml:16109}{\ref{rellens.ml:15193}}{\ref{rellens.ml:16109}}
\ocwrefindexentry{$\ocwlowerid{select}$}{rellens.ml:58451}{}{\ref{rellens.ml:58451}}{}
\ocwrefindexentry{$\ocwupperid{Select}$}{rellens_types.ml:5505}{rellens.ml:58451}{\ref{rellens_types.ml:5505}}{\ref{rellens.ml:58451}}
\ocwrefindexentry{$\ocwlowerid{setmap\_PSetofAttr}$}{rellens_types.ml:2995}{rellens.ml:11220}{\ref{rellens_types.ml:2995}}{\ref{rellens.ml:11220}}
\ocwrefindexentry{$\ocwupperid{SetofAttr}$ (module)}{rellens_types.ml:258}{rellens_types.ml:2593,rellens_types.ml:2630,rellens_types.ml:2940,rellens_types.ml:3167,rellens_types.ml:3355,rellens_types.ml:3940,rellens.ml:201,rellens.ml:667,rellens.ml:840,rellens.ml:1371,rellens.ml:6753,rellens.ml:8060,rellens.ml:8235,rellens.ml:8450,rellens.ml:8665,rellens.ml:9015,rellens.ml:9643,rellens.ml:9844,rellens.ml:13311,rellens.ml:13759,rellens.ml:15193,rellens.ml:21405,rellens.ml:30041,rellens.ml:33162,rellens.ml:34304,rellens.ml:34516,rellens.ml:36633,rellens.ml:37924,rellens.ml:38589,rellens.ml:41061,rellens.ml:41674,rellens.ml:42926,rellens.ml:43638,rellens.ml:44335,rellens.ml:45002,rellens.ml:45169,rellens.ml:49012,rellens.ml:49339,rellens.ml:49893,rellens.ml:51449,rellens.ml:56210,rellens.ml:58957,rellens.ml:60139}{\ref{rellens_types.ml:258}}{\ref{rellens_types.ml:2593}, \ref{rellens_types.ml:2630}, \ref{rellens_types.ml:2940}, \ref{rellens_types.ml:3167}, \ref{rellens_types.ml:3355}, \ref{rellens_types.ml:3940}, \ref{rellens.ml:201}, \ref{rellens.ml:667}, \ref{rellens.ml:840}, \ref{rellens.ml:1371}, \ref{rellens.ml:6753}, \ref{rellens.ml:8060}, \ref{rellens.ml:8235}, \ref{rellens.ml:8450}, \ref{rellens.ml:8665}, \ref{rellens.ml:9015}, \ref{rellens.ml:9643}, \ref{rellens.ml:9844}, \ref{rellens.ml:13311}, \ref{rellens.ml:13759}, \ref{rellens.ml:15193}, \ref{rellens.ml:21405}, \ref{rellens.ml:30041}, \ref{rellens.ml:33162}, \ref{rellens.ml:34304}, \ref{rellens.ml:34516}, \ref{rellens.ml:36633}, \ref{rellens.ml:37924}, \ref{rellens.ml:38589}, \ref{rellens.ml:41061}, \ref{rellens.ml:41674}, \ref{rellens.ml:42926}, \ref{rellens.ml:43638}, \ref{rellens.ml:44335}, \ref{rellens.ml:45002}, \ref{rellens.ml:45169}, \ref{rellens.ml:49012}, \ref{rellens.ml:49339}, \ref{rellens.ml:49893}, \ref{rellens.ml:51449}, \ref{rellens.ml:56210}, \ref{rellens.ml:58957}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwupperid{SetofChange}$ (module)}{rellens_types.ml:4690}{rellens.ml:28090,rellens.ml:28865,rellens.ml:30555,rellens.ml:30834,rellens.ml:35835,rellens.ml:36271,rellens.ml:37535,rellens.ml:45455,rellens.ml:45746,rellens.ml:46042,rellens.ml:46428,rellens.ml:46832,rellens.ml:47934,rellens.ml:48291,rellens.ml:52983,rellens.ml:53885,rellens.ml:55763,rellens.ml:56210}{\ref{rellens_types.ml:4690}}{\ref{rellens.ml:28090}, \ref{rellens.ml:28865}, \ref{rellens.ml:30555}, \ref{rellens.ml:30834}, \ref{rellens.ml:35835}, \ref{rellens.ml:36271}, \ref{rellens.ml:37535}, \ref{rellens.ml:45455}, \ref{rellens.ml:45746}, \ref{rellens.ml:46042}, \ref{rellens.ml:46428}, \ref{rellens.ml:46832}, \ref{rellens.ml:47934}, \ref{rellens.ml:48291}, \ref{rellens.ml:52983}, \ref{rellens.ml:53885}, \ref{rellens.ml:55763}, \ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwupperid{SetofFD}$ (module)}{rellens_types.ml:2878}{rellens_types.ml:3940,rellens.ml:7875,rellens.ml:8060,rellens.ml:8235,rellens.ml:8665,rellens.ml:9501,rellens.ml:9643,rellens.ml:9844,rellens.ml:13311,rellens.ml:13759,rellens.ml:16109,rellens.ml:17867,rellens.ml:21405,rellens.ml:24878,rellens.ml:31157,rellens.ml:37924,rellens.ml:38589,rellens.ml:44335,rellens.ml:48730,rellens.ml:49012,rellens.ml:49217,rellens.ml:49893,rellens.ml:50561,rellens.ml:51449,rellens.ml:56210}{\ref{rellens_types.ml:2878}}{\ref{rellens_types.ml:3940}, \ref{rellens.ml:7875}, \ref{rellens.ml:8060}, \ref{rellens.ml:8235}, \ref{rellens.ml:8665}, \ref{rellens.ml:9501}, \ref{rellens.ml:9643}, \ref{rellens.ml:9844}, \ref{rellens.ml:13311}, \ref{rellens.ml:13759}, \ref{rellens.ml:16109}, \ref{rellens.ml:17867}, \ref{rellens.ml:21405}, \ref{rellens.ml:24878}, \ref{rellens.ml:31157}, \ref{rellens.ml:37924}, \ref{rellens.ml:38589}, \ref{rellens.ml:44335}, \ref{rellens.ml:48730}, \ref{rellens.ml:49012}, \ref{rellens.ml:49217}, \ref{rellens.ml:49893}, \ref{rellens.ml:50561}, \ref{rellens.ml:51449}, \ref{rellens.ml:56210}}
\ocwrefindexentry{$\ocwupperid{SetofFDSPRecord}$ (module)}{rellens_types.ml:5308}{rellens.ml:31157,rellens.ml:33162,rellens.ml:50561}{\ref{rellens_types.ml:5308}}{\ref{rellens.ml:31157}, \ref{rellens.ml:33162}, \ref{rellens.ml:50561}}
\ocwrefindexentry{$\ocwupperid{SetofPRecord}$ (module)}{rellens_types.ml:4970}{rellens_types.ml:5055,rellens.ml:30834,rellens.ml:32886,rellens.ml:33162,rellens.ml:48291,rellens.ml:50215}{\ref{rellens_types.ml:4970}}{\ref{rellens_types.ml:5055}, \ref{rellens.ml:30834}, \ref{rellens.ml:32886}, \ref{rellens.ml:33162}, \ref{rellens.ml:48291}, \ref{rellens.ml:50215}}
\ocwrefindexentry{$\ocwupperid{SetofRecord}$ (module)}{rellens_types.ml:884}{rellens_types.ml:923,rellens.ml:840,rellens.ml:1061,rellens.ml:1371,rellens.ml:7513,rellens.ml:15193,rellens.ml:17161,rellens.ml:17467,rellens.ml:19080,rellens.ml:19693,rellens.ml:23545,rellens.ml:26951,rellens.ml:28090,rellens.ml:28865,rellens.ml:35334,rellens.ml:35835,rellens.ml:36633,rellens.ml:37074,rellens.ml:44335,rellens.ml:47336,rellens.ml:47488,rellens.ml:51449,rellens.ml:52566,rellens.ml:53885,rellens.ml:60139}{\ref{rellens_types.ml:884}}{\ref{rellens_types.ml:923}, \ref{rellens.ml:840}, \ref{rellens.ml:1061}, \ref{rellens.ml:1371}, \ref{rellens.ml:7513}, \ref{rellens.ml:15193}, \ref{rellens.ml:17161}, \ref{rellens.ml:17467}, \ref{rellens.ml:19080}, \ref{rellens.ml:19693}, \ref{rellens.ml:23545}, \ref{rellens.ml:26951}, \ref{rellens.ml:28090}, \ref{rellens.ml:28865}, \ref{rellens.ml:35334}, \ref{rellens.ml:35835}, \ref{rellens.ml:36633}, \ref{rellens.ml:37074}, \ref{rellens.ml:44335}, \ref{rellens.ml:47336}, \ref{rellens.ml:47488}, \ref{rellens.ml:51449}, \ref{rellens.ml:52566}, \ref{rellens.ml:53885}, \ref{rellens.ml:60139}}
\ocwrefindexentry{$\ocwlowerid{sort}$}{rellens.ml:17627}{rellens.ml:36633}{\ref{rellens.ml:17627}}{\ref{rellens.ml:36633}}
\ocwrefindexentry{$\ocwlowerid{sort}$ (type)}{rellens_types.ml:3940}{rellens_types.ml:4053,rellens_types.ml:5410,rellens.ml:17627,rellens.ml:18411,rellens.ml:21405,rellens.ml:24878,rellens.ml:42926,rellens.ml:58957}{\ref{rellens_types.ml:3940}}{\ref{rellens_types.ml:4053}, \ref{rellens_types.ml:5410}, \ref{rellens.ml:17627}, \ref{rellens.ml:18411}, \ref{rellens.ml:21405}, \ref{rellens.ml:24878}, \ref{rellens.ml:42926}, \ref{rellens.ml:58957}}
\ocwrefindexentry{$\ocwlowerid{split\_phrase}$}{rellens.ml:41674}{rellens.ml:42926}{\ref{rellens.ml:41674}}{\ref{rellens.ml:42926}}
\ocwrefindexentry{$\ocwupperid{Str}$}{rellens_types.ml:349}{}{\ref{rellens_types.ml:349}}{}
\ocwrefindexentry{$\ocwlowerid{t}$ (type)}{rellens_types.ml:49,rellens_types.ml:790,rellens_types.ml:2813,rellens_types.ml:3698,rellens_types.ml:4596,rellens_types.ml:4734,rellens_types.ml:5055}{rellens_types.ml:695,rellens_types.ml:923,rellens_types.ml:2502,rellens_types.ml:2593,rellens_types.ml:3355,rellens_types.ml:3940,rellens_types.ml:4053,rellens_types.ml:5055,rellens.ml:201,rellens.ml:8060,rellens.ml:8235,rellens.ml:8450,rellens.ml:8665,rellens.ml:9015,rellens.ml:9501,rellens.ml:9643,rellens.ml:9844,rellens.ml:10106,rellens.ml:11220,rellens.ml:13311,rellens.ml:13759,rellens.ml:17867,rellens.ml:28090,rellens.ml:30834,rellens.ml:31157,rellens.ml:35835,rellens.ml:37924,rellens.ml:38589,rellens.ml:41061,rellens.ml:45002,rellens.ml:45169,rellens.ml:48291,rellens.ml:49012,rellens.ml:49217,rellens.ml:49339,rellens.ml:49893,rellens.ml:55763,rellens.ml:56210,rellens.ml:58957}{\ref{rellens_types.ml:49}, \ref{rellens_types.ml:790}, \ref{rellens_types.ml:2813}, \ref{rellens_types.ml:3698}, \ref{rellens_types.ml:4596}, \ref{rellens_types.ml:4734}, \ref{rellens_types.ml:5055}}{\ref{rellens_types.ml:695}, \ref{rellens_types.ml:923}, \ref{rellens_types.ml:2502}, \ref{rellens_types.ml:2593}, \ref{rellens_types.ml:3355}, \ref{rellens_types.ml:3940}, \ref{rellens_types.ml:4053}, \ref{rellens_types.ml:5055}, \ref{rellens.ml:201}, \ref{rellens.ml:8060}, \ref{rellens.ml:8235}, \ref{rellens.ml:8450}, \ref{rellens.ml:8665}, \ref{rellens.ml:9015}, \ref{rellens.ml:9501}, \ref{rellens.ml:9643}, \ref{rellens.ml:9844}, \ref{rellens.ml:10106}, \ref{rellens.ml:11220}, \ref{rellens.ml:13311}, \ref{rellens.ml:13759}, \ref{rellens.ml:17867}, \ref{rellens.ml:28090}, \ref{rellens.ml:30834}, \ref{rellens.ml:31157}, \ref{rellens.ml:35835}, \ref{rellens.ml:37924}, \ref{rellens.ml:38589}, \ref{rellens.ml:41061}, \ref{rellens.ml:45002}, \ref{rellens.ml:45169}, \ref{rellens.ml:48291}, \ref{rellens.ml:49012}, \ref{rellens.ml:49217}, \ref{rellens.ml:49339}, \ref{rellens.ml:49893}, \ref{rellens.ml:55763}, \ref{rellens.ml:56210}, \ref{rellens.ml:58957}}
\ocwrefindexentry{$\ocwupperid{TBol}$}{rellens_types.ml:2362}{rellens.ml:2830,rellens.ml:18411,rellens.ml:35334,rellens.ml:36633}{\ref{rellens_types.ml:2362}}{\ref{rellens.ml:2830}, \ref{rellens.ml:18411}, \ref{rellens.ml:35334}, \ref{rellens.ml:36633}}
\ocwrefindexentry{$\ocwlowerid{tenv}$ (type)}{rellens_types.ml:2502}{rellens_types.ml:3940,rellens.ml:2516}{\ref{rellens_types.ml:2502}}{\ref{rellens_types.ml:3940}, \ref{rellens.ml:2516}}
\ocwrefindexentry{$\ocwupperid{TFlt}$}{rellens_types.ml:2362}{rellens.ml:2830}{\ref{rellens_types.ml:2362}}{\ref{rellens.ml:2830}}
\ocwrefindexentry{$\ocwupperid{TInt}$}{rellens_types.ml:2362}{rellens.ml:2830}{\ref{rellens_types.ml:2362}}{\ref{rellens.ml:2830}}
\ocwrefindexentry{$\ocwupperid{TStr}$}{rellens_types.ml:2362}{rellens.ml:2830}{\ref{rellens_types.ml:2362}}{\ref{rellens.ml:2830}}
\ocwrefindexentry{$\ocwlowerid{typeinf\_drop}$}{rellens.ml:42926}{rellens.ml:43638,rellens.ml:44335,rellens.ml:58957}{\ref{rellens.ml:42926}}{\ref{rellens.ml:43638}, \ref{rellens.ml:44335}, \ref{rellens.ml:58957}}
\ocwrefindexentry{$\ocwlowerid{typeinf\_join\_dl}$}{rellens.ml:21405}{rellens.ml:22676,rellens.ml:58957}{\ref{rellens.ml:21405}}{\ref{rellens.ml:22676}, \ref{rellens.ml:58957}}
\ocwrefindexentry{$\ocwlowerid{typeinf\_select}$}{rellens.ml:18411}{rellens.ml:19080,rellens.ml:58957}{\ref{rellens.ml:18411}}{\ref{rellens.ml:19080}, \ref{rellens.ml:58957}}
\ocwrefindexentry{$\ocwlowerid{typeinf\_union}$}{rellens.ml:24878}{rellens.ml:26473}{\ref{rellens.ml:24878}}{\ref{rellens.ml:26473}}
\ocwrefindexentry{$\ocwlowerid{uf\_and}$}{rellens.ml:29539}{rellens.ml:29539,rellens.ml:30041,rellens.ml:41674}{\ref{rellens.ml:29539}}{\ref{rellens.ml:29539}, \ref{rellens.ml:30041}, \ref{rellens.ml:41674}}
\ocwrefindexentry{$\ocwlowerid{uf\_or}$}{rellens.ml:29728}{rellens.ml:29728,rellens.ml:36271,rellens.ml:47934,rellens.ml:48730,rellens.ml:50215,rellens.ml:50561}{\ref{rellens.ml:29728}}{\ref{rellens.ml:29728}, \ref{rellens.ml:36271}, \ref{rellens.ml:47934}, \ref{rellens.ml:48730}, \ref{rellens.ml:50215}, \ref{rellens.ml:50561}}
\ocwrefindexentry{$\ocwlowerid{updated\_pred}$}{rellens.ml:34516}{rellens.ml:35334}{\ref{rellens.ml:34516}}{\ref{rellens.ml:35334}}
\ocwrefindexentry{$\ocwlowerid{updated\_var\_expr}$}{rellens.ml:34304}{rellens.ml:34516}{\ref{rellens.ml:34304}}{\ref{rellens.ml:34516}}
\ocwrefindexentry{$\ocwlowerid{upd\_left}$}{rellens.ml:46428}{rellens.ml:47049,rellens.ml:52983}{\ref{rellens.ml:46428}}{\ref{rellens.ml:47049}, \ref{rellens.ml:52983}}
\ocwrefindexentry{$\ocwlowerid{upd\_right}$}{rellens.ml:46832}{rellens.ml:47191,rellens.ml:53885}{\ref{rellens.ml:46832}}{\ref{rellens.ml:47191}, \ref{rellens.ml:53885}}
\ocwrefindexentry{$\ocwlowerid{value}$ (type)}{rellens_types.ml:349}{rellens_types.ml:455,rellens_types.ml:695,rellens_types.ml:988,rellens_types.ml:5505,rellens.ml:326,rellens.ml:4431}{\ref{rellens_types.ml:349}}{\ref{rellens_types.ml:455}, \ref{rellens_types.ml:695}, \ref{rellens_types.ml:988}, \ref{rellens_types.ml:5505}, \ref{rellens.ml:326}, \ref{rellens.ml:4431}}
\ocwrefindexentry{$\ocwlowerid{var\_case\_expr}$}{rellens.ml:32886}{rellens.ml:33162}{\ref{rellens.ml:32886}}{\ref{rellens.ml:33162}}


\ocwendindex{}
\end{document}
